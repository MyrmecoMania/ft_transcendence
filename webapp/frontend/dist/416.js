"use strict";(self.webpackChunkkek=self.webpackChunkkek||[]).push([[416],{459:(e,t,n)=>{n.d(t,{KHR_materials_emissive_strength:()=>i});var s=n(23975),o=n(45316),a=n(37812);const r="KHR_materials_emissive_strength";class i{constructor(e){this.name=r,this.order=170,this._loader=e,this.enabled=this._loader.isExtensionUsed(r)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,t,n){return o.BT.LoadExtensionAsync(e,t,this.name,((s,o)=>this._loader.loadMaterialPropertiesAsync(e,t,n).then((()=>{this._loadEmissiveProperties(s,o,n)}))))}_loadEmissiveProperties(e,t,n){if(!(n instanceof s.Y))throw new Error(`${e}: Material type not supported`);void 0!==t.emissiveStrength&&(n.emissiveIntensity=t.emissiveStrength)}}(0,a.Hg)(r),(0,a.Ye)(r,!0,(e=>new i(e)))},1784:(e,t,n)=>{n.d(t,{KHR_animation_pointer:()=>G});var s=n(51137),o=n(37812),a=n(49532),r=n(7540),i=n(34236),l=n(26041);function c(e,t,n,s){return l.v9.FromArray(t,n).scale(s)}function h(e,t,n,s){return t[n]*s}function u(e,t,n,s){return-t[n]*s}function d(e,t,n,s){return t[n+1]*s}function p(e,t,n,s){return t[n]*s*2}function _(e){return{scale:[new f(r.X5.ANIMATIONTYPE_FLOAT,`${e}.uScale`,h,(()=>2)),new f(r.X5.ANIMATIONTYPE_FLOAT,`${e}.vScale`,d,(()=>2))],offset:[new f(r.X5.ANIMATIONTYPE_FLOAT,`${e}.uOffset`,h,(()=>2)),new f(r.X5.ANIMATIONTYPE_FLOAT,`${e}.vOffset`,d,(()=>2))],rotation:[new f(r.X5.ANIMATIONTYPE_FLOAT,`${e}.wAng`,u,(()=>1))]}}class m extends i.AnimationPropertyInfo{buildAnimations(e,t,n,s){return[{babylonAnimatable:e._babylonCamera,babylonAnimation:this._buildAnimation(t,n,s)}]}}class f extends i.AnimationPropertyInfo{buildAnimations(e,t,n,s){const o=[];for(const a in e._data)o.push({babylonAnimatable:e._data[a].babylonMaterial,babylonAnimation:this._buildAnimation(t,n,s)});return o}}class g extends i.AnimationPropertyInfo{buildAnimations(e,t,n,s){return[{babylonAnimatable:e._babylonLight,babylonAnimation:this._buildAnimation(t,n,s)}]}}(0,a.ZU)("/cameras/{}/orthographic/xmag",[new m(r.X5.ANIMATIONTYPE_FLOAT,"orthoLeft",u,(()=>1)),new m(r.X5.ANIMATIONTYPE_FLOAT,"orthoRight",d,(()=>1))]),(0,a.ZU)("/cameras/{}/orthographic/ymag",[new m(r.X5.ANIMATIONTYPE_FLOAT,"orthoBottom",u,(()=>1)),new m(r.X5.ANIMATIONTYPE_FLOAT,"orthoTop",d,(()=>1))]),(0,a.ZU)("/cameras/{}/orthographic/zfar",[new m(r.X5.ANIMATIONTYPE_FLOAT,"maxZ",h,(()=>1))]),(0,a.ZU)("/cameras/{}/orthographic/znear",[new m(r.X5.ANIMATIONTYPE_FLOAT,"minZ",h,(()=>1))]),(0,a.ZU)("/cameras/{}/perspective/yfov",[new m(r.X5.ANIMATIONTYPE_FLOAT,"fov",h,(()=>1))]),(0,a.ZU)("/cameras/{}/perspective/zfar",[new m(r.X5.ANIMATIONTYPE_FLOAT,"maxZ",h,(()=>1))]),(0,a.ZU)("/cameras/{}/perspective/znear",[new m(r.X5.ANIMATIONTYPE_FLOAT,"minZ",h,(()=>1))]),(0,a.ZU)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new f(r.X5.ANIMATIONTYPE_COLOR3,"albedoColor",c,(()=>4)),new f(r.X5.ANIMATIONTYPE_FLOAT,"alpha",(function(e,t,n,s){return t[n+3]*s}),(()=>4))]),(0,a.ZU)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new f(r.X5.ANIMATIONTYPE_FLOAT,"metallic",h,(()=>1))]),(0,a.ZU)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new f(r.X5.ANIMATIONTYPE_FLOAT,"roughness",h,(()=>1))]);const b=_("albedoTexture");(0,a.ZU)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",b.scale),(0,a.ZU)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",b.offset),(0,a.ZU)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",b.rotation);const y=_("metallicTexture");(0,a.ZU)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",y.scale),(0,a.ZU)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",y.offset),(0,a.ZU)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",y.rotation),(0,a.ZU)("/materials/{}/emissiveFactor",[new f(r.X5.ANIMATIONTYPE_COLOR3,"emissiveColor",c,(()=>3))]);const x=_("bumpTexture");(0,a.ZU)("/materials/{}/normalTexture/scale",[new f(r.X5.ANIMATIONTYPE_FLOAT,"bumpTexture.level",h,(()=>1))]),(0,a.ZU)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",x.scale),(0,a.ZU)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",x.offset),(0,a.ZU)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",x.rotation),(0,a.ZU)("/materials/{}/occlusionTexture/strength",[new f(r.X5.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",h,(()=>1))]);const T=_("ambientTexture");(0,a.ZU)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",T.scale),(0,a.ZU)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",T.offset),(0,a.ZU)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",T.rotation);const A=_("emissiveTexture");(0,a.ZU)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",A.scale),(0,a.ZU)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",A.offset),(0,a.ZU)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",A.rotation),(0,a.ZU)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new f(r.X5.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",h,(()=>1))]),(0,a.ZU)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new f(r.X5.ANIMATIONTYPE_FLOAT,"anisotropy.angle",h,(()=>1))]);const v=_("anisotropy.texture");(0,a.ZU)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",v.scale),(0,a.ZU)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",v.offset),(0,a.ZU)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",v.rotation),(0,a.ZU)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new f(r.X5.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",h,(()=>1))]),(0,a.ZU)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new f(r.X5.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",h,(()=>1))]);const w=_("clearCoat.texture");(0,a.ZU)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",w.scale),(0,a.ZU)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",w.offset),(0,a.ZU)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",w.rotation);const C=_("clearCoat.bumpTexture");(0,a.ZU)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new f(r.X5.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",h,(()=>1))]),(0,a.ZU)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",C.scale),(0,a.ZU)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",C.offset),(0,a.ZU)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",C.rotation);const O=_("clearCoat.textureRoughness");(0,a.ZU)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",O.scale),(0,a.ZU)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",O.offset),(0,a.ZU)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",O.rotation),(0,a.ZU)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new f(r.X5.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",h,(()=>1))]),(0,a.ZU)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new f(r.X5.ANIMATIONTYPE_FLOAT,"emissiveIntensity",h,(()=>1))]),(0,a.ZU)("/materials/{}/extensions/KHR_materials_ior/ior",[new f(r.X5.ANIMATIONTYPE_FLOAT,"indexOfRefraction",h,(()=>1))]),(0,a.ZU)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new f(r.X5.ANIMATIONTYPE_FLOAT,"iridescence.intensity",h,(()=>1))]),(0,a.ZU)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new f(r.X5.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",h,(()=>1))]),(0,a.ZU)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new f(r.X5.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",h,(()=>1))]),(0,a.ZU)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new f(r.X5.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",h,(()=>1))]);const M=_("iridescence.texture");(0,a.ZU)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",M.scale),(0,a.ZU)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",M.offset),(0,a.ZU)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",M.rotation);const E=_("iridescence.thicknessTexture");(0,a.ZU)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",E.scale),(0,a.ZU)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",E.offset),(0,a.ZU)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",E.rotation),(0,a.ZU)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new f(r.X5.ANIMATIONTYPE_COLOR3,"sheen.color",c,(()=>3))]),(0,a.ZU)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new f(r.X5.ANIMATIONTYPE_FLOAT,"sheen.roughness",h,(()=>1))]);const F=_("sheen.texture");(0,a.ZU)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",F.scale),(0,a.ZU)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",F.offset),(0,a.ZU)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",F.rotation);const P=_("sheen.textureRoughness");(0,a.ZU)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",P.scale),(0,a.ZU)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",P.offset),(0,a.ZU)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",P.rotation),(0,a.ZU)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new f(r.X5.ANIMATIONTYPE_FLOAT,"metallicF0Factor",h,(()=>1))]),(0,a.ZU)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new f(r.X5.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",c,(()=>3))]);const R=_("metallicReflectanceTexture");(0,a.ZU)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",R.scale),(0,a.ZU)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",R.offset),(0,a.ZU)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",R.rotation);const I=_("reflectanceTexture");(0,a.ZU)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",I.scale),(0,a.ZU)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",I.offset),(0,a.ZU)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",I.rotation),(0,a.ZU)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new f(r.X5.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",h,(()=>1))]);const k=_("subSurface.refractionIntensityTexture");(0,a.ZU)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",k.scale),(0,a.ZU)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",k.offset),(0,a.ZU)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",k.rotation),(0,a.ZU)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new f(r.X5.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",c,(()=>3))]),(0,a.ZU)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new f(r.X5.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",h,(()=>1))]),(0,a.ZU)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new f(r.X5.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",h,(()=>1))]);const L=_("subSurface.thicknessTexture");(0,a.ZU)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",L.scale),(0,a.ZU)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",L.offset),(0,a.ZU)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",L.rotation),(0,a.ZU)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new f(r.X5.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",h,(()=>1))]);const B=_("subSurface.translucencyIntensityTexture");(0,a.ZU)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",B.scale),(0,a.ZU)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",B.offset),(0,a.ZU)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",B.rotation),(0,a.ZU)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new f(r.X5.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",c,(()=>3))]);const S=_("subSurface.translucencyColorTexture");(0,a.ZU)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",S.scale),(0,a.ZU)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",S.offset),(0,a.ZU)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",S.rotation),(0,a.ZU)("/extensions/KHR_lights_punctual/lights/{}/color",[new g(r.X5.ANIMATIONTYPE_COLOR3,"diffuse",c,(()=>3))]),(0,a.ZU)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new g(r.X5.ANIMATIONTYPE_FLOAT,"intensity",h,(()=>1))]),(0,a.ZU)("/extensions/KHR_lights_punctual/lights/{}/range",[new g(r.X5.ANIMATIONTYPE_FLOAT,"range",h,(()=>1))]),(0,a.ZU)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new g(r.X5.ANIMATIONTYPE_FLOAT,"innerAngle",p,(()=>1))]),(0,a.ZU)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new g(r.X5.ANIMATIONTYPE_FLOAT,"angle",p,(()=>1))]),(0,a.ZU)("/nodes/{}/extensions/EXT_lights_ies/color",[new g(r.X5.ANIMATIONTYPE_COLOR3,"diffuse",c,(()=>3))]),(0,a.ZU)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new g(r.X5.ANIMATIONTYPE_FLOAT,"intensity",h,(()=>1))]);const N="KHR_animation_pointer";class G{constructor(e){this.name=N,this._loader=e,this._pathToObjectConverter=(0,a.Wt)(this._loader.gltf)}get enabled(){return this._loader.isExtensionUsed(N)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(e,t,n,o,a){const r=o.target.extensions?.KHR_animation_pointer;if(!r||!this._pathToObjectConverter)return null;"pointer"!==o.target.path&&s.V.Warn(`${e}/target/path: Value (${o.target.path}) must be (pointer) when using the ${this.name} extension`),null!=o.target.node&&s.V.Warn(`${e}/target/node: Value (${o.target.node}) must not be present when using the ${this.name} extension`);const i=`${e}/extensions/${this.name}`,l=r.pointer;if(!l)throw new Error(`${i}: Pointer is missing`);try{const s=this._pathToObjectConverter.convert(l);if(!s.info.interpolation)throw new Error(`${i}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(e,t,n,o,{object:s.object,info:s.info.interpolation},a)}catch(e){return s.V.Warn(`${i}/pointer: Invalid pointer (${l}) skipped`),null}}}(0,o.Hg)(N),(0,o.Ye)(N,!0,(e=>new G(e)))},3096:(e,t,n)=>{n.d(t,{MSFT_minecraftMesh:()=>i});var s=n(23975),o=n(45316),a=n(37812);const r="MSFT_minecraftMesh";class i{constructor(e){this.name=r,this._loader=e,this.enabled=this._loader.isExtensionUsed(r)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,t,n){return o.BT.LoadExtraAsync(e,t,this.name,((o,a)=>{if(a){if(!(n instanceof s.Y))throw new Error(`${o}: Material type not supported`);const a=this._loader.loadMaterialPropertiesAsync(e,t,n);return n.needAlphaBlending()&&(n.forceDepthWrite=!0,n.separateCullingPass=!0),n.backFaceCulling=n.forceDepthWrite,n.twoSidedLighting=!0,a}return null}))}}(0,a.Hg)(r),(0,a.Ye)(r,!0,(e=>new i(e)))},6122:(e,t,n)=>{n.d(t,{KHR_texture_basisu:()=>r});var s=n(45316),o=n(37812);const a="KHR_texture_basisu";class r{constructor(e){this.name=a,this._loader=e,this.enabled=e.isExtensionUsed(a)}dispose(){this._loader=null}_loadTextureAsync(e,t,n){return s.BT.LoadExtensionAsync(e,t,this.name,((o,a)=>{const r=null==t.sampler?s.BT.DefaultSampler:s.l2.Get(`${e}/sampler`,this._loader.gltf.samplers,t.sampler),i=s.l2.Get(`${o}/source`,this._loader.gltf.images,a.source);return this._loader._createTextureAsync(e,r,i,(e=>{n(e)}),t._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!t._textureInfo.nonColorData)}))}}(0,o.Hg)(a),(0,o.Ye)(a,!0,(e=>new r(e)))},6804:(e,t,n)=>{n.d(t,{KHR_materials_clearcoat:()=>i});var s=n(23975),o=n(45316),a=n(37812);const r="KHR_materials_clearcoat";class i{constructor(e){this.name=r,this.order=190,this._loader=e,this.enabled=this._loader.isExtensionUsed(r)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,t,n){return o.BT.LoadExtensionAsync(e,t,this.name,((s,o)=>{const a=new Array;return a.push(this._loader.loadMaterialPropertiesAsync(e,t,n)),a.push(this._loadClearCoatPropertiesAsync(s,o,n)),Promise.all(a).then((()=>{}))}))}_loadClearCoatPropertiesAsync(e,t,n){if(!(n instanceof s.Y))throw new Error(`${e}: Material type not supported`);const o=new Array;return n.clearCoat.isEnabled=!0,n.clearCoat.useRoughnessFromMainTexture=!1,n.clearCoat.remapF0OnInterfaceChange=!1,null!=t.clearcoatFactor?n.clearCoat.intensity=t.clearcoatFactor:n.clearCoat.intensity=0,t.clearcoatTexture&&o.push(this._loader.loadTextureInfoAsync(`${e}/clearcoatTexture`,t.clearcoatTexture,(e=>{e.name=`${n.name} (ClearCoat)`,n.clearCoat.texture=e}))),null!=t.clearcoatRoughnessFactor?n.clearCoat.roughness=t.clearcoatRoughnessFactor:n.clearCoat.roughness=0,t.clearcoatRoughnessTexture&&(t.clearcoatRoughnessTexture.nonColorData=!0,o.push(this._loader.loadTextureInfoAsync(`${e}/clearcoatRoughnessTexture`,t.clearcoatRoughnessTexture,(e=>{e.name=`${n.name} (ClearCoat Roughness)`,n.clearCoat.textureRoughness=e})))),t.clearcoatNormalTexture&&(t.clearcoatNormalTexture.nonColorData=!0,o.push(this._loader.loadTextureInfoAsync(`${e}/clearcoatNormalTexture`,t.clearcoatNormalTexture,(e=>{e.name=`${n.name} (ClearCoat Normal)`,n.clearCoat.bumpTexture=e}))),n.invertNormalMapX=!n.getScene().useRightHandedSystem,n.invertNormalMapY=n.getScene().useRightHandedSystem,null!=t.clearcoatNormalTexture.scale&&(n.clearCoat.bumpTexture.level=t.clearcoatNormalTexture.scale)),Promise.all(o).then((()=>{}))}}(0,a.Hg)(r),(0,a.Ye)(r,!0,(e=>new i(e)))},6996:(e,t,n)=>{n.d(t,{OBJFileLoader:()=>b});var s=n(79923),o=n(998),a=n(15909),r=n(97889),i=n(22412),l=n(26041),c=n(7481),h=n(2093);class u{constructor(){this.materials=[]}parseMTL(e,t,n,s){if(t instanceof ArrayBuffer)return;const o=t.split("\n"),a=/\s+/;let r,i=null;for(let t=0;t<o.length;t++){const c=o[t].trim();if(0===c.length||"#"===c.charAt(0))continue;const d=c.indexOf(" ");let p=d>=0?c.substring(0,d):c;p=p.toLowerCase();const _=d>=0?c.substring(d+1).trim():"";if("newmtl"===p)i&&this.materials.push(i),e._blockEntityCollection=!!s,i=new h.F(_,e),i._parentContainer=s,e._blockEntityCollection=!1;else if("kd"===p&&i)r=_.split(a,3).map(parseFloat),i.diffuseColor=l.v9.FromArray(r);else if("ka"===p&&i)r=_.split(a,3).map(parseFloat),i.ambientColor=l.v9.FromArray(r);else if("ks"===p&&i)r=_.split(a,3).map(parseFloat),i.specularColor=l.v9.FromArray(r);else if("ke"===p&&i)r=_.split(a,3).map(parseFloat),i.emissiveColor=l.v9.FromArray(r);else if("ns"===p&&i)i.specularPower=parseFloat(_);else if("d"===p&&i)i.alpha=parseFloat(_);else if("map_ka"===p&&i)i.ambientTexture=u._GetTexture(n,_,e);else if("map_kd"===p&&i)i.diffuseTexture=u._GetTexture(n,_,e);else if("map_ks"===p&&i)i.specularTexture=u._GetTexture(n,_,e);else if("map_ns"===p);else if("map_bump"===p&&i){const t=_.split(a),s=t.indexOf("-bm");let o=null;s>=0&&(o=t[s+1],t.splice(s,2)),i.bumpTexture=u._GetTexture(n,t.join(" "),e),i.bumpTexture&&null!==o&&(i.bumpTexture.level=parseFloat(o))}else"map_d"===p&&i&&(i.opacityTexture=u._GetTexture(n,_,e))}i&&this.materials.push(i)}static _GetTexture(e,t,n){if(!t)return null;let s=e;if("file:"===e){let e=t.lastIndexOf("\\");-1===e&&(e=t.lastIndexOf("/")),s+=e>-1?t.substring(e+1):t}else s+=t;return new c.g(s,n,!1,u.INVERT_TEXTURE_Y)}}u.INVERT_TEXTURE_Y=!0;var d=n(95616),p=n(27050),_=n(76595),m=n(36803),f=n(51137);class g{constructor(e,t,n){this._positions=[],this._normals=[],this._uvs=[],this._colors=[],this._extColors=[],this._meshesFromObj=[],this._indicesForBabylon=[],this._wrappedPositionForBabylon=[],this._wrappedUvsForBabylon=[],this._wrappedColorsForBabylon=[],this._wrappedNormalsForBabylon=[],this._tuplePosNorm=[],this._curPositionInIndices=0,this._hasMeshes=!1,this._unwrappedPositionsForBabylon=[],this._unwrappedColorsForBabylon=[],this._unwrappedNormalsForBabylon=[],this._unwrappedUVForBabylon=[],this._triangles=[],this._materialNameFromObj="",this._objMeshName="",this._increment=1,this._isFirstMaterial=!0,this._grayColor=new l.ov(.5,.5,.5,1),this._hasLineData=!1,this._materialToUse=e,this._babylonMeshesArray=t,this._loadingOptions=n}_isInArray(e,t){e[t[0]]||(e[t[0]]={normals:[],idx:[]});const n=e[t[0]].normals.indexOf(t[1]);return-1===n?-1:e[t[0]].idx[n]}_isInArrayUV(e,t){e[t[0]]||(e[t[0]]={normals:[],idx:[],uv:[]});const n=e[t[0]].normals.indexOf(t[1]);return 1!=n&&t[2]===e[t[0]].uv[n]?e[t[0]].idx[n]:-1}_setData(e,t,n,o,a,r,i){let l;l=this._loadingOptions.optimizeWithUV?this._isInArrayUV(this._tuplePosNorm,[e,n,t]):this._isInArray(this._tuplePosNorm,[e,n]),-1===l?(this._indicesForBabylon.push(this._wrappedPositionForBabylon.length),this._wrappedPositionForBabylon.push(o),a=a??new s.I9(0,0),this._wrappedUvsForBabylon.push(a),this._wrappedNormalsForBabylon.push(r),void 0!==i&&this._wrappedColorsForBabylon.push(i),this._tuplePosNorm[e].normals.push(n),this._tuplePosNorm[e].idx.push(this._curPositionInIndices++),this._loadingOptions.optimizeWithUV&&this._tuplePosNorm[e].uv.push(t)):this._indicesForBabylon.push(l)}_unwrapData(){try{for(let e=0;e<this._wrappedPositionForBabylon.length;e++)this._unwrappedPositionsForBabylon.push(this._wrappedPositionForBabylon[e].x*this._handednessSign,this._wrappedPositionForBabylon[e].y,this._wrappedPositionForBabylon[e].z),this._unwrappedNormalsForBabylon.push(this._wrappedNormalsForBabylon[e].x*this._handednessSign,this._wrappedNormalsForBabylon[e].y,this._wrappedNormalsForBabylon[e].z),this._unwrappedUVForBabylon.push(this._wrappedUvsForBabylon[e].x,this._wrappedUvsForBabylon[e].y),this._loadingOptions.importVertexColors&&this._unwrappedColorsForBabylon.push(this._wrappedColorsForBabylon[e].r,this._wrappedColorsForBabylon[e].g,this._wrappedColorsForBabylon[e].b,this._wrappedColorsForBabylon[e].a);this._wrappedPositionForBabylon.length=0,this._wrappedNormalsForBabylon.length=0,this._wrappedUvsForBabylon.length=0,this._wrappedColorsForBabylon.length=0,this._tuplePosNorm.length=0,this._curPositionInIndices=0}catch(e){throw new Error("Unable to unwrap data while parsing OBJ data.")}}_getTriangles(e,t){for(let n=t;n<e.length-1;n++)this._pushTriangle(e,n)}_getColor(e){return this._loadingOptions.importVertexColors?this._extColors[e]??this._colors[e]:void 0}_setDataForCurrentFaceWithPattern1(e,t){this._getTriangles(e,t);for(let e=0;e<this._triangles.length;e++){const t=parseInt(this._triangles[e])-1;this._setData(t,0,0,this._positions[t],s.I9.Zero(),s.Pq.Up(),this._getColor(t))}this._triangles.length=0}_setDataForCurrentFaceWithPattern2(e,t){this._getTriangles(e,t);for(let e=0;e<this._triangles.length;e++){const t=this._triangles[e].split("/"),n=parseInt(t[0])-1,o=parseInt(t[1])-1;this._setData(n,o,0,this._positions[n],this._uvs[o]??s.I9.Zero(),s.Pq.Up(),this._getColor(n))}this._triangles.length=0}_setDataForCurrentFaceWithPattern3(e,t){this._getTriangles(e,t);for(let e=0;e<this._triangles.length;e++){const t=this._triangles[e].split("/"),n=parseInt(t[0])-1,o=parseInt(t[1])-1,a=parseInt(t[2])-1;this._setData(n,o,a,this._positions[n],this._uvs[o]??s.I9.Zero(),this._normals[a]??s.Pq.Up())}this._triangles.length=0}_setDataForCurrentFaceWithPattern4(e,t){this._getTriangles(e,t);for(let e=0;e<this._triangles.length;e++){const t=this._triangles[e].split("//"),n=parseInt(t[0])-1,o=parseInt(t[1])-1;this._setData(n,1,o,this._positions[n],s.I9.Zero(),this._normals[o],this._getColor(n))}this._triangles.length=0}_setDataForCurrentFaceWithPattern5(e,t){this._getTriangles(e,t);for(let e=0;e<this._triangles.length;e++){const t=this._triangles[e].split("/"),n=this._positions.length+parseInt(t[0]),s=this._uvs.length+parseInt(t[1]),o=this._normals.length+parseInt(t[2]);this._setData(n,s,o,this._positions[n],this._uvs[s],this._normals[o],this._getColor(n))}this._triangles.length=0}_addPreviousObjMesh(){this._meshesFromObj.length>0&&(this._handledMesh=this._meshesFromObj[this._meshesFromObj.length-1],this._unwrapData(),this._loadingOptions.useLegacyBehavior&&this._indicesForBabylon.reverse(),this._handledMesh.indices=this._indicesForBabylon.slice(),this._handledMesh.positions=this._unwrappedPositionsForBabylon.slice(),this._handledMesh.normals=this._unwrappedNormalsForBabylon.slice(),this._handledMesh.uvs=this._unwrappedUVForBabylon.slice(),this._handledMesh.hasLines=this._hasLineData,this._loadingOptions.importVertexColors&&(this._handledMesh.colors=this._unwrappedColorsForBabylon.slice()),this._indicesForBabylon.length=0,this._unwrappedPositionsForBabylon.length=0,this._unwrappedColorsForBabylon.length=0,this._unwrappedNormalsForBabylon.length=0,this._unwrappedUVForBabylon.length=0,this._hasLineData=!1)}_optimizeNormals(e){const t=e.getVerticesData(d.R.PositionKind),n=e.getVerticesData(d.R.NormalKind),o={};if(!t||!n)return;for(let e=0;e<t.length/3;e++){const n=t[3*e+0]+"_"+t[3*e+1]+"_"+t[3*e+2];let s=o[n];s||(s=[],o[n]=s),s.push(e)}const a=new s.Pq;for(const e in o){const t=o[e];if(t.length<2)continue;const s=t[0];for(let e=1;e<t.length;++e){const o=t[e];n[3*s+0]+=n[3*o+0],n[3*s+1]+=n[3*o+1],n[3*s+2]+=n[3*o+2]}a.copyFromFloats(n[3*s+0],n[3*s+1],n[3*s+2]),a.normalize();for(let e=0;e<t.length;++e){const s=t[e];n[3*s+0]=a.x,n[3*s+1]=a.y,n[3*s+2]=a.z}}e.setVerticesData(d.R.NormalKind,n)}static _IsLineElement(e){return e.startsWith("l")}static _IsObjectElement(e){return e.startsWith("o")}static _IsGroupElement(e){return e.startsWith("g")}static _GetZbrushMRGB(e,t){if(!e.startsWith("mrgb"))return null;if(e=e.replace("mrgb","").trim(),t)return[];const n=e.match(/[a-z0-9]/g);if(!n||n.length%8!=0)return[];const s=[];for(let e=0;e<n.length/8;e++){const t=n[8*e+2]+n[8*e+3],o=n[8*e+4]+n[8*e+5],a=n[8*e+6]+n[8*e+7];s.push(new l.ov(parseInt(t,16)/255,parseInt(o,16)/255,parseInt(a,16)/255,1))}return s}parse(e,t,n,o,a){t=(t=t.replace(/#MRGB/g,"mrgb")).replace(/#.*$/gm,"").trim(),this._loadingOptions.useLegacyBehavior?(this._pushTriangle=(e,t)=>this._triangles.push(e[0],e[t],e[t+1]),this._handednessSign=1):n.useRightHandedSystem?(this._pushTriangle=(e,t)=>this._triangles.push(e[0],e[t+1],e[t]),this._handednessSign=1):(this._pushTriangle=(e,t)=>this._triangles.push(e[0],e[t],e[t+1]),this._handednessSign=-1);const r=t.split("\n"),i=[];let c=[];i.push(c);for(let e=0;e<r.length;e++){const t=r[e].trim().replace(/\s\s/g," ");if(0!==t.length&&"#"!==t.charAt(0))if((g._IsGroupElement(t)||g._IsObjectElement(t))&&(c=[],i.push(c)),g._IsLineElement(t)){const e=t.split(" ");for(let t=1;t<e.length-1;t++)c.push(`l ${e[t]} ${e[t+1]}`)}else c.push(t)}const u=i.flat();for(let e=0;e<u.length;e++){const t=u[e].trim().replace(/\s\s/g," ");let n;if(0!==t.length&&"#"!==t.charAt(0))if(g.VertexPattern.test(t)){if(n=t.match(/[^ ]+/g),this._positions.push(new s.Pq(parseFloat(n[1]),parseFloat(n[2]),parseFloat(n[3]))),this._loadingOptions.importVertexColors)if(n.length>=7){const e=parseFloat(n[4]),t=parseFloat(n[5]),s=parseFloat(n[6]);this._colors.push(new l.ov(e>1?e/255:e,t>1?t/255:t,s>1?s/255:s,7===n.length||void 0===n[7]?1:parseFloat(n[7])))}else this._colors.push(this._grayColor)}else if(null!==(n=g.NormalPattern.exec(t)))this._normals.push(new s.Pq(parseFloat(n[1]),parseFloat(n[2]),parseFloat(n[3])));else if(null!==(n=g.UVPattern.exec(t)))this._uvs.push(new s.I9(parseFloat(n[1])*this._loadingOptions.UVScaling.x,parseFloat(n[2])*this._loadingOptions.UVScaling.y));else if(null!==(n=g.FacePattern3.exec(t)))this._setDataForCurrentFaceWithPattern3(n[1].trim().split(" "),1);else if(null!==(n=g.FacePattern4.exec(t)))this._setDataForCurrentFaceWithPattern4(n[1].trim().split(" "),1);else if(null!==(n=g.FacePattern5.exec(t)))this._setDataForCurrentFaceWithPattern5(n[1].trim().split(" "),1);else if(null!==(n=g.FacePattern2.exec(t)))this._setDataForCurrentFaceWithPattern2(n[1].trim().split(" "),1);else if(null!==(n=g.FacePattern1.exec(t)))this._setDataForCurrentFaceWithPattern1(n[1].trim().split(" "),1);else if(null!==(n=g.LinePattern1.exec(t)))this._setDataForCurrentFaceWithPattern1(n[1].trim().split(" "),0),this._hasLineData=!0;else if(null!==(n=g.LinePattern2.exec(t)))this._setDataForCurrentFaceWithPattern2(n[1].trim().split(" "),0),this._hasLineData=!0;else if(n=g._GetZbrushMRGB(t,!this._loadingOptions.importVertexColors))n.forEach((e=>{this._extColors.push(e)}));else if(null!==(n=g.LinePattern3.exec(t)))this._setDataForCurrentFaceWithPattern3(n[1].trim().split(" "),0),this._hasLineData=!0;else if(g.GroupDescriptor.test(t)||g.ObjectDescriptor.test(t)){const e={name:t.substring(2).trim(),indices:null,positions:null,normals:null,uvs:null,colors:null,materialName:this._materialNameFromObj,isObject:g.ObjectDescriptor.test(t)};this._addPreviousObjMesh(),this._meshesFromObj.push(e),this._hasMeshes=!0,this._isFirstMaterial=!0,this._increment=1}else if(g.UseMtlDescriptor.test(t)){if(this._materialNameFromObj=t.substring(7).trim(),!this._isFirstMaterial||!this._hasMeshes){this._addPreviousObjMesh();const e={name:(this._objMeshName||"mesh")+"_mm"+this._increment.toString(),indices:null,positions:null,normals:null,uvs:null,colors:null,materialName:this._materialNameFromObj,isObject:!1};this._increment++,this._meshesFromObj.push(e),this._hasMeshes=!0}this._hasMeshes&&this._isFirstMaterial&&(this._meshesFromObj[this._meshesFromObj.length-1].materialName=this._materialNameFromObj,this._isFirstMaterial=!1)}else g.MtlLibGroupDescriptor.test(t)?a(t.substring(7).trim()):g.SmoothDescriptor.test(t)||f.V.Log("Unhandled expression at line : "+t)}if(this._hasMeshes&&(this._handledMesh=this._meshesFromObj[this._meshesFromObj.length-1],this._loadingOptions.useLegacyBehavior&&this._indicesForBabylon.reverse(),this._unwrapData(),this._handledMesh.indices=this._indicesForBabylon,this._handledMesh.positions=this._unwrappedPositionsForBabylon,this._handledMesh.normals=this._unwrappedNormalsForBabylon,this._handledMesh.uvs=this._unwrappedUVForBabylon,this._handledMesh.hasLines=this._hasLineData,this._loadingOptions.importVertexColors&&(this._handledMesh.colors=this._unwrappedColorsForBabylon)),!this._hasMeshes){let e=null;if(this._indicesForBabylon.length)this._loadingOptions.useLegacyBehavior&&this._indicesForBabylon.reverse(),this._unwrapData();else{for(const e of this._positions)this._unwrappedPositionsForBabylon.push(e.x,e.y,e.z);if(this._normals.length)for(const e of this._normals)this._unwrappedNormalsForBabylon.push(e.x,e.y,e.z);if(this._uvs.length)for(const e of this._uvs)this._unwrappedUVForBabylon.push(e.x,e.y);if(this._extColors.length)for(const e of this._extColors)this._unwrappedColorsForBabylon.push(e.r,e.g,e.b,e.a);else if(this._colors.length)for(const e of this._colors)this._unwrappedColorsForBabylon.push(e.r,e.g,e.b,e.a);this._materialNameFromObj||(e=new h.F(p.V.RandomId(),n),e.pointsCloud=!0,this._materialNameFromObj=e.name,this._normals.length||(e.disableLighting=!0,e.emissiveColor=l.v9.White()))}this._meshesFromObj.push({name:p.V.RandomId(),indices:this._indicesForBabylon,positions:this._unwrappedPositionsForBabylon,colors:this._unwrappedColorsForBabylon,normals:this._unwrappedNormalsForBabylon,uvs:this._unwrappedUVForBabylon,materialName:this._materialNameFromObj,directMaterial:e,isObject:!0,hasLines:this._hasLineData})}for(let t=0;t<this._meshesFromObj.length;t++){if(e&&this._meshesFromObj[t].name)if(e instanceof Array){if(-1===e.indexOf(this._meshesFromObj[t].name))continue}else if(this._meshesFromObj[t].name!==e)continue;this._handledMesh=this._meshesFromObj[t],n._blockEntityCollection=!!o;const s=new _.e(this._meshesFromObj[t].name,n);if(s._parentContainer=o,n._blockEntityCollection=!1,this._handledMesh._babylonMesh=s,!this._handledMesh.isObject)for(let e=t-1;e>=0;--e)if(this._meshesFromObj[e].isObject&&this._meshesFromObj[e]._babylonMesh){s.parent=this._meshesFromObj[e]._babylonMesh;break}if(this._materialToUse.push(this._meshesFromObj[t].materialName),this._handledMesh.hasLines&&(s._internalMetadata??(s._internalMetadata={}),s._internalMetadata._isLine=!0),0===this._handledMesh.positions?.length){this._babylonMeshesArray.push(s);continue}const a=new m.P;if(a.uvs=this._handledMesh.uvs,a.indices=this._handledMesh.indices,a.positions=this._handledMesh.positions,this._loadingOptions.computeNormals){const e=new Array;m.P.ComputeNormals(this._handledMesh.positions,this._handledMesh.indices,e),a.normals=e}else a.normals=this._handledMesh.normals;this._loadingOptions.importVertexColors&&(a.colors=this._handledMesh.colors),a.applyToMesh(s),this._loadingOptions.invertY&&(s.scaling.y*=-1),this._loadingOptions.optimizeNormals&&this._optimizeNormals(s),this._babylonMeshesArray.push(s),this._handledMesh.directMaterial&&(s.material=this._handledMesh.directMaterial)}}}g.ObjectDescriptor=/^o/,g.GroupDescriptor=/^g/,g.MtlLibGroupDescriptor=/^mtllib /,g.UseMtlDescriptor=/^usemtl /,g.SmoothDescriptor=/^s /,g.VertexPattern=/^v(\s+[\d|.|+|\-|e|E]+){3,7}/,g.NormalPattern=/^vn(\s+[\d|.|+|\-|e|E]+)( +[\d|.|+|\-|e|E]+)( +[\d|.|+|\-|e|E]+)/,g.UVPattern=/^vt(\s+[\d|.|+|\-|e|E]+)( +[\d|.|+|\-|e|E]+)/,g.FacePattern1=/^f\s+(([\d]{1,}[\s]?){3,})+/,g.FacePattern2=/^f\s+((([\d]{1,}\/[\d]{1,}[\s]?){3,})+)/,g.FacePattern3=/^f\s+((([\d]{1,}\/[\d]{1,}\/[\d]{1,}[\s]?){3,})+)/,g.FacePattern4=/^f\s+((([\d]{1,}\/\/[\d]{1,}[\s]?){3,})+)/,g.FacePattern5=/^f\s+(((-[\d]{1,}\/-[\d]{1,}\/-[\d]{1,}[\s]?){3,})+)/,g.LinePattern1=/^l\s+(([\d]{1,}[\s]?){2,})+/,g.LinePattern2=/^l\s+((([\d]{1,}\/[\d]{1,}[\s]?){2,})+)/,g.LinePattern3=/^l\s+((([\d]{1,}\/[\d]{1,}\/[\d]{1,}[\s]?){2,})+)/;class b{static get INVERT_TEXTURE_Y(){return u.INVERT_TEXTURE_Y}static set INVERT_TEXTURE_Y(e){u.INVERT_TEXTURE_Y=e}constructor(e){this.name=i.M.name,this.extensions=i.M.extensions,this._assetContainer=null,this._loadingOptions={...b._DefaultLoadingOptions,...e??{}}}static get _DefaultLoadingOptions(){return{computeNormals:b.COMPUTE_NORMALS,optimizeNormals:b.OPTIMIZE_NORMALS,importVertexColors:b.IMPORT_VERTEX_COLORS,invertY:b.INVERT_Y,invertTextureY:b.INVERT_TEXTURE_Y,UVScaling:b.UV_SCALING,materialLoadingFailsSilently:b.MATERIAL_LOADING_FAILS_SILENTLY,optimizeWithUV:b.OPTIMIZE_WITH_UV,skipMaterials:b.SKIP_MATERIALS,useLegacyBehavior:b.USE_LEGACY_BEHAVIOR}}_loadMTL(e,t,n,s){const a=t+e;o.S0.LoadFile(a,n,void 0,void 0,!1,((e,t)=>{s(a,t)}))}createPlugin(e){return new b(e[i.M.name])}canDirectLoad(){return!1}importMeshAsync(e,t,n,s){return this._parseSolid(e,t,n,s).then((e=>({meshes:e,particleSystems:[],skeletons:[],animationGroups:[],transformNodes:[],geometries:[],lights:[],spriteManagers:[]})))}loadAsync(e,t,n){return this.importMeshAsync(null,e,t,n).then((()=>{}))}loadAssetContainerAsync(e,t,n){const s=new r.WZ(e);return this._assetContainer=s,this.importMeshAsync(null,e,t,n).then((e=>(e.meshes.forEach((e=>s.meshes.push(e))),e.meshes.forEach((e=>{const t=e.material;t&&-1==s.materials.indexOf(t)&&(s.materials.push(t),t.getActiveTextures().forEach((e=>{-1==s.textures.indexOf(e)&&s.textures.push(e)})))})),this._assetContainer=null,s))).catch((e=>{throw this._assetContainer=null,e}))}_parseSolid(e,t,n,s){let a="";const r=new u,i=[],l=[];n=n.replace(/#.*$/gm,"").trim(),new g(i,l,this._loadingOptions).parse(e,n,t,this._assetContainer,(e=>{a=e}));const c=[];return""===a||this._loadingOptions.skipMaterials||c.push(new Promise(((e,n)=>{this._loadMTL(a,s,(c=>{try{r.parseMTL(t,c,s,this._assetContainer);for(let e=0;e<r.materials.length;e++){let t=0;const n=[];let s;for(;(s=i.indexOf(r.materials[e].name,t))>-1;)n.push(s),t=s+1;if(-1===s&&0===n.length)r.materials[e].dispose();else for(let t=0;t<n.length;t++){const s=l[n[t]],o=r.materials[e];s.material=o,s.getTotalIndices()||(o.pointsCloud=!0)}}e()}catch(t){o.S0.Warn(`Error processing MTL file: '${a}'`),this._loadingOptions.materialLoadingFailsSilently?e():n(t)}}),((t,s)=>{o.S0.Warn(`Error downloading MTL file: '${a}'`),this._loadingOptions.materialLoadingFailsSilently?e():n(s)}))}))),Promise.all(c).then((()=>{const e=e=>Boolean(e._internalMetadata?._isLine??!1);return l.forEach((n=>{if(e(n)){let s=n.material??new h.F(n.name+"_line",t);s.getBindedMeshes().filter((t=>!e(t))).length>0&&(s=s.clone(s.name+"_line")??s),s.wireframe=!0,n.material=s,n._internalMetadata&&(n._internalMetadata._isLine=void 0)}})),l}))}}b.OPTIMIZE_WITH_UV=!0,b.INVERT_Y=!1,b.IMPORT_VERTEX_COLORS=!1,b.COMPUTE_NORMALS=!1,b.OPTIMIZE_NORMALS=!1,b.UV_SCALING=new s.I9(1,1),b.SKIP_MATERIALS=!1,b.MATERIAL_LOADING_FAILS_SILENTLY=!0,b.USE_LEGACY_BEHAVIOR=!1,(0,a.qS)(new b)},12032:(e,t,n)=>{n.d(t,{KHR_materials_anisotropy:()=>i});var s=n(23975),o=n(45316),a=n(37812);const r="KHR_materials_anisotropy";class i{constructor(e){this.name=r,this.order=195,this._loader=e,this.enabled=this._loader.isExtensionUsed(r)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,t,n){return o.BT.LoadExtensionAsync(e,t,this.name,((s,o)=>{const a=new Array;return a.push(this._loader.loadMaterialPropertiesAsync(e,t,n)),a.push(this._loadIridescencePropertiesAsync(s,o,n)),Promise.all(a).then((()=>{}))}))}_loadIridescencePropertiesAsync(e,t,n){if(!(n instanceof s.Y))throw new Error(`${e}: Material type not supported`);const o=new Array;return n.anisotropy.isEnabled=!0,n.anisotropy.intensity=t.anisotropyStrength??0,n.anisotropy.angle=t.anisotropyRotation??0,t.anisotropyTexture&&(t.anisotropyTexture.nonColorData=!0,o.push(this._loader.loadTextureInfoAsync(`${e}/anisotropyTexture`,t.anisotropyTexture,(e=>{e.name=`${n.name} (Anisotropy Intensity)`,n.anisotropy.texture=e})))),Promise.all(o).then((()=>{}))}}(0,a.Hg)(r),(0,a.Ye)(r,!0,(e=>new i(e)))},20718:(e,t,n)=>{n.d(t,{KHR_materials_iridescence:()=>i});var s=n(23975),o=n(45316),a=n(37812);const r="KHR_materials_iridescence";class i{constructor(e){this.name=r,this.order=195,this._loader=e,this.enabled=this._loader.isExtensionUsed(r)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,t,n){return o.BT.LoadExtensionAsync(e,t,this.name,((s,o)=>{const a=new Array;return a.push(this._loader.loadMaterialPropertiesAsync(e,t,n)),a.push(this._loadIridescencePropertiesAsync(s,o,n)),Promise.all(a).then((()=>{}))}))}_loadIridescencePropertiesAsync(e,t,n){if(!(n instanceof s.Y))throw new Error(`${e}: Material type not supported`);const o=new Array;return n.iridescence.isEnabled=!0,n.iridescence.intensity=t.iridescenceFactor??0,n.iridescence.indexOfRefraction=t.iridescenceIor??t.iridescenceIOR??1.3,n.iridescence.minimumThickness=t.iridescenceThicknessMinimum??100,n.iridescence.maximumThickness=t.iridescenceThicknessMaximum??400,t.iridescenceTexture&&o.push(this._loader.loadTextureInfoAsync(`${e}/iridescenceTexture`,t.iridescenceTexture,(e=>{e.name=`${n.name} (Iridescence)`,n.iridescence.texture=e}))),t.iridescenceThicknessTexture&&o.push(this._loader.loadTextureInfoAsync(`${e}/iridescenceThicknessTexture`,t.iridescenceThicknessTexture,(e=>{e.name=`${n.name} (Iridescence Thickness)`,n.iridescence.thicknessTexture=e}))),Promise.all(o).then((()=>{}))}}(0,a.Hg)(r),(0,a.Ye)(r,!0,(e=>new i(e)))},20935:(e,t,n)=>{n.d(t,{KHR_interactivity:()=>m});var s=n(84813),o=n(85048),a=n(37812),r=n(49532),i=n(48966),l=n(51137),c=n(38688);const h={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"Vector3",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class u{constructor(e,t,n){this._interactivityGraph=e,this._gltf=t,this._loader=n,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const e of this._interactivityGraph.types)this._types.push(h[e.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const e of this._interactivityGraph.declarations){const t=(0,i.KD)(e);if(!t)throw l.V.Error(["No mapping found for declaration",e]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:t,fullOperationName:e.extension?e.op+":"+e.extension:e.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const e of this._interactivityGraph.variables){const t=this._parseVariable(e);this._staticVariables.push(t)}}_parseVariable(e,t){const n=this._types[e.type];if(!n)throw l.V.Error(["No type found for variable",e]),new Error("Error parsing variables");if(e.value&&e.value.length!==n.length)throw l.V.Error(["Invalid value length for variable",e,n]),new Error("Error parsing variables");const s=e.value||[];if(!s.length)switch(n.flowGraphType){case"boolean":s.push(!1);break;case"FlowGraphInteger":s.push(0);break;case"number":s.push(NaN);break;case"Vector2":s.push(NaN,NaN);break;case"Vector3":s.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":s.fill(NaN,0,4);break;case"Matrix":s.fill(NaN,0,16);break;case"Matrix3D":s.fill(NaN,0,9)}return{type:n.flowGraphType,value:t?t(s,this):s}}_parseEvents(){if(this._interactivityGraph.events)for(const e of this._interactivityGraph.events){const t={eventId:e.id||"internalEvent_"+this._internalEventsCounter++};e.values&&(t.eventData=Object.keys(e.values).map((t=>{const n=e.values?.[t];if(!n)throw l.V.Error(["No value found for event key",t]),new Error("Error parsing events");const s=this._types[n.type];if(!s)throw l.V.Error(["No type found for event value",n]),new Error("Error parsing events");const o=void 0!==n.value?this._parseVariable(n):void 0;return{id:t,type:s.flowGraphType,eventData:!0,value:o}}))),this._events.push(t)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const e of this._interactivityGraph.nodes){if("number"!=typeof e.declaration)throw l.V.Error(["No declaration found for node",e]),new Error("Error parsing nodes");const t=this._mappings[e.declaration];if(!t)throw l.V.Error(["No mapping found for node",e]),new Error("Error parsing nodes");if(t.flowGraphMapping.validation&&!t.flowGraphMapping.validation(e,this._interactivityGraph,this._gltf))throw new Error(`Error validating interactivity node ${e}`);const n=[];for(const s of t.flowGraphMapping.blocks){const o=this._getEmptyBlock(s,t.fullOperationName);this._parseNodeConfiguration(e,o,t.flowGraphMapping,s),n.push(o)}this._nodes.push({blocks:n,fullOperationName:t.fullOperationName})}}_getEmptyBlock(e,t){return{uniqueId:(0,c.z)(),className:e,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:t,metadata:{}}}_parseNodeConfiguration(e,t,n,s){const o=t.config;e.configuration&&Object.keys(e.configuration).forEach((t=>{const a=e.configuration?.[t];if(!a)throw l.V.Error(["No value found for node configuration",t]),new Error("Error parsing node configuration");const r=n.configuration?.[t];if(r&&r.toBlock?r.toBlock===s:0===n.blocks.indexOf(s)){const e=r?.name||t;a&&void 0!==a.value||void 0===r?.defaultValue?a.value.length>=1?o[e]={value:1===a.value.length?a.value[0]:a.value}:l.V.Warn(["Invalid value for node configuration",a]):o[e]={value:r.defaultValue},r&&r.dataTransformer&&(o[e].value=r.dataTransformer([o[e].value],this)[0])}}))}_parseNodeConnections(e){for(let t=0;t<this._nodes.length;t++){const n=this._interactivityGraph.nodes?.[t];if(!n)throw l.V.Error(["No node found for interactivity node",this._nodes[t]]),new Error("Error parsing node connections");const s=this._nodes[t],o=this._mappings[n.declaration];if(!o)throw l.V.Error(["No mapping found for node",n]),new Error("Error parsing node connections");const a=n.flows||{},r=Object.keys(a).sort();for(const e of r){const t=a[e],n=o.flowGraphMapping.outputs?.flows?.[e],r=n?.name||e,c=this._createNewSocketConnection(r,!0);(n&&n.toBlock&&s.blocks.find((e=>e.className===n.toBlock))||s.blocks[0]).signalOutputs.push(c);const h=t.node,u=this._nodes[h];if(!u)throw l.V.Error(["No node found for input node id",h]),new Error("Error parsing node connections");const d=(0,i.X6)(u.fullOperationName);if(!d)throw l.V.Error(["No mapping found for input node",u]),new Error("Error parsing node connections");let p=d.inputs?.flows?.[t.socket||"in"],_=!1;if(!p)for(const e in d.inputs?.flows)e.startsWith("[")&&e.endsWith("]")&&(_=!0,p=d.inputs?.flows?.[e]);const m=p?_?p.name.replace("$1",t.socket||""):p.name:t.socket||"in",f=p&&p.toBlock&&u.blocks.find((e=>e.className===p.toBlock))||u.blocks[0];let g=f.signalInputs.find((e=>e.name===m));g||(g=this._createNewSocketConnection(m),f.signalInputs.push(g)),g.connectedPointIds.push(c.uniqueId),c.connectedPointIds.push(g.uniqueId)}const c=n.values||{},h=Object.keys(c);for(const t of h){const n=c[t];let a=o.flowGraphMapping.inputs?.values?.[t],r=!1;if(!a)for(const e in o.flowGraphMapping.inputs?.values)e.startsWith("[")&&e.endsWith("]")&&(r=!0,a=o.flowGraphMapping.inputs?.values?.[e]);const h=a?r?a.name.replace("$1",t):a.name:t,u=this._createNewSocketConnection(h);if((a&&a.toBlock&&s.blocks.find((e=>e.className===a.toBlock))||s.blocks[0]).dataInputs.push(u),void 0!==n.value){const t=this._parseVariable(n,a&&a.dataTransformer);e._connectionValues[u.uniqueId]=t}else{if(void 0===n.node)throw l.V.Error(["Invalid value for value connection",n]),new Error("Error parsing node connections");{const e=n.node,t=n.socket||"value",s=this._nodes[e];if(!s)throw l.V.Error(["No node found for output socket reference",n]),new Error("Error parsing node connections");const o=(0,i.X6)(s.fullOperationName);if(!o)throw l.V.Error(["No mapping found for output socket reference",n]),new Error("Error parsing node connections");let a=o.outputs?.values?.[t],r=!1;if(!a)for(const e in o.outputs?.values)e.startsWith("[")&&e.endsWith("]")&&(r=!0,a=o.outputs?.values?.[e]);const c=a?r?a.name.replace("$1",t):a?.name:t,h=a&&a.toBlock&&s.blocks.find((e=>e.className===a.toBlock))||s.blocks[0];let d=h.dataOutputs.find((e=>e.name===c));d||(d=this._createNewSocketConnection(c,!0),h.dataOutputs.push(d)),u.connectedPointIds.push(d.uniqueId),d.connectedPointIds.push(u.uniqueId)}}}if(o.flowGraphMapping.interBlockConnectors)for(const e of o.flowGraphMapping.interBlockConnectors){const t=e.input,n=e.output,o=e.isVariable;this._connectFlowGraphNodes(t,n,s.blocks[e.inputBlockIndex],s.blocks[e.outputBlockIndex],o)}if(o.flowGraphMapping.extraProcessor){const t=this._interactivityGraph.declarations?.[n.declaration];if(!t)throw l.V.Error(["No declaration found for extra processor",n]),new Error("Error parsing node connections");s.blocks=o.flowGraphMapping.extraProcessor(n,t,o.flowGraphMapping,this,s.blocks,e,this._gltf)}}}_createNewSocketConnection(e,t){return{uniqueId:(0,c.z)(),name:e,_connectionType:t?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(e,t,n,s,o){const a=o?n.dataInputs:n.signalInputs,r=o?s.dataOutputs:s.signalOutputs,i=a.find((t=>t.name===e))||this._createNewSocketConnection(e),l=r.find((e=>e.name===t))||this._createNewSocketConnection(t,!0);a.find((t=>t.name===e))||a.push(i),r.find((e=>e.name===t))||r.push(l),i.connectedPointIds.push(l.uniqueId),l.connectedPointIds.push(i.uniqueId)}getVariableName(e){return"staticVariable_"+e}serializeToFlowGraph(){const e={uniqueId:(0,c.z)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(e);for(let t=0;t<this._staticVariables.length;t++){const n=this._staticVariables[t];e._userVariables[this.getVariableName(t)]=n}return{rightHanded:!0,allBlocks:this._nodes.reduce(((e,t)=>e.concat(t.blocks)),[]),executionContexts:[e]}}}var d=n(85715),p=n(79923);const _="KHR_interactivity";class m{constructor(e){this._loader=e,this.name=_,this.enabled=this._loader.isExtensionUsed(_),this._pathConverter=(0,r.Wt)(this._loader.gltf),e._skipStartAnimationStep=!0;const t=e.babylonScene;t&&function(e){(0,r.oR)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>e.activeCamera?p.PT.FromRotationMatrix(e.activeCamera.getWorldMatrix()).normalize():new p.PT(NaN,NaN,NaN,NaN),type:"Quaternion",getTarget:()=>e.activeCamera}),(0,r.oR)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>e.activeCamera?e.activeCamera.position:new p.Pq(NaN,NaN,NaN),type:"Vector3",getTarget:()=>e.activeCamera}),(0,r.oR)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:e=>e._babylonAnimationGroup?.isPlaying??!1,type:"boolean",getTarget:e=>e._babylonAnimationGroup}),(0,r.oR)("/animations/{}/extensions/KHR_interactivity/minTime",{get:e=>(e._babylonAnimationGroup?.from??0)/60,type:"number",getTarget:e=>e._babylonAnimationGroup}),(0,r.oR)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:e=>(e._babylonAnimationGroup?.to??0)/60,type:"number",getTarget:e=>e._babylonAnimationGroup}),(0,r.oR)("/animations/{}/extensions/KHR_interactivity/playhead",{get:e=>(e._babylonAnimationGroup?.getCurrentFrame()??0)/60,type:"number",getTarget:e=>e._babylonAnimationGroup}),(0,r.oR)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:e=>(e._babylonAnimationGroup?.getCurrentFrame()??0)/60,type:"number",getTarget:e=>e._babylonAnimationGroup})}(t)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){if(!this._loader.babylonScene||!this._pathConverter)return;const e=this._loader.babylonScene,t=this._loader.gltf.extensions?.KHR_interactivity;if(!t)return;const n=new s.x({scene:e});n.dispatchEventsSynchronously=!1;const a=t.graphs.map((e=>new u(e,this._loader.gltf,this._loader).serializeToFlowGraph()));await Promise.all(a.map((e=>(0,o.cB)(e,{coordinator:n,pathConverter:this._pathConverter})))),n.start()}}(0,d.Q)(_,"FlowGraphGLTFDataProvider",(async()=>(await n.e(416).then(n.bind(n,31087))).FlowGraphGLTFDataProvider)),(0,a.Hg)(_),(0,a.Ye)(_,!0,(e=>new m(e)))},25870:(e,t,n)=>{n.d(t,{MSFT_sRGBFactors:()=>i});var s=n(23975),o=n(45316),a=n(37812);const r="MSFT_sRGBFactors";class i{constructor(e){this.name=r,this._loader=e,this.enabled=this._loader.isExtensionUsed(r)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,t,n){return o.BT.LoadExtraAsync(e,t,this.name,((o,a)=>{if(a){if(!(n instanceof s.Y))throw new Error(`${o}: Material type not supported`);const a=this._loader.loadMaterialPropertiesAsync(e,t,n),r=n.getScene().getEngine().useExactSrgbConversions;return n.albedoTexture||n.albedoColor.toLinearSpaceToRef(n.albedoColor,r),n.reflectivityTexture||n.reflectivityColor.toLinearSpaceToRef(n.reflectivityColor,r),a}return null}))}}(0,a.Hg)(r),(0,a.Ye)(r,!0,(e=>new i(e)))},27433:(e,t,n)=>{n.d(t,{MSFT_lod:()=>l});var s=n(99848),o=n(39018),a=n(45316),r=n(37812);const i="MSFT_lod";class l{constructor(e){this.name=i,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new s.cP,this.onMaterialLODsLoadedObservable=new s.cP,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=e,this.maxLODsToLoad=this._loader.parent.extensionOptions[i]?.maxLODsToLoad??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(i)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let e=0;e<this._nodePromiseLODs.length;e++){const t=Promise.all(this._nodePromiseLODs[e]).then((()=>{0!==e&&(this._loader.endPerformanceCounter(`Node LOD ${e}`),this._loader.log(`Loaded node LOD ${e}`)),this.onNodeLODsLoadedObservable.notifyObservers(e),e!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${e+1}`),this._loadBufferLOD(this._nodeBufferLODs,e+1),this._nodeSignalLODs[e]&&this._nodeSignalLODs[e].resolve())}));this._loader._completePromises.push(t)}for(let e=0;e<this._materialPromiseLODs.length;e++){const t=Promise.all(this._materialPromiseLODs[e]).then((()=>{0!==e&&(this._loader.endPerformanceCounter(`Material LOD ${e}`),this._loader.log(`Loaded material LOD ${e}`)),this.onMaterialLODsLoadedObservable.notifyObservers(e),e!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${e+1}`),this._loadBufferLOD(this._materialBufferLODs,e+1),this._materialSignalLODs[e]&&this._materialSignalLODs[e].resolve())}));this._loader._completePromises.push(t)}}loadSceneAsync(e,t){const n=this._loader.loadSceneAsync(e,t);return this._loadBufferLOD(this._bufferLODs,0),n}loadNodeAsync(e,t,n){return a.BT.LoadExtensionAsync(e,t,this.name,((e,s)=>{let a;const r=this._getLODs(e,t,this._loader.gltf.nodes,s.ids);this._loader.logOpen(`${e}`);for(let e=0;e<r.length;e++){const t=r[e];0!==e&&(this._nodeIndexLOD=e,this._nodeSignalLODs[e]=this._nodeSignalLODs[e]||new o.c);const s=e=>{n(e),e.setEnabled(!1)},i=this._loader.loadNodeAsync(`/nodes/${t.index}`,t,s).then((t=>{if(0!==e){const t=r[e-1];t._babylonTransformNode&&(this._disposeTransformNode(t._babylonTransformNode),delete t._babylonTransformNode)}return t.setEnabled(!0),t}));this._nodePromiseLODs[e]=this._nodePromiseLODs[e]||[],0===e?a=i:(this._nodeIndexLOD=null,this._nodePromiseLODs[e].push(i))}return this._loader.logClose(),a}))}_loadMaterialAsync(e,t,n,s,o){return this._nodeIndexLOD?null:a.BT.LoadExtensionAsync(e,t,this.name,((e,a)=>{let r;const i=this._getLODs(e,t,this._loader.gltf.materials,a.ids);this._loader.logOpen(`${e}`);for(let e=0;e<i.length;e++){const t=i[e];0!==e&&(this._materialIndexLOD=e);const a=this._loader._loadMaterialAsync(`/materials/${t.index}`,t,n,s,(t=>{0===e&&o(t)})).then((t=>{if(0!==e){o(t);const n=i[e-1]._data;n[s]&&(this._disposeMaterials([n[s].babylonMaterial]),delete n[s])}return t}));this._materialPromiseLODs[e]=this._materialPromiseLODs[e]||[],0===e?r=a:(this._materialIndexLOD=null,this._materialPromiseLODs[e].push(a))}return this._loader.logClose(),r}))}_loadUriAsync(e,t,n){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const s=this._nodeIndexLOD-1;return this._nodeSignalLODs[s]=this._nodeSignalLODs[s]||new o.c,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((()=>this._loader.loadUriAsync(e,t,n)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const s=this._materialIndexLOD-1;return this._materialSignalLODs[s]=this._materialSignalLODs[s]||new o.c,this._materialSignalLODs[s].promise.then((()=>this._loader.loadUriAsync(e,t,n)))}return null}loadBufferAsync(e,t,n,s){if(this._loader.parent.useRangeRequests&&!t.uri){if(!this._loader.bin)throw new Error(`${e}: Uri is missing or the binary glTF is missing its binary chunk`);const t=(e,t)=>{const a=n,r=a+s-1;let i=e[t];return i?(i.start=Math.min(i.start,a),i.end=Math.max(i.end,r)):(i={start:a,end:r,loaded:new o.c},e[t]=i),i.loaded.promise.then((e=>new Uint8Array(e.buffer,e.byteOffset+n-i.start,s)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?t(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?t(this._materialBufferLODs,this._materialIndexLOD):t(this._bufferLODs,0)}return null}_loadBufferLOD(e,t){const n=e[t];n&&(this._loader.log(`Loading buffer range [${n.start}-${n.end}]`),this._loader.bin.readAsync(n.start,n.end-n.start+1).then((e=>{n.loaded.resolve(e)}),(e=>{n.loaded.reject(e)})))}_getLODs(e,t,n,s){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const o=[];for(let t=s.length-1;t>=0;t--)if(o.push(a.l2.Get(`${e}/ids/${s[t]}`,n,s[t])),o.length===this.maxLODsToLoad)return o;return o.push(t),o}_disposeTransformNode(e){const t=[],n=e.material;n&&t.push(n);for(const n of e.getChildMeshes())n.material&&t.push(n.material);e.dispose();const s=t.filter((e=>this._loader.babylonScene.meshes.every((t=>t.material!=e))));this._disposeMaterials(s)}_disposeMaterials(e){const t={};for(const n of e){for(const e of n.getActiveTextures())t[e.uniqueId]=e;n.dispose()}for(const e in t)for(const n of this._loader.babylonScene.materials)n.hasTexture(t[e])&&delete t[e];for(const e in t)t[e].dispose()}}(0,r.Hg)(i),(0,r.Ye)(i,!0,(e=>new l(e)))},27993:(e,t,n)=>{n.d(t,{ExtrasAsMetadata:()=>a});var s=n(37812);const o="ExtrasAsMetadata";class a{_assignExtras(e,t){if(t.extras&&Object.keys(t.extras).length>0){const n=e.metadata=e.metadata||{};(n.gltf=n.gltf||{}).extras=t.extras}}constructor(e){this.name=o,this.enabled=!0,this._loader=e}dispose(){this._loader=null}loadNodeAsync(e,t,n){return this._loader.loadNodeAsync(e,t,(e=>{this._assignExtras(e,t),n(e)}))}loadCameraAsync(e,t,n){return this._loader.loadCameraAsync(e,t,(e=>{this._assignExtras(e,t),n(e)}))}createMaterial(e,t,n){const s=this._loader.createMaterial(e,t,n);return this._assignExtras(s,t),s}}(0,s.Hg)(o),(0,s.Ye)(o,!1,(e=>new a(e)))},31087:(e,t,n)=>{n.r(t),n.d(t,{FlowGraphGLTFDataProvider:()=>a});var s=n(71294),o=n(4720);class a extends s.e{constructor(e){super();const t=e.glTF,n=t.animations?.map((e=>e._babylonAnimationGroup))||[];this.animationGroups=this.registerDataOutput("animationGroups",o.Vv,n);const s=t.nodes?.map((e=>e._babylonTransformNode))||[];this.nodes=this.registerDataOutput("nodes",o.Vv,s)}getClassName(){return"FlowGraphGLTFDataProvider"}}},34236:(e,t,n)=>{n.r(t),n.d(t,{AnimationPropertyInfo:()=>c,TransformNodeAnimationPropertyInfo:()=>h,WeightAnimationPropertyInfo:()=>u,getQuaternion:()=>i,getVector3:()=>r,getWeights:()=>l});var s=n(7540),o=n(79923),a=n(49532);function r(e,t,n,s){return o.Pq.FromArray(t,n).scaleInPlace(s)}function i(e,t,n,s){return o.PT.FromArray(t,n).scaleInPlace(s)}function l(e,t,n,s){const o=new Array(e._numMorphTargets);for(let e=0;e<o.length;e++)o[e]=t[n++]*s;return o}class c{constructor(e,t,n,s){this.type=e,this.name=t,this.getValue=n,this.getStride=s}_buildAnimation(e,t,n){const o=new s.X5(e,this.name,t,this.type);return o.setKeys(n),o}}class h extends c{buildAnimations(e,t,n,s){const o=[];return o.push({babylonAnimatable:e._babylonTransformNode,babylonAnimation:this._buildAnimation(t,n,s)}),o}}class u extends c{buildAnimations(e,t,n,o){const a=[];if(e._numMorphTargets)for(let r=0;r<e._numMorphTargets;r++){const i=new s.X5(`${t}_${r}`,this.name,n,this.type);if(i.setKeys(o.map((e=>({frame:e.frame,inTangent:e.inTangent?e.inTangent[r]:void 0,value:e.value[r],outTangent:e.outTangent?e.outTangent[r]:void 0,interpolation:e.interpolation})))),e._primitiveBabylonMeshes)for(const t of e._primitiveBabylonMeshes)if(t.morphTargetManager){const e=t.morphTargetManager.getTarget(r),n=i.clone();e.animations.push(n),a.push({babylonAnimatable:e,babylonAnimation:n})}}return a}}(0,a.ZU)("/nodes/{}/translation",[new h(s.X5.ANIMATIONTYPE_VECTOR3,"position",r,(()=>3))]),(0,a.ZU)("/nodes/{}/rotation",[new h(s.X5.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",i,(()=>4))]),(0,a.ZU)("/nodes/{}/scale",[new h(s.X5.ANIMATIONTYPE_VECTOR3,"scaling",r,(()=>3))]),(0,a.ZU)("/nodes/{}/weights",[new u(s.X5.ANIMATIONTYPE_FLOAT,"influence",l,(e=>e._numMorphTargets))])},34717:(e,t,n)=>{n.d(t,{EXT_texture_webp:()=>r});var s=n(45316),o=n(37812);const a="EXT_texture_webp";class r{constructor(e){this.name=a,this._loader=e,this.enabled=e.isExtensionUsed(a)}dispose(){this._loader=null}_loadTextureAsync(e,t,n){return s.BT.LoadExtensionAsync(e,t,this.name,((o,a)=>{const r=null==t.sampler?s.BT.DefaultSampler:s.l2.Get(`${e}/sampler`,this._loader.gltf.samplers,t.sampler),i=s.l2.Get(`${o}/source`,this._loader.gltf.images,a.source);return this._loader._createTextureAsync(e,r,i,(e=>{n(e)}),void 0,!t._textureInfo.nonColorData)}))}}(0,o.Hg)(a),(0,o.Ye)(a,!0,(e=>new r(e)))},35538:(e,t,n)=>{n.d(t,{KHR_materials_variants:()=>i});var s=n(45316),o=n(76595),a=n(37812);const r="KHR_materials_variants";class i{constructor(e){this.name=r,this._loader=e,this.enabled=this._loader.isExtensionUsed(r)}dispose(){this._loader=null}static GetAvailableVariants(e){const t=this._GetExtensionMetadata(e);return t?Object.keys(t.variants):[]}getAvailableVariants(e){return i.GetAvailableVariants(e)}static SelectVariant(e,t){const n=this._GetExtensionMetadata(e);if(!n)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${r} extension`);const s=e=>{const t=n.variants[e];if(t)for(const e of t)e.mesh.material=e.material};if(t instanceof Array)for(const e of t)s(e);else s(t);n.lastSelected=t}selectVariant(e,t){i.SelectVariant(e,t)}static Reset(e){const t=this._GetExtensionMetadata(e);if(!t)throw new Error(`Cannot reset on a glTF mesh that does not have the ${r} extension`);for(const e of t.original)e.mesh.material=e.material;t.lastSelected=null}reset(e){i.Reset(e)}static GetLastSelectedVariant(e){const t=this._GetExtensionMetadata(e);if(!t)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${r} extension`);return t.lastSelected}getLastSelectedVariant(e){return i.GetLastSelectedVariant(e)}static _GetExtensionMetadata(e){return e?._internalMetadata?.gltf?.[r]||null}onLoading(){const e=this._loader.gltf.extensions;if(e&&e[this.name]){const t=e[this.name];this._variants=t.variants}}onReady(){const e=this._loader.rootBabylonMesh;if(e){const t=this._loader.parent.extensionOptions[r];t?.defaultVariant&&i.SelectVariant(e,t.defaultVariant),t?.onLoaded?.({get variants(){return i.GetAvailableVariants(e)},get selectedVariant(){const t=i.GetLastSelectedVariant(e);return t?Array.isArray(t)?t[0]:t:i.GetAvailableVariants(e)[0]},set selectedVariant(t){i.SelectVariant(e,t)}})}}_loadMeshPrimitiveAsync(e,t,n,a,l,c){return s.BT.LoadExtensionAsync(e,l,this.name,((h,u)=>{const d=new Array;return d.push(this._loader._loadMeshPrimitiveAsync(e,t,n,a,l,(t=>{if(c(t),t instanceof o.e){const n=s.BT._GetDrawMode(e,l.mode),o=this._loader.rootBabylonMesh,a=o?o._internalMetadata=o._internalMetadata||{}:{},c=a.gltf=a.gltf||{},p=c[r]=c[r]||{lastSelected:null,original:[],variants:{}};p.original.push({mesh:t,material:t.material});for(let e=0;e<u.mappings.length;++e){const a=u.mappings[e],l=s.l2.Get(`${h}/mappings/${e}/material`,this._loader.gltf.materials,a.material);d.push(this._loader._loadMaterialAsync(`#/materials/${a.material}`,l,t,n,(e=>{for(let n=0;n<a.variants.length;++n){const l=a.variants[n],c=s.l2.Get(`/extensions/${r}/variants/${l}`,this._variants,l);p.variants[c.name]=p.variants[c.name]||[],p.variants[c.name].push({mesh:t,material:e}),t.onClonedObservable.add((e=>{const n=e;let s=null,a=n;do{if(a=a.parent,!a)return;s=i._GetExtensionMetadata(a)}while(null===s);if(o&&s===i._GetExtensionMetadata(o)){a._internalMetadata={};for(const e in o._internalMetadata)a._internalMetadata[e]=o._internalMetadata[e];a._internalMetadata.gltf=[];for(const e in o._internalMetadata.gltf)a._internalMetadata.gltf[e]=o._internalMetadata.gltf[e];a._internalMetadata.gltf[r]={lastSelected:null,original:[],variants:{}};for(const e of s.original)a._internalMetadata.gltf[r].original.push({mesh:e.mesh,material:e.material});for(const e in s.variants)if(Object.prototype.hasOwnProperty.call(s.variants,e)){a._internalMetadata.gltf[r].variants[e]=[];for(const t of s.variants[e])a._internalMetadata.gltf[r].variants[e].push({mesh:t.mesh,material:t.material})}s=a._internalMetadata.gltf[r]}for(const e of s.original)e.mesh===t&&(e.mesh=n);for(const e of s.variants[c.name])e.mesh===t&&(e.mesh=n)}))}})))}}}))),Promise.all(d).then((([e])=>e))}))}}(0,a.Hg)(r),(0,a.Ye)(r,!0,(e=>new i(e)))},37574:(e,t,n)=>{n.d(t,{KHR_node_visibility:()=>r});var s=n(37812),o=n(49532);const a="KHR_node_visibility";(0,o.oR)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:e=>{const t=e._babylonTransformNode;return!t||void 0===t.isVisible||t.isVisible},set:(e,t)=>{t._primitiveBabylonMeshes?.forEach((e=>{e.inheritVisibility=!0})),t._babylonTransformNode&&(t._babylonTransformNode.isVisible=e),t._primitiveBabylonMeshes?.forEach((t=>{t.isVisible=e}))},getTarget:e=>e._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class r{constructor(e){this.name=a,this._loader=e,this.enabled=e.isExtensionUsed(a)}async onReady(){this._loader.gltf.nodes?.forEach((e=>{e._primitiveBabylonMeshes?.forEach((e=>{e.inheritVisibility=!0})),e.extensions?.KHR_node_visibility&&!1===e.extensions?.KHR_node_visibility.visible&&(e._babylonTransformNode&&(e._babylonTransformNode.isVisible=!1),e._primitiveBabylonMeshes?.forEach((e=>{e.isVisible=!1})))}))}dispose(){this._loader=null}}(0,s.Hg)(a),(0,s.Ye)(a,!0,(e=>new r(e)))},39991:(e,t,n)=>{n.d(t,{KHR_draco_mesh_compression:()=>l});var s=n(87728),o=n(95616),a=n(45316),r=n(37812);const i="KHR_draco_mesh_compression";class l{constructor(e){this.name=i,this.useNormalizedFlagFromAccessor=!0,this._loader=e,this.enabled=s.Y.DefaultAvailable&&this._loader.isExtensionUsed(i)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(e,t,n){return a.BT.LoadExtensionAsync(e,t,this.name,((r,i)=>{if(null!=t.mode&&4!==t.mode&&5!==t.mode)throw new Error(`${e}: Unsupported mode ${t.mode}`);const l={},c={},h=(e,s)=>{const o=i.attributes[e];if(null!=o&&(n._delayInfo=n._delayInfo||[],-1===n._delayInfo.indexOf(s)&&n._delayInfo.push(s),l[s]=o,this.useNormalizedFlagFromAccessor)){const n=a.l2.TryGet(this._loader.gltf.accessors,t.attributes[e]);n&&(c[s]=n.normalized||!1)}};h("POSITION",o.R.PositionKind),h("NORMAL",o.R.NormalKind),h("TANGENT",o.R.TangentKind),h("TEXCOORD_0",o.R.UVKind),h("TEXCOORD_1",o.R.UV2Kind),h("TEXCOORD_2",o.R.UV3Kind),h("TEXCOORD_3",o.R.UV4Kind),h("TEXCOORD_4",o.R.UV5Kind),h("TEXCOORD_5",o.R.UV6Kind),h("JOINTS_0",o.R.MatricesIndicesKind),h("WEIGHTS_0",o.R.MatricesWeightsKind),h("COLOR_0",o.R.ColorKind);const u=a.l2.Get(r,this._loader.gltf.bufferViews,i.bufferView);return u._dracoBabylonGeometry||(u._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${u.index}`,u).then((o=>{const r=this.dracoDecoder||s.Y.Default,i=a.l2.TryGet(this._loader.gltf.accessors,t.attributes.POSITION),h=this._loader.parent.alwaysComputeBoundingBox||n.skeleton||!i?null:(0,a.dM)(i);return r._decodeMeshToGeometryForGltfAsync(n.name,this._loader.babylonScene,o,l,c,h).catch((t=>{throw new Error(`${e}: ${t.message}`)}))}))),u._dracoBabylonGeometry}))}}(0,r.Hg)(i),(0,r.Ye)(i,!0,(e=>new l(e)))},45302:(e,t,n)=>{n.d(t,{EXT_lights_ies:()=>u});var s=n(79923),o=n(26041),a=n(40136),r=n(64704),i=n(45316),l=n(37812),c=n(7481);const h="EXT_lights_ies";class u{constructor(e){this.name=h,this._loader=e,this.enabled=this._loader.isExtensionUsed(h)}dispose(){this._loader=null,delete this._lights}onLoading(){const e=this._loader.gltf.extensions;if(e&&e[this.name]){const t=e[this.name];this._lights=t.lights,i.l2.Assign(this._lights)}}loadNodeAsync(e,t,n){return i.BT.LoadExtensionAsync(e,t,this.name,(async(l,h)=>{let u,d;this._loader._allMaterialsDirtyRequired=!0;const p=await this._loader.loadNodeAsync(e,t,(e=>{d=i.l2.Get(l,this._lights,h.light);const t=d.name||e.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,u=new a.n(t,s.Pq.Zero(),s.Pq.Backward(),0,1,this._loader.babylonScene),u.angle=Math.PI/2,u.innerAngle=0,u._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,d._babylonLight=u,u.falloffType=r.v.FALLOFF_GLTF,u.diffuse=h.color?o.v9.FromArray(h.color):o.v9.White(),u.intensity=h.multiplier||1,u.range=Number.MAX_VALUE,u.parent=e,this._loader._babylonLights.push(u),i.BT.AddPointerMetadata(u,l),n(e)}));let _;if(d.uri)_=await this._loader.loadUriAsync(e,d,d.uri);else{const t=i.l2.Get(`${e}/bufferView`,this._loader.gltf.bufferViews,d.bufferView);_=await this._loader.loadBufferViewAsync(`/bufferViews/${t.index}`,t)}return u.iesProfileTexture=new c.g(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,_,!0,void 0,void 0,void 0,void 0,".ies"),p}))}}(0,l.Hg)(h),(0,l.Ye)(h,!0,(e=>new u(e)))},45316:(e,t,n)=>{n.d(t,{l2:()=>H,GLTFFileLoader:()=>N,BT:()=>Y,dM:()=>K});var s=n(39018),o=n(79923),a=n(26041),r=n(998),i=n(30388),l=n(11710),c=n(36504),h=n(15397),u=n(28986),d=n(23975),p=n(7481),_=n(97328),m=n(95616),f=n(27050),g=n(35985),b=n(76595),y=n(80706),x=n(98639),T=n(99848),A=n(15909),v=n(97889),w=n(51137),C=n(97974);function O(e,t,n,s){const o={externalResourceFunction:s};return n&&(o.uri="file:"===t?n:t+n),ArrayBuffer.isView(e)?GLTFValidator.validateBytes(e,o):GLTFValidator.validateString(e,o)}function M(){const e=[];onmessage=t=>{const n=t.data;switch(n.id){case"init":importScripts(n.url);break;case"validate":O(n.data,n.rootUrl,n.fileName,(t=>new Promise(((n,s)=>{const o=e.length;e.push({resolve:n,reject:s}),postMessage({id:"getExternalResource",index:o,uri:t})})))).then((e=>{postMessage({id:"validate.resolve",value:e})}),(e=>{postMessage({id:"validate.reject",reason:e})}));break;case"getExternalResource.resolve":e[n.index].resolve(n.value);break;case"getExternalResource.reject":e[n.index].reject(n.reason)}}}class E{static ValidateAsync(e,t,n,s){return"function"==typeof Worker?new Promise(((o,a)=>{const i=`${O}(${M})()`,l=URL.createObjectURL(new Blob([i],{type:"application/javascript"})),c=new Worker(l),h=e=>{c.removeEventListener("error",h),c.removeEventListener("message",u),a(e)},u=e=>{const t=e.data;switch(t.id){case"getExternalResource":s(t.uri).then((e=>{c.postMessage({id:"getExternalResource.resolve",index:t.index,value:e},[e.buffer])}),(e=>{c.postMessage({id:"getExternalResource.reject",index:t.index,reason:e})}));break;case"validate.resolve":c.removeEventListener("error",h),c.removeEventListener("message",u),o(t.value),c.terminate();break;case"validate.reject":c.removeEventListener("error",h),c.removeEventListener("message",u),a(t.reason),c.terminate()}};if(c.addEventListener("error",h),c.addEventListener("message",u),c.postMessage({id:"init",url:r.S0.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(e)){const s=e.slice();c.postMessage({id:"validate",data:s,rootUrl:t,fileName:n},[s.buffer])}else c.postMessage({id:"validate",data:e,rootUrl:t,fileName:n})})):(this._LoadScriptPromise||(this._LoadScriptPromise=r.S0.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>O(e,t,n,s))))}}E.Configuration={url:`${r.S0._DefaultCdnUrl}/gltf_validator.js`};var F,P,R,I=n(2972),k=n(8532),L=n(88563);function B(e,t,n){try{return Promise.resolve(new Uint8Array(e,t,n))}catch(e){return Promise.reject(e)}}!function(e){e[e.AUTO=0]="AUTO",e[e.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(F||(F={})),function(e){e[e.NONE=0]="NONE",e[e.FIRST=1]="FIRST",e[e.ALL=2]="ALL"}(P||(P={})),function(e){e[e.LOADING=0]="LOADING",e[e.READY=1]="READY",e[e.COMPLETE=2]="COMPLETE"}(R||(R={}));class S{constructor(){this.coordinateSystemMode=F.AUTO,this.animationStartMode=P.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=e=>Promise.resolve(e),this.extensionOptions={}}copyFrom(e){e&&(this.onParsed=e.onParsed,this.coordinateSystemMode=e.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=e.animationStartMode??this.animationStartMode,this.loadNodeAnimations=e.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=e.loadSkins??this.loadSkins,this.loadMorphTargets=e.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=e.compileMaterials??this.compileMaterials,this.useClipPlane=e.useClipPlane??this.useClipPlane,this.compileShadowGenerators=e.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=e.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=e.useRangeRequests??this.useRangeRequests,this.createInstances=e.createInstances??this.createInstances,this.alwaysComputeBoundingBox=e.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=e.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=e.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=e.skipMaterials??this.skipMaterials,this.useSRGBBuffers=e.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=e.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=e.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=e.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=e.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=e.customRootNode,this.onMeshLoaded=e.onMeshLoaded,this.onSkinLoaded=e.onSkinLoaded,this.onTextureLoaded=e.onTextureLoaded,this.onMaterialLoaded=e.onMaterialLoaded,this.onCameraLoaded=e.onCameraLoaded,this.extensionOptions=e.extensionOptions??this.extensionOptions)}}class N extends S{constructor(e){super(),this.onParsedObservable=new T.cP,this.onMeshLoadedObservable=new T.cP,this.onSkinLoadedObservable=new T.cP,this.onTextureLoadedObservable=new T.cP,this.onMaterialLoadedObservable=new T.cP,this.onCameraLoadedObservable=new T.cP,this.onCompleteObservable=new T.cP,this.onErrorObservable=new T.cP,this.onDisposeObservable=new T.cP,this.onExtensionLoadedObservable=new T.cP,this.validate=!1,this.onValidatedObservable=new T.cP,this._loader=null,this._state=null,this._requests=new Array,this.name=I._.name,this.extensions=I._.extensions,this.onLoaderStateChangedObservable=new T.cP,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.copyFrom(e)}set onParsed(e){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),e&&(this._onParsedObserver=this.onParsedObservable.add(e))}set onMeshLoaded(e){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),e&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(e))}set onSkinLoaded(e){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),e&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((t=>e(t.node,t.skinnedNode))))}set onTextureLoaded(e){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),e&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(e))}set onMaterialLoaded(e){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),e&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(e))}set onCameraLoaded(e){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),e&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(e))}set onComplete(e){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(e)}set onError(e){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(e)}set onDispose(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)}set onExtensionLoaded(e){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(e)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(e){this._loggingEnabled!==e&&(this._loggingEnabled=e,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(e){this._capturePerformanceCounters!==e&&(this._capturePerformanceCounters=e,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(e){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(e)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const e of this._requests)e.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=e=>Promise.resolve(e),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.onDisposeObservable.notifyObservers(void 0),this.onDisposeObservable.clear()}loadFile(e,t,n,s,o,a,i,l){if(ArrayBuffer.isView(t))return this._loadBinary(e,t,n,s,i,l),null;this._progressCallback=o;const c=t.name||r.S0.GetFilename(t);if(a){if(this.useRangeRequests){this.validate&&w.V.Warn("glTF validation is not supported when range requests are enabled");const n={abort:()=>{},onCompleteObservable:new T.cP},o={readAsync:(n,s)=>new Promise(((o,a)=>{this._loadFile(e,t,(e=>{o(new Uint8Array(e))}),!0,(e=>{a(e)}),(e=>{e.setRequestHeader("Range",`bytes=${n}-${n+s-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new C.s(o)).then((e=>{n.onCompleteObservable.notifyObservers(n),s(e)}),i?e=>i(void 0,e):void 0),n}return this._loadFile(e,t,(t=>{this._validate(e,new Uint8Array(t,0,t.byteLength),n,c),this._unpackBinaryAsync(new C.s({readAsync:(e,n)=>B(t,e,n),byteLength:t.byteLength})).then((e=>{s(e)}),i?e=>i(void 0,e):void 0)}),!0,i)}return this._loadFile(e,t,(t=>{try{this._validate(e,t,n,c),s({json:this._parseJson(t)})}catch{i&&i()}}),!1,i)}_loadBinary(e,t,n,s,o,a){this._validate(e,new Uint8Array(t.buffer,t.byteOffset,t.byteLength),n,a),this._unpackBinaryAsync(new C.s({readAsync:(e,n)=>function(e,t,n){try{if(t<0||t>=e.byteLength)throw new RangeError("Offset is out of range.");if(t+n>e.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(e.buffer,e.byteOffset+t,n))}catch(e){return Promise.reject(e)}}(t,e,n),byteLength:t.byteLength})).then((e=>{s(e)}),o?e=>o(void 0,e):void 0)}importMeshAsync(e,t,n,s,o,a){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(n),this.onParsedObservable.clear(),this._log(`Loading ${a||""}`),this._loader=this._getLoader(n),this._loader.importMeshAsync(e,t,null,n,s,o,a))))}loadAsync(e,t,n,s,o){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(t),this.onParsedObservable.clear(),this._log(`Loading ${o||""}`),this._loader=this._getLoader(t),this._loader.loadAsync(e,t,n,s,o))))}loadAssetContainerAsync(e,t,n,s,o){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(t),this.onParsedObservable.clear(),this._log(`Loading ${o||""}`),this._loader=this._getLoader(t);const a=new v.WZ(e),r=[];this.onMaterialLoadedObservable.add((e=>{r.push(e)}));const i=[];this.onTextureLoadedObservable.add((e=>{i.push(e)}));const l=[];this.onCameraLoadedObservable.add((e=>{l.push(e)}));const c=[];return this.onMeshLoadedObservable.add((e=>{e.morphTargetManager&&c.push(e.morphTargetManager)})),this._loader.importMeshAsync(null,e,a,t,n,s,o).then((e=>(Array.prototype.push.apply(a.geometries,e.geometries),Array.prototype.push.apply(a.meshes,e.meshes),Array.prototype.push.apply(a.particleSystems,e.particleSystems),Array.prototype.push.apply(a.skeletons,e.skeletons),Array.prototype.push.apply(a.animationGroups,e.animationGroups),Array.prototype.push.apply(a.materials,r),Array.prototype.push.apply(a.textures,i),Array.prototype.push.apply(a.lights,e.lights),Array.prototype.push.apply(a.transformNodes,e.transformNodes),Array.prototype.push.apply(a.cameras,l),Array.prototype.push.apply(a.morphTargetManagers,c),a)))}))}canDirectLoad(e){return I._.canDirectLoad(e)}directLoad(e,t){if(t.startsWith("base64,"+I.i)||t.startsWith(";base64,"+I.i)||t.startsWith("application/octet-stream;base64,"+I.i)||t.startsWith("model/gltf-binary;base64,"+I.i)){const n=(0,k.rz)(t);return this._validate(e,new Uint8Array(n,0,n.byteLength)),this._unpackBinaryAsync(new C.s({readAsync:(e,t)=>B(n,e,t),byteLength:n.byteLength}))}return this._validate(e,t),Promise.resolve({json:this._parseJson(t)})}createPlugin(e){return new N(e[I._.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((e,t)=>{this.onCompleteObservable.addOnce((()=>{e()})),this.onErrorObservable.addOnce((e=>{t(e)}))}))}_setState(e){this._state!==e&&(this._state=e,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(R[this._state]))}_loadFile(e,t,n,s,o,a){const r=e._loadFile(t,n,(e=>{this._onProgress(e,r)}),!0,s,o,a);return r.onCompleteObservable.add((()=>{r._lengthComputable=!0,r._total=r._loaded})),this._requests.push(r),r}_onProgress(e,t){if(!this._progressCallback)return;t._lengthComputable=e.lengthComputable,t._loaded=e.loaded,t._total=e.total;let n=!0,s=0,o=0;for(const e of this._requests){if(void 0===e._lengthComputable||void 0===e._loaded||void 0===e._total)return;n=n&&e._lengthComputable,s+=e._loaded,o+=e._total}this._progressCallback({lengthComputable:n,loaded:s,total:n?o:0})}_validate(e,t,n="",s=""){this.validate&&(this._startPerformanceCounter("Validate JSON"),E.ValidateAsync(t,n,s,(t=>this.preprocessUrlAsync(n+t).then((t=>e._loadFileAsync(t,void 0,!0,!0).then((e=>new Uint8Array(e,0,e.byteLength))))))).then((e=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(e),this.onValidatedObservable.clear()}),(e=>{this._endPerformanceCounter("Validate JSON"),r.S0.Warn(`Failed to validate: ${e.message}`),this.onValidatedObservable.clear()})))}_getLoader(e){const t=e.json.asset||{};this._log(`Asset version: ${t.version}`),t.minVersion&&this._log(`Asset minimum version: ${t.minVersion}`),t.generator&&this._log(`Asset generator: ${t.generator}`);const n=N._parseVersion(t.version);if(!n)throw new Error("Invalid version: "+t.version);if(void 0!==t.minVersion){const e=N._parseVersion(t.minVersion);if(!e)throw new Error("Invalid minimum version: "+t.minVersion);if(N._compareVersion(e,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+t.minVersion)}const s={1:N._CreateGLTF1Loader,2:N._CreateGLTF2Loader}[n.major];if(!s)throw new Error("Unsupported version: "+t.version);return s(this)}_parseJson(e){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${e.length}`);const t=JSON.parse(e);return this._endPerformanceCounter("Parse JSON"),t}_unpackBinaryAsync(e){return this._startPerformanceCounter("Unpack Binary"),e.loadAsync(20).then((()=>{const t=e.readUint32();if(1179937895!==t)throw new L.bu("Unexpected magic: "+t,L.tG.GLTFLoaderUnexpectedMagicError);const n=e.readUint32();this.loggingEnabled&&this._log(`Binary version: ${n}`);const s=e.readUint32();let o;switch(this.useRangeRequests||s===e.buffer.byteLength||w.V.Warn(`Length in header does not match actual data length: ${s} != ${e.buffer.byteLength}`),n){case 1:o=this._unpackBinaryV1Async(e,s);break;case 2:o=this._unpackBinaryV2Async(e,s);break;default:throw new Error("Unsupported version: "+n)}return this._endPerformanceCounter("Unpack Binary"),o}))}_unpackBinaryV1Async(e,t){const n=e.readUint32(),s=e.readUint32();if(0!==s)throw new Error(`Unexpected content format: ${s}`);const o=t-e.byteOffset,a={json:this._parseJson(e.readString(n)),bin:null};if(0!==o){const t=e.byteOffset;a.bin={readAsync:(n,s)=>e.buffer.readAsync(t+n,s),byteLength:o}}return Promise.resolve(a)}_unpackBinaryV2Async(e,t){const n=1313821514,s=e.readUint32();if(e.readUint32()!==n)throw new Error("First chunk format is not JSON");return e.byteOffset+s===t?e.loadAsync(s).then((()=>({json:this._parseJson(e.readString(s)),bin:null}))):e.loadAsync(s+8).then((()=>{const o={json:this._parseJson(e.readString(s)),bin:null},a=()=>{const s=e.readUint32();switch(e.readUint32()){case n:throw new Error("Unexpected JSON chunk");case 5130562:{const t=e.byteOffset;o.bin={readAsync:(n,s)=>e.buffer.readAsync(t+n,s),byteLength:s},e.skipBytes(s);break}default:e.skipBytes(s)}return e.byteOffset!==t?e.loadAsync(8).then(a):Promise.resolve(o)};return a()}))}static _parseVersion(e){if("1.0"===e||"1.0.1"===e)return{major:1,minor:0};const t=(e+"").match(/^(\d+)\.(\d+)/);return t?{major:parseInt(t[1]),minor:parseInt(t[2])}:null}static _compareVersion(e,t){return e.major>t.major?1:e.major<t.major?-1:e.minor>t.minor?1:e.minor<t.minor?-1:0}_logOpen(e){this._log(e),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(e){const t=N._logSpaces.substring(0,2*this._logIndentLevel);w.V.Log(`${t}${e}`)}_logDisabled(e){}_startPerformanceCounterEnabled(e){r.S0.StartPerformanceCounter(e)}_startPerformanceCounterDisabled(e){}_endPerformanceCounterEnabled(e){r.S0.EndPerformanceCounter(e)}_endPerformanceCounterDisabled(e){}}N.IncrementalLoading=!0,N.HomogeneousCoordinates=!1,N._logSpaces="                                ",(0,A.qS)(new N);var G=n(20863),V=n(37812),$=n(49532),D=n(28853),U=n(11675);class H{static Get(e,t,n){if(!t||null==n||!t[n])throw new Error(`${e}: Failed to find index (${n})`);return t[n]}static TryGet(e,t){return e&&null!=t&&e[t]?e[t]:null}static Assign(e){if(e)for(let t=0;t<e.length;t++)e[t].index=t}}function K(e){if(e.min&&e.max){const t=e.min,n=e.max,s=o.AA.Vector3[0].copyFromFloats(t[0],t[1],t[2]),a=o.AA.Vector3[1].copyFromFloats(n[0],n[1],n[2]);if(e.normalized&&5126!==e.componentType){let t=1;switch(e.componentType){case 5120:t=127;break;case 5121:t=255;break;case 5122:t=32767;break;case 5123:t=65535}const n=1/t;s.scaleInPlace(n),a.scaleInPlace(n)}return new G.j(s,a)}return null}class Y{static RegisterExtension(e,t){(0,V.Ye)(e,!1,t)}static UnregisterExtension(e){return(0,V.Hg)(e)}get gltf(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(e){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=e}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((e=>e.dispose&&e.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}importMeshAsync(e,t,n,s,o,a,r=""){return Promise.resolve().then((()=>{this._babylonScene=t,this._assetContainer=n,this._loadData(s);let a=null;if(e){const t={};if(this._gltf.nodes)for(const e of this._gltf.nodes)e.name&&(t[e.name]=e.index);a=(e instanceof Array?e:[e]).map((e=>{const n=t[e];if(void 0===n)throw new Error(`Failed to find node '${e}'`);return n}))}return this._loadAsync(o,r,a,(()=>({meshes:this._getMeshes(),particleSystems:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}loadAsync(e,t,n,s,o=""){return Promise.resolve().then((()=>(this._babylonScene=e,this._loadData(t),this._loadAsync(n,o,null,(()=>{})))))}_loadAsync(e,t,n,s){return Promise.resolve().then((async()=>{this._rootUrl=e,this._uniqueRootUrl=!e.startsWith("file:")&&t?e:`${e}${Date.now()}/`,this._fileName=t,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const o=`${R[R.LOADING]} => ${R[R.READY]}`,a=`${R[R.LOADING]} => ${R[R.COMPLETE]}`;this._parent._startPerformanceCounter(o),this._parent._startPerformanceCounter(a),this._parent._setState(R.LOADING),this._extensionsOnLoading();const i=new Array,l=this._babylonScene.blockMaterialDirtyMechanism;if(this._babylonScene.blockMaterialDirtyMechanism=!0,!this.parent.loadOnlyMaterials)if(n)i.push(this.loadSceneAsync("/nodes",{nodes:n,index:-1}));else if(null!=this._gltf.scene||this._gltf.scenes&&this._gltf.scenes[0]){const e=H.Get("/scene",this._gltf.scenes,this._gltf.scene||0);i.push(this.loadSceneAsync(`/scenes/${e.index}`,e))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let e=0;e<this._gltf.materials.length;++e){const t=this._gltf.materials[e],n="/materials/"+e,s=u.i.TriangleFillMode;i.push(this._loadMaterialAsync(n,t,null,s,(()=>{})))}return this._allMaterialsDirtyRequired?this._babylonScene.blockMaterialDirtyMechanism=l:this._babylonScene._forceBlockMaterialDirtyMechanism(l),this._parent.compileMaterials&&i.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&i.push(this._compileShadowGeneratorsAsync()),Promise.all(i).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.setEnabled(!0);for(const e of this._babylonScene.materials){const t=e;void 0!==t.maxSimultaneousLights&&(t.maxSimultaneousLights=Math.max(t.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(R.READY),this._skipStartAnimationStep||this._startAnimations(),s()})).then((e=>(this._parent._endPerformanceCounter(o),r.S0.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(a),this._parent._setState(R.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(e=>{this._parent.onErrorObservable.notifyObservers(e),this._parent.onErrorObservable.clear(),this.dispose()}))})),e)))})).catch((e=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(e),this._parent.onErrorObservable.clear(),this.dispose()),e}))}_loadData(e){if(this._gltf=e.json,this._setupData(),e.bin){const t=this._gltf.buffers;if(t&&t[0]&&!t[0].uri){const n=t[0];(n.byteLength<e.bin.byteLength-3||n.byteLength>e.bin.byteLength)&&w.V.Warn(`Binary buffer length (${n.byteLength}) from JSON does not match chunk length (${e.bin.byteLength})`),this._bin=e.bin}else w.V.Warn("Unexpected BIN chunk")}}_setupData(){if(H.Assign(this._gltf.accessors),H.Assign(this._gltf.animations),H.Assign(this._gltf.buffers),H.Assign(this._gltf.bufferViews),H.Assign(this._gltf.cameras),H.Assign(this._gltf.images),H.Assign(this._gltf.materials),H.Assign(this._gltf.meshes),H.Assign(this._gltf.nodes),H.Assign(this._gltf.samplers),H.Assign(this._gltf.scenes),H.Assign(this._gltf.skins),H.Assign(this._gltf.textures),this._gltf.nodes){const e={};for(const t of this._gltf.nodes)if(t.children)for(const n of t.children)e[n]=t.index;const t=this._createRootNode();for(const n of this._gltf.nodes){const s=e[n.index];n.parent=void 0===s?t:this._gltf.nodes[s]}}}async _loadExtensionsAsync(){const e=[];if(V.Sv.forEach(((t,n)=>{!1===this.parent.extensionOptions[n]?.enabled?t.isGLTFExtension&&this.isExtensionUsed(n)&&w.V.Warn(`Extension ${n} is used but has been explicitly disabled.`):t.isGLTFExtension&&!this.isExtensionUsed(n)||e.push((async()=>{const e=await t.factory(this);return e.name!==n&&w.V.Warn(`The name of the glTF loader extension instance does not match the registered name: ${e.name} !== ${n}`),this._parent.onExtensionLoadedObservable.notifyObservers(e),e})())})),this._extensions.push(...await Promise.all(e)),this._extensions.sort(((e,t)=>(e.order||Number.MAX_VALUE)-(t.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const e of this._gltf.extensionsRequired)if(!this._extensions.some((t=>t.name===e&&t.enabled))){if(!1===this.parent.extensionOptions[e]?.enabled)throw new Error(`Required extension ${e} is disabled`);throw new Error(`Required extension ${e} is not available`)}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const e=new b.e("__root__",this._babylonScene);this._rootBabylonMesh=e,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.setEnabled(!1);const t={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case F.AUTO:this._babylonScene.useRightHandedSystem||(t.rotation=[0,1,0,0],t.scale=[1,1,-1],Y._LoadTransform(t,this._rootBabylonMesh));break;case F.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(e),t}loadSceneAsync(e,t){const n=this._extensionsLoadSceneAsync(e,t);if(n)return n;const s=new Array;if(this.logOpen(`${e} ${t.name||""}`),t.nodes)for(const n of t.nodes){const t=H.Get(`${e}/nodes/${n}`,this._gltf.nodes,n);s.push(this.loadNodeAsync(`/nodes/${t.index}`,t,(e=>{e.parent=this._rootBabylonMesh})))}for(const e of this._postSceneLoadActions)e();return s.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(s).then((()=>{}))}_forEachPrimitive(e,t){if(e._primitiveBabylonMeshes)for(const n of e._primitiveBabylonMeshes)t(n)}_getGeometries(){const e=[],t=this._gltf.nodes;if(t)for(const n of t)this._forEachPrimitive(n,(t=>{const n=t.geometry;n&&-1===e.indexOf(n)&&e.push(n)}));return e}_getMeshes(){const e=[];this._rootBabylonMesh instanceof g.u&&e.push(this._rootBabylonMesh);const t=this._gltf.nodes;if(t)for(const n of t)this._forEachPrimitive(n,(t=>{e.push(t)}));return e}_getTransformNodes(){const e=[],t=this._gltf.nodes;if(t)for(const n of t)n._babylonTransformNode&&"TransformNode"===n._babylonTransformNode.getClassName()&&e.push(n._babylonTransformNode),n._babylonTransformNodeForSkin&&e.push(n._babylonTransformNodeForSkin);return e}_getSkeletons(){const e=[],t=this._gltf.skins;if(t)for(const n of t)n._data&&e.push(n._data.babylonSkeleton);return e}_getAnimationGroups(){const e=[],t=this._gltf.animations;if(t)for(const n of t)n._babylonAnimationGroup&&e.push(n._babylonAnimationGroup);return e}_startAnimations(){switch(this._parent.animationStartMode){case P.NONE:break;case P.FIRST:{const e=this._getAnimationGroups();0!==e.length&&e[0].start(!0);break}case P.ALL:{const e=this._getAnimationGroups();for(const t of e)t.start(!0);break}default:return void w.V.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(e,t,n=()=>{}){const s=this._extensionsLoadNodeAsync(e,t,n);if(s)return s;if(t._babylonTransformNode)throw new Error(`${e}: Invalid recursive node hierarchy`);const o=new Array;this.logOpen(`${e} ${t.name||""}`);const a=s=>{if(Y.AddPointerMetadata(s,e),Y._LoadTransform(t,s),null!=t.camera){const n=H.Get(`${e}/camera`,this._gltf.cameras,t.camera);o.push(this.loadCameraAsync(`/cameras/${n.index}`,n,(e=>{e.parent=s})))}if(t.children)for(const n of t.children){const t=H.Get(`${e}/children/${n}`,this._gltf.nodes,n);o.push(this.loadNodeAsync(`/nodes/${t.index}`,t,(e=>{e.parent=s})))}n(s)},r=null!=t.mesh,i=this._parent.loadSkins&&null!=t.skin;if(!r||i){const e=t.name||`node${t.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const n=new _.V(e,this._babylonScene);n._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,null==t.mesh?t._babylonTransformNode=n:t._babylonTransformNodeForSkin=n,a(n)}if(r)if(i){const n=H.Get(`${e}/mesh`,this._gltf.meshes,t.mesh);o.push(this._loadMeshAsync(`/meshes/${n.index}`,t,n,(n=>{const s=t._babylonTransformNodeForSkin;n.metadata=(0,D.$)(s.metadata,n.metadata||{});const a=H.Get(`${e}/skin`,this._gltf.skins,t.skin);o.push(this._loadSkinAsync(`/skins/${a.index}`,t,a,(e=>{this._forEachPrimitive(t,(t=>{t.skeleton=e})),this._postSceneLoadActions.push((()=>{if(null!=a.skeleton){const e=H.Get(`/skins/${a.index}/skeleton`,this._gltf.nodes,a.skeleton).parent;t.index===e.index?n.parent=s.parent:n.parent=e._babylonTransformNode}else n.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:s,skinnedNode:n})}))})))})))}else{const n=H.Get(`${e}/mesh`,this._gltf.meshes,t.mesh);o.push(this._loadMeshAsync(`/meshes/${n.index}`,t,n,a))}return this.logClose(),Promise.all(o).then((()=>(this._forEachPrimitive(t,(e=>{const t=e;!t.isAnInstance&&t.geometry&&t.geometry.useBoundingInfoFromGeometry?e._updateBoundingInfo():e.refreshBoundingInfo(!0,!0)})),t._babylonTransformNode)))}_loadMeshAsync(e,t,n,s){const o=n.primitives;if(!o||!o.length)throw new Error(`${e}: Primitives are missing`);null==o[0].index&&H.Assign(o);const a=new Array;this.logOpen(`${e} ${n.name||""}`);const r=t.name||`node${t.index}`;if(1===o.length){const s=n.primitives[0];a.push(this._loadMeshPrimitiveAsync(`${e}/primitives/${s.index}`,r,t,n,s,(e=>{t._babylonTransformNode=e,t._primitiveBabylonMeshes=[e]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,t._babylonTransformNode=new _.V(r,this._babylonScene),t._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,t._primitiveBabylonMeshes=[];for(const s of o)a.push(this._loadMeshPrimitiveAsync(`${e}/primitives/${s.index}`,`${r}_primitive${s.index}`,t,n,s,(e=>{e.parent=t._babylonTransformNode,t._primitiveBabylonMeshes.push(e)})))}return s(t._babylonTransformNode),this.logClose(),Promise.all(a).then((()=>t._babylonTransformNode))}_loadMeshPrimitiveAsync(e,t,n,s,o,a){const r=this._extensionsLoadMeshPrimitiveAsync(e,t,n,s,o,a);if(r)return r;this.logOpen(`${e}`);const i=0===this._disableInstancedMesh&&this._parent.createInstances&&null==n.skin&&!s.primitives[0].targets;let l,c;if(i&&o._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,l=o._instanceData.babylonSourceMesh.createInstance(t),l._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,c=o._instanceData.promise;else{const a=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const r=new b.e(t,this._babylonScene);r._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,r.sideOrientation=this._babylonScene.useRightHandedSystem?u.i.CounterClockWiseSideOrientation:u.i.ClockWiseSideOrientation,this._createMorphTargets(e,n,s,o,r),a.push(this._loadVertexDataAsync(e,o,r).then((t=>this._loadMorphTargetsAsync(e,o,r,t).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,t.applyToMesh(r),t._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const h=Y._GetDrawMode(e,o.mode);if(null==o.material){let e=this._defaultBabylonMaterialData[h];e||(e=this._createDefaultMaterial("__GLTFLoader._default",h),this._parent.onMaterialLoadedObservable.notifyObservers(e),this._defaultBabylonMaterialData[h]=e),r.material=e}else if(!this.parent.skipMaterials){const t=H.Get(`${e}/material`,this._gltf.materials,o.material);a.push(this._loadMaterialAsync(`/materials/${t.index}`,t,r,h,(e=>{r.material=e})))}c=Promise.all(a),i&&(o._instanceData={babylonSourceMesh:r,promise:c}),l=r}return Y.AddPointerMetadata(l,e),this._parent.onMeshLoadedObservable.notifyObservers(l),a(l),this.logClose(),c.then((()=>l))}_loadVertexDataAsync(e,t,n){const s=this._extensionsLoadVertexDataAsync(e,t,n);if(s)return s;const o=t.attributes;if(!o)throw new Error(`${e}: Attributes are missing`);const a=new Array,r=new f.V(n.name,this._babylonScene);if(null==t.indices)n.isUnIndexed=!0;else{const n=H.Get(`${e}/indices`,this._gltf.accessors,t.indices);a.push(this._loadIndicesAccessorAsync(`/accessors/${n.index}`,n).then((e=>{r.setIndices(e)})))}const i=(t,s,i)=>{if(null==o[t])return;n._delayInfo=n._delayInfo||[],-1===n._delayInfo.indexOf(s)&&n._delayInfo.push(s);const l=H.Get(`${e}/attributes/${t}`,this._gltf.accessors,o[t]);a.push(this._loadVertexAccessorAsync(`/accessors/${l.index}`,l,s).then((e=>{if(e.getKind()===m.R.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!n.skeleton){const e=K(l);e&&(r._boundingInfo=e,r.useBoundingInfoFromGeometry=!0)}r.setVerticesBuffer(e,l.count)}))),s==m.R.MatricesIndicesExtraKind&&(n.numBoneInfluencers=8),i&&i(l)};return i("POSITION",m.R.PositionKind),i("NORMAL",m.R.NormalKind),i("TANGENT",m.R.TangentKind),i("TEXCOORD_0",m.R.UVKind),i("TEXCOORD_1",m.R.UV2Kind),i("TEXCOORD_2",m.R.UV3Kind),i("TEXCOORD_3",m.R.UV4Kind),i("TEXCOORD_4",m.R.UV5Kind),i("TEXCOORD_5",m.R.UV6Kind),i("JOINTS_0",m.R.MatricesIndicesKind),i("WEIGHTS_0",m.R.MatricesWeightsKind),i("JOINTS_1",m.R.MatricesIndicesExtraKind),i("WEIGHTS_1",m.R.MatricesWeightsExtraKind),i("COLOR_0",m.R.ColorKind,(e=>{"VEC4"===e.type&&(n.hasVertexAlpha=!0)})),Promise.all(a).then((()=>r))}_createMorphTargets(e,t,n,s,o){if(!s.targets||!this._parent.loadMorphTargets)return;if(null==t._numMorphTargets)t._numMorphTargets=s.targets.length;else if(s.targets.length!==t._numMorphTargets)throw new Error(`${e}: Primitives do not have the same number of targets`);const a=n.extras?n.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,o.morphTargetManager=new x.j(this._babylonScene),o.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,o.morphTargetManager.areUpdatesFrozen=!0;for(let e=0;e<s.targets.length;e++){const s=t.weights?t.weights[e]:n.weights?n.weights[e]:0,r=a?a[e]:`morphTarget${e}`;o.morphTargetManager.addTarget(new y.M(r,s,o.getScene()))}}_loadMorphTargetsAsync(e,t,n,s){if(!t.targets||!this._parent.loadMorphTargets)return Promise.resolve();const o=new Array,a=n.morphTargetManager;for(let n=0;n<a.numTargets;n++){const r=a.getTarget(n);o.push(this._loadMorphTargetVertexDataAsync(`${e}/targets/${n}`,s,t.targets[n],r))}return Promise.all(o).then((()=>{a.areUpdatesFrozen=!1}))}_loadMorphTargetVertexDataAsync(e,t,n,s){const o=new Array,a=(s,a,r)=>{if(null==n[s])return;const i=t.getVertexBuffer(a);if(!i)return;const l=H.Get(`${e}/${s}`,this._gltf.accessors,n[s]);o.push(this._loadFloatAccessorAsync(`/accessors/${l.index}`,l).then((e=>{r(i,e)})))};return a("POSITION",m.R.PositionKind,((e,t)=>{const n=new Float32Array(t.length);e.forEach(t.length,((e,s)=>{n[s]=t[s]+e})),s.setPositions(n)})),a("NORMAL",m.R.NormalKind,((e,t)=>{const n=new Float32Array(t.length);e.forEach(n.length,((e,s)=>{n[s]=t[s]+e})),s.setNormals(n)})),a("TANGENT",m.R.TangentKind,((e,t)=>{const n=new Float32Array(t.length/3*4);let o=0;e.forEach(t.length/3*4,((e,s)=>{(s+1)%4!=0&&(n[o]=t[o]+e,o++)})),s.setTangents(n)})),a("TEXCOORD_0",m.R.UVKind,((e,t)=>{const n=new Float32Array(t.length);e.forEach(t.length,((e,s)=>{n[s]=t[s]+e})),s.setUVs(n)})),a("TEXCOORD_1",m.R.UV2Kind,((e,t)=>{const n=new Float32Array(t.length);e.forEach(t.length,((e,s)=>{n[s]=t[s]+e})),s.setUV2s(n)})),a("COLOR_0",m.R.ColorKind,((t,n)=>{let o=null;const a=t.getSize();if(3===a){o=new Float32Array(n.length/3*4),t.forEach(n.length,((e,t)=>{const s=Math.floor(t/3),a=t%3;o[4*s+a]=n[3*s+a]+e}));for(let e=0;e<n.length/3;++e)o[4*e+3]=1}else{if(4!==a)throw new Error(`${e}: Invalid number of components (${a}) for COLOR_0 attribute`);o=new Float32Array(n.length),t.forEach(n.length,((e,t)=>{o[t]=n[t]+e}))}s.setColors(o)})),Promise.all(o).then((()=>{}))}static _LoadTransform(e,t){if(null!=e.skin)return;let n=o.Pq.Zero(),s=o.PT.Identity(),a=o.Pq.One();e.matrix?o.uq.FromArray(e.matrix).decompose(a,s,n):(e.translation&&(n=o.Pq.FromArray(e.translation)),e.rotation&&(s=o.PT.FromArray(e.rotation)),e.scale&&(a=o.Pq.FromArray(e.scale))),t.position=n,t.rotationQuaternion=s,t.scaling=a}_loadSkinAsync(e,t,n,s){if(!this._parent.loadSkins)return Promise.resolve();const o=this._extensionsLoadSkinAsync(e,t,n);if(o)return o;if(n._data)return s(n._data.babylonSkeleton),n._data.promise;const a=`skeleton${n.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const r=new h.E(n.name||a,a,this._babylonScene);r._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(e,n,r);const i=this._loadSkinInverseBindMatricesDataAsync(e,n).then((e=>{this._updateBoneMatrices(r,e)}));return n._data={babylonSkeleton:r,promise:i},s(r),i}_loadBones(e,t,n){if(null==t.skeleton||this._parent.alwaysComputeSkeletonRootNode){const n=this._findSkeletonRootNode(`${e}/joints`,t.joints);if(n)if(void 0===t.skeleton)t.skeleton=n.index;else{const s=(e,t)=>{for(;t.parent;t=t.parent)if(t.parent===e)return!0;return!1},o=H.Get(`${e}/skeleton`,this._gltf.nodes,t.skeleton);o===n||s(o,n)||(w.V.Warn(`${e}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),t.skeleton=n.index)}else w.V.Warn(`${e}: Failed to find common root`)}const s={};for(const o of t.joints){const a=H.Get(`${e}/joints/${o}`,this._gltf.nodes,o);this._loadBone(a,t,n,s)}}_findSkeletonRootNode(e,t){if(0===t.length)return null;const n={};for(const s of t){const t=[];let o=H.Get(`${e}/${s}`,this._gltf.nodes,s);for(;-1!==o.index;)t.unshift(o),o=o.parent;n[s]=t}let s=null;for(let e=0;;++e){let o=n[t[0]];if(e>=o.length)return s;const a=o[e];for(let r=1;r<t.length;++r)if(o=n[t[r]],e>=o.length||a!==o[e])return s;s=a}}_loadBone(e,t,n,s){e._isJoint=!0;let o=s[e.index];if(o)return o;let a=null;e.index!==t.skeleton&&(e.parent&&-1!==e.parent.index?a=this._loadBone(e.parent,t,n,s):void 0!==t.skeleton&&w.V.Warn(`/skins/${t.index}/skeleton: Skeleton node is not a common root`));const r=t.joints.indexOf(e.index);return o=new c.$(e.name||`joint${e.index}`,n,a,this._getNodeMatrix(e),null,null,r),s[e.index]=o,this._postSceneLoadActions.push((()=>{o.linkTransformNode(e._babylonTransformNode)})),o}_loadSkinInverseBindMatricesDataAsync(e,t){if(null==t.inverseBindMatrices)return Promise.resolve(null);const n=H.Get(`${e}/inverseBindMatrices`,this._gltf.accessors,t.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${n.index}`,n)}_updateBoneMatrices(e,t){for(const n of e.bones){const e=o.uq.Identity(),s=n._index;t&&-1!==s&&(o.uq.FromArrayToRef(t,16*s,e),e.invertToRef(e));const a=n.getParent();a&&e.multiplyToRef(a.getAbsoluteInverseBindMatrix(),e),n.updateMatrix(e,!1,!1),n._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(e){return e.matrix?o.uq.FromArray(e.matrix):o.uq.Compose(e.scale?o.Pq.FromArray(e.scale):o.Pq.One(),e.rotation?o.PT.FromArray(e.rotation):o.PT.Identity(),e.translation?o.Pq.FromArray(e.translation):o.Pq.Zero())}loadCameraAsync(e,t,n=()=>{}){const s=this._extensionsLoadCameraAsync(e,t,n);if(s)return s;const a=new Array;this.logOpen(`${e} ${t.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const r=new l.S(t.name||`camera${t.index}`,o.Pq.Zero(),this._babylonScene,!1);switch(r._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,r.ignoreParentScaling=!0,t._babylonCamera=r,r.rotation.set(0,Math.PI,0),t.type){case"perspective":{const n=t.perspective;if(!n)throw new Error(`${e}: Camera perspective properties are missing`);r.fov=n.yfov,r.minZ=n.znear,r.maxZ=n.zfar||0;break}case"orthographic":if(!t.orthographic)throw new Error(`${e}: Camera orthographic properties are missing`);r.mode=i.i.ORTHOGRAPHIC_CAMERA,r.orthoLeft=-t.orthographic.xmag,r.orthoRight=t.orthographic.xmag,r.orthoBottom=-t.orthographic.ymag,r.orthoTop=t.orthographic.ymag,r.minZ=t.orthographic.znear,r.maxZ=t.orthographic.zfar;break;default:throw new Error(`${e}: Invalid camera type (${t.type})`)}return Y.AddPointerMetadata(r,e),this._parent.onCameraLoadedObservable.notifyObservers(r),n(r),this.logClose(),Promise.all(a).then((()=>r))}_loadAnimationsAsync(){const e=this._gltf.animations;if(!e)return Promise.resolve();const t=new Array;for(let n=0;n<e.length;n++){const s=e[n];t.push(this.loadAnimationAsync(`/animations/${s.index}`,s).then((e=>{0===e.targetedAnimations.length&&e.dispose()})))}return Promise.all(t).then((()=>{}))}loadAnimationAsync(e,t){return this._extensionsLoadAnimationAsync(e,t)||Promise.resolve().then(n.bind(n,97689)).then((({AnimationGroup:n})=>{this._babylonScene._blockEntityCollection=!!this._assetContainer;const s=new n(t.name||`animation${t.index}`,this._babylonScene);s._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,t._babylonAnimationGroup=s;const o=new Array;H.Assign(t.channels),H.Assign(t.samplers);for(const n of t.channels)o.push(this._loadAnimationChannelAsync(`${e}/channels/${n.index}`,e,t,n,((e,t)=>{e.animations=e.animations||[],e.animations.push(t),s.addTargetedAnimation(t,e)})));return Promise.all(o).then((()=>(s.normalize(0),s)))}))}async _loadAnimationChannelAsync(e,t,s,o,a){const r=this._extensionsLoadAnimationChannelAsync(e,t,s,o,a);if(r)return r;if(null==o.target.node)return Promise.resolve();const i=H.Get(`${e}/target/node`,this._gltf.nodes,o.target.node),l=o.target.path,c="weights"===l;if(c&&!i._numMorphTargets||!c&&!i._babylonTransformNode)return Promise.resolve();if(!this._parent.loadNodeAnimations&&!c&&!i._isJoint)return Promise.resolve();let h;switch(await n.e(416).then(n.bind(n,34236)),l){case"translation":h=(0,$.tQ)("/nodes/{}/translation")?.interpolation;break;case"rotation":h=(0,$.tQ)("/nodes/{}/rotation")?.interpolation;break;case"scale":h=(0,$.tQ)("/nodes/{}/scale")?.interpolation;break;case"weights":h=(0,$.tQ)("/nodes/{}/weights")?.interpolation;break;default:throw new Error(`${e}/target/path: Invalid value (${o.target.path})`)}if(!h)throw new Error(`${e}/target/path: Could not find interpolation properties for target path (${o.target.path})`);const u={object:i,info:h};return this._loadAnimationChannelFromTargetInfoAsync(e,t,s,o,u,a)}_loadAnimationChannelFromTargetInfoAsync(e,t,n,s,o,a){const r=this.parent.targetFps,i=1/r,l=H.Get(`${e}/sampler`,n.samplers,s.sampler);return this._loadAnimationSamplerAsync(`${t}/samplers/${s.sampler}`,l).then((e=>{let t=0;const l=o.object,c=o.info;for(const o of c){const c=o.getStride(l),h=e.input,u=e.output,d=new Array(h.length);let p=0;switch(e.interpolation){case"STEP":for(let e=0;e<h.length;e++){const t=o.getValue(l,u,p,1);p+=c,d[e]={frame:h[e]*r,value:t,interpolation:1}}break;case"CUBICSPLINE":for(let e=0;e<h.length;e++){const t=o.getValue(l,u,p,i);p+=c;const n=o.getValue(l,u,p,1);p+=c;const s=o.getValue(l,u,p,i);p+=c,d[e]={frame:h[e]*r,inTangent:t,value:n,outTangent:s}}break;case"LINEAR":for(let e=0;e<h.length;e++){const t=o.getValue(l,u,p,1);p+=c,d[e]={frame:h[e]*r,value:t}}}if(p>0){const e=`${n.name||`animation${n.index}`}_channel${s.index}_${t}`,i=o.buildAnimations(l,e,r,d);for(const e of i)t++,a(e.babylonAnimatable,e.babylonAnimation)}}}))}_loadAnimationSamplerAsync(e,t){if(t._data)return t._data;const n=t.interpolation||"LINEAR";switch(n){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${e}/interpolation: Invalid value (${t.interpolation})`)}const s=H.Get(`${e}/input`,this._gltf.accessors,t.input),o=H.Get(`${e}/output`,this._gltf.accessors,t.output);return t._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${s.index}`,s),this._loadFloatAccessorAsync(`/accessors/${o.index}`,o)]).then((([e,t])=>({input:e,interpolation:n,output:t}))),t._data}loadBufferAsync(e,t,n,s){const o=this._extensionsLoadBufferAsync(e,t,n,s);if(o)return o;if(!t._data)if(t.uri)t._data=this.loadUriAsync(`${e}/uri`,t,t.uri);else{if(!this._bin)throw new Error(`${e}: Uri is missing or the binary glTF is missing its binary chunk`);t._data=this._bin.readAsync(0,t.byteLength)}return t._data.then((t=>{try{return new Uint8Array(t.buffer,t.byteOffset+n,s)}catch(t){throw new Error(`${e}: ${t.message}`)}}))}loadBufferViewAsync(e,t){const n=this._extensionsLoadBufferViewAsync(e,t);if(n)return n;if(t._data)return t._data;const s=H.Get(`${e}/buffer`,this._gltf.buffers,t.buffer);return t._data=this.loadBufferAsync(`/buffers/${s.index}`,s,t.byteOffset||0,t.byteLength),t._data}_loadAccessorAsync(e,t,n){if(t._data)return t._data;const s=Y._GetNumComponents(e,t.type),o=s*m.R.GetTypeByteLength(t.componentType),a=s*t.count;if(null==t.bufferView)t._data=Promise.resolve(new n(a));else{const r=H.Get(`${e}/bufferView`,this._gltf.bufferViews,t.bufferView);t._data=this.loadBufferViewAsync(`/bufferViews/${r.index}`,r).then((i=>{if(5126!==t.componentType||t.normalized||r.byteStride&&r.byteStride!==o){const e=new n(a);return m.R.ForEach(i,t.byteOffset||0,r.byteStride||o,s,t.componentType,e.length,t.normalized||!1,((t,n)=>{e[n]=t})),e}return Y._GetTypedArray(e,t.componentType,i,t.byteOffset,a)}))}if(t.sparse){const a=t.sparse;t._data=t._data.then((r=>{const i=r,l=H.Get(`${e}/sparse/indices/bufferView`,this._gltf.bufferViews,a.indices.bufferView),c=H.Get(`${e}/sparse/values/bufferView`,this._gltf.bufferViews,a.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${l.index}`,l),this.loadBufferViewAsync(`/bufferViews/${c.index}`,c)]).then((([r,l])=>{const c=Y._GetTypedArray(`${e}/sparse/indices`,a.indices.componentType,r,a.indices.byteOffset,a.count),h=s*a.count;let u;if(5126!==t.componentType||t.normalized){const r=Y._GetTypedArray(`${e}/sparse/values`,t.componentType,l,a.values.byteOffset,h);u=new n(h),m.R.ForEach(r,0,o,s,t.componentType,u.length,t.normalized||!1,((e,t)=>{u[t]=e}))}else u=Y._GetTypedArray(`${e}/sparse/values`,t.componentType,l,a.values.byteOffset,h);let d=0;for(let e=0;e<c.length;e++){let t=c[e]*s;for(let e=0;e<s;e++)i[t++]=u[d++]}return i}))}))}return t._data}_loadFloatAccessorAsync(e,t){return this._loadAccessorAsync(e,t,Float32Array)}_loadIndicesAccessorAsync(e,t){if("SCALAR"!==t.type)throw new Error(`${e}/type: Invalid value ${t.type}`);if(5121!==t.componentType&&5123!==t.componentType&&5125!==t.componentType)throw new Error(`${e}/componentType: Invalid value ${t.componentType}`);if(t._data)return t._data;if(t.sparse){const n=Y._GetTypedArrayConstructor(`${e}/componentType`,t.componentType);t._data=this._loadAccessorAsync(e,t,n)}else{const n=H.Get(`${e}/bufferView`,this._gltf.bufferViews,t.bufferView);t._data=this.loadBufferViewAsync(`/bufferViews/${n.index}`,n).then((n=>Y._GetTypedArray(e,t.componentType,n,t.byteOffset,t.count)))}return t._data}_loadVertexBufferViewAsync(e){if(e._babylonBuffer)return e._babylonBuffer;const t=this._babylonScene.getEngine();return e._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${e.index}`,e).then((e=>new m.h(t,e,!1))),e._babylonBuffer}_loadVertexAccessorAsync(e,t,n){if(t._babylonVertexBuffer?.[n])return t._babylonVertexBuffer[n];t._babylonVertexBuffer||(t._babylonVertexBuffer={});const s=this._babylonScene.getEngine();if(t.sparse||null==t.bufferView)t._babylonVertexBuffer[n]=this._loadFloatAccessorAsync(e,t).then((e=>new m.R(s,e,n,!1)));else{const o=H.Get(`${e}/bufferView`,this._gltf.bufferViews,t.bufferView);t._babylonVertexBuffer[n]=this._loadVertexBufferViewAsync(o).then((a=>{const r=Y._GetNumComponents(e,t.type);return new m.R(s,a,n,!1,void 0,o.byteStride,void 0,t.byteOffset,r,t.componentType,t.normalized,!0,void 0,!0)}))}return t._babylonVertexBuffer[n]}_loadMaterialMetallicRoughnessPropertiesAsync(e,t,n){if(!(n instanceof d.Y))throw new Error(`${e}: Material type not supported`);const s=new Array;return t&&(t.baseColorFactor?(n.albedoColor=a.v9.FromArray(t.baseColorFactor),n.alpha=t.baseColorFactor[3]):n.albedoColor=a.v9.White(),n.metallic=null==t.metallicFactor?1:t.metallicFactor,n.roughness=null==t.roughnessFactor?1:t.roughnessFactor,t.baseColorTexture&&s.push(this.loadTextureInfoAsync(`${e}/baseColorTexture`,t.baseColorTexture,(e=>{e.name=`${n.name} (Base Color)`,n.albedoTexture=e}))),t.metallicRoughnessTexture&&(t.metallicRoughnessTexture.nonColorData=!0,s.push(this.loadTextureInfoAsync(`${e}/metallicRoughnessTexture`,t.metallicRoughnessTexture,(e=>{e.name=`${n.name} (Metallic Roughness)`,n.metallicTexture=e}))),n.useMetallnessFromMetallicTextureBlue=!0,n.useRoughnessFromMetallicTextureGreen=!0,n.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(s).then((()=>{}))}_loadMaterialAsync(e,t,n,s,o=()=>{}){const a=this._extensionsLoadMaterialAsync(e,t,n,s,o);if(a)return a;t._data=t._data||{};let r=t._data[s];if(!r){this.logOpen(`${e} ${t.name||""}`);const n=this.createMaterial(e,t,s);r={babylonMaterial:n,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(e,t,n)},t._data[s]=r,Y.AddPointerMetadata(n,e),this._parent.onMaterialLoadedObservable.notifyObservers(n),this.logClose()}return n&&(r.babylonMeshes.push(n),n.onDisposeObservable.addOnce((()=>{const e=r.babylonMeshes.indexOf(n);-1!==e&&r.babylonMeshes.splice(e,1)}))),o(r.babylonMaterial),r.promise.then((()=>r.babylonMaterial))}_createDefaultMaterial(e,t){this._babylonScene._blockEntityCollection=!!this._assetContainer;const n=new d.Y(e,this._babylonScene);return n._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,n.fillMode=t,n.enableSpecularAntiAliasing=!0,n.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,n.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,n.transparencyMode=d.Y.PBRMATERIAL_OPAQUE,n.metallic=1,n.roughness=1,n}createMaterial(e,t,n){const s=this._extensionsCreateMaterial(e,t,n);if(s)return s;const o=t.name||`material${t.index}`;return this._createDefaultMaterial(o,n)}loadMaterialPropertiesAsync(e,t,n){const s=this._extensionsLoadMaterialPropertiesAsync(e,t,n);if(s)return s;const o=new Array;return o.push(this.loadMaterialBasePropertiesAsync(e,t,n)),t.pbrMetallicRoughness&&o.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${e}/pbrMetallicRoughness`,t.pbrMetallicRoughness,n)),this.loadMaterialAlphaProperties(e,t,n),Promise.all(o).then((()=>{}))}loadMaterialBasePropertiesAsync(e,t,n){if(!(n instanceof d.Y))throw new Error(`${e}: Material type not supported`);const s=new Array;return n.emissiveColor=t.emissiveFactor?a.v9.FromArray(t.emissiveFactor):new a.v9(0,0,0),t.doubleSided&&(n.backFaceCulling=!1,n.twoSidedLighting=!0),t.normalTexture&&(t.normalTexture.nonColorData=!0,s.push(this.loadTextureInfoAsync(`${e}/normalTexture`,t.normalTexture,(e=>{e.name=`${n.name} (Normal)`,n.bumpTexture=e}))),n.invertNormalMapX=!this._babylonScene.useRightHandedSystem,n.invertNormalMapY=this._babylonScene.useRightHandedSystem,null!=t.normalTexture.scale&&n.bumpTexture&&(n.bumpTexture.level=t.normalTexture.scale),n.forceIrradianceInFragment=!0),t.occlusionTexture&&(t.occlusionTexture.nonColorData=!0,s.push(this.loadTextureInfoAsync(`${e}/occlusionTexture`,t.occlusionTexture,(e=>{e.name=`${n.name} (Occlusion)`,n.ambientTexture=e}))),n.useAmbientInGrayScale=!0,null!=t.occlusionTexture.strength&&(n.ambientTextureStrength=t.occlusionTexture.strength)),t.emissiveTexture&&s.push(this.loadTextureInfoAsync(`${e}/emissiveTexture`,t.emissiveTexture,(e=>{e.name=`${n.name} (Emissive)`,n.emissiveTexture=e}))),Promise.all(s).then((()=>{}))}loadMaterialAlphaProperties(e,t,n){if(!(n instanceof d.Y))throw new Error(`${e}: Material type not supported`);switch(t.alphaMode||"OPAQUE"){case"OPAQUE":n.transparencyMode=d.Y.PBRMATERIAL_OPAQUE,n.alpha=1;break;case"MASK":n.transparencyMode=d.Y.PBRMATERIAL_ALPHATEST,n.alphaCutOff=null==t.alphaCutoff?.5:t.alphaCutoff,n.albedoTexture&&(n.albedoTexture.hasAlpha=!0);break;case"BLEND":n.transparencyMode=d.Y.PBRMATERIAL_ALPHABLEND,n.albedoTexture&&(n.albedoTexture.hasAlpha=!0,n.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${e}/alphaMode: Invalid value (${t.alphaMode})`)}}loadTextureInfoAsync(e,t,n=()=>{}){const s=this._extensionsLoadTextureInfoAsync(e,t,n);if(s)return s;if(this.logOpen(`${e}`),t.texCoord>=6)throw new Error(`${e}/texCoord: Invalid value (${t.texCoord})`);const o=H.Get(`${e}/index`,this._gltf.textures,t.index);o._textureInfo=t;const a=this._loadTextureAsync(`/textures/${t.index}`,o,(s=>{s.coordinatesIndex=t.texCoord||0,Y.AddPointerMetadata(s,e),this._parent.onTextureLoadedObservable.notifyObservers(s),n(s)}));return this.logClose(),a}_loadTextureAsync(e,t,n=()=>{}){const s=this._extensionsLoadTextureAsync(e,t,n);if(s)return s;this.logOpen(`${e} ${t.name||""}`);const o=null==t.sampler?Y.DefaultSampler:H.Get(`${e}/sampler`,this._gltf.samplers,t.sampler),a=H.Get(`${e}/source`,this._gltf.images,t.source),r=this._createTextureAsync(e,o,a,n,void 0,!t._textureInfo.nonColorData);return this.logClose(),r}_createTextureAsync(e,t,n,o=()=>{},a,r){const i=this._loadSampler(`/samplers/${t.index}`,t),l=new Array,c=new s.c;this._babylonScene._blockEntityCollection=!!this._assetContainer;const h={noMipmap:i.noMipMaps,invertY:!1,samplingMode:i.samplingMode,onLoad:()=>{this._disposed||c.resolve()},onError:(t,n)=>{this._disposed||c.reject(new Error(`${e}: ${n&&n.message?n.message:t||"Failed to load texture"}`))},mimeType:n.mimeType,loaderOptions:a,useSRGBBuffer:!!r&&this._parent.useSRGBBuffers},u=new p.g(null,this._babylonScene,h);return u._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,l.push(c.promise),l.push(this.loadImageAsync(`/images/${n.index}`,n).then((e=>{const t=n.uri||`${this._fileName}#image${n.index}`,s=`data:${this._uniqueRootUrl}${t}`;u.updateURL(s,e);const o=u.getInternalTexture();o&&(o.label=n.name)}))),u.wrapU=i.wrapU,u.wrapV=i.wrapV,o(u),this._parent.useGltfTextureNames&&(u.name=n.name||n.uri||`image${n.index}`),Promise.all(l).then((()=>u))}_loadSampler(e,t){return t._data||(t._data={noMipMaps:9728===t.minFilter||9729===t.minFilter,samplingMode:Y._GetTextureSamplingMode(e,t),wrapU:Y._GetTextureWrapMode(`${e}/wrapS`,t.wrapS),wrapV:Y._GetTextureWrapMode(`${e}/wrapT`,t.wrapT)}),t._data}loadImageAsync(e,t){if(!t._data){if(this.logOpen(`${e} ${t.name||""}`),t.uri)t._data=this.loadUriAsync(`${e}/uri`,t,t.uri);else{const n=H.Get(`${e}/bufferView`,this._gltf.bufferViews,t.bufferView);t._data=this.loadBufferViewAsync(`/bufferViews/${n.index}`,n)}this.logClose()}return t._data}loadUriAsync(e,t,n){const s=this._extensionsLoadUriAsync(e,t,n);if(s)return s;if(!Y._ValidateUri(n))throw new Error(`${e}: '${n}' is invalid`);if((0,k.f2)(n)){const t=new Uint8Array((0,k.rz)(n));return this.log(`${e}: Decoded ${n.substring(0,64)}... (${t.length} bytes)`),Promise.resolve(t)}return this.log(`${e}: Loading ${n}`),this._parent.preprocessUrlAsync(this._rootUrl+n).then((t=>new Promise(((s,o)=>{this._parent._loadFile(this._babylonScene,t,(t=>{this._disposed||(this.log(`${e}: Loaded ${n} (${t.byteLength} bytes)`),s(new Uint8Array(t)))}),!0,(t=>{o(new k.hX(`${e}: Failed to load '${n}'${t?": "+t.status+" "+t.statusText:""}`,t))}))}))))}static AddPointerMetadata(e,t){e.metadata=e.metadata||{};const n=e._internalMetadata=e._internalMetadata||{},s=n.gltf=n.gltf||{};(s.pointers=s.pointers||[]).push(t)}static _GetTextureWrapMode(e,t){switch(t=null==t?10497:t){case 33071:return p.g.CLAMP_ADDRESSMODE;case 33648:return p.g.MIRROR_ADDRESSMODE;case 10497:return p.g.WRAP_ADDRESSMODE;default:return w.V.Warn(`${e}: Invalid value (${t})`),p.g.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(e,t){const n=null==t.magFilter?9729:t.magFilter,s=null==t.minFilter?9987:t.minFilter;if(9729===n)switch(s){case 9728:return p.g.LINEAR_NEAREST;case 9729:return p.g.LINEAR_LINEAR;case 9984:return p.g.LINEAR_NEAREST_MIPNEAREST;case 9985:return p.g.LINEAR_LINEAR_MIPNEAREST;case 9986:return p.g.LINEAR_NEAREST_MIPLINEAR;case 9987:return p.g.LINEAR_LINEAR_MIPLINEAR;default:return w.V.Warn(`${e}/minFilter: Invalid value (${s})`),p.g.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==n&&w.V.Warn(`${e}/magFilter: Invalid value (${n})`),s){case 9728:return p.g.NEAREST_NEAREST;case 9729:return p.g.NEAREST_LINEAR;case 9984:return p.g.NEAREST_NEAREST_MIPNEAREST;case 9985:return p.g.NEAREST_LINEAR_MIPNEAREST;case 9986:return p.g.NEAREST_NEAREST_MIPLINEAR;case 9987:return p.g.NEAREST_LINEAR_MIPLINEAR;default:return w.V.Warn(`${e}/minFilter: Invalid value (${s})`),p.g.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(e,t){try{return(0,U.w)(t)}catch(t){throw new Error(`${e}: ${t.message}`)}}static _GetTypedArray(e,t,n,s,o){const a=n.buffer;s=n.byteOffset+(s||0);const r=Y._GetTypedArrayConstructor(`${e}/componentType`,t),i=m.R.GetTypeByteLength(t);return s%i!=0?(w.V.Warn(`${e}: Copying buffer as byte offset (${s}) is not a multiple of component type byte length (${i})`),new r(a.slice(s,s+o*i),0)):new r(a,s,o)}static _GetNumComponents(e,t){switch(t){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${e}: Invalid type (${t})`)}static _ValidateUri(e){return r.S0.IsBase64(e)||-1===e.indexOf("..")}static _GetDrawMode(e,t){switch(null==t&&(t=4),t){case 0:return u.i.PointListDrawMode;case 1:return u.i.LineListDrawMode;case 2:return u.i.LineLoopDrawMode;case 3:return u.i.LineStripDrawMode;case 4:return u.i.TriangleFillMode;case 5:return u.i.TriangleStripDrawMode;case 6:return u.i.TriangleFanDrawMode}throw new Error(`${e}: Invalid mesh primitive mode (${t})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const e=new Array;if(this._gltf.materials)for(const t of this._gltf.materials)if(t._data)for(const n in t._data){const s=t._data[n];for(const t of s.babylonMeshes){t.computeWorldMatrix(!0);const n=s.babylonMaterial;e.push(n.forceCompilationAsync(t)),e.push(n.forceCompilationAsync(t,{useInstances:!0})),this._parent.useClipPlane&&(e.push(n.forceCompilationAsync(t,{clipPlane:!0})),e.push(n.forceCompilationAsync(t,{clipPlane:!0,useInstances:!0})))}}return Promise.all(e).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const e=new Array,t=this._babylonScene.lights;for(const n of t){const t=n.getShadowGenerator();t&&e.push(t.forceCompilationAsync())}return Promise.all(e).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(e){for(const t of this._extensions)t.enabled&&e(t)}_applyExtensions(e,t,n){for(const s of this._extensions)if(s.enabled){const o=`${s.name}.${t}`,a=e;a._activeLoaderExtensionFunctions=a._activeLoaderExtensionFunctions||{};const r=a._activeLoaderExtensionFunctions;if(!r[o]){r[o]=!0;try{const e=n(s);if(e)return e}finally{delete r[o]}}}return null}_extensionsOnLoading(){this._forEachExtensions((e=>e.onLoading&&e.onLoading()))}_extensionsOnReady(){this._forEachExtensions((e=>e.onReady&&e.onReady()))}_extensionsLoadSceneAsync(e,t){return this._applyExtensions(t,"loadScene",(n=>n.loadSceneAsync&&n.loadSceneAsync(e,t)))}_extensionsLoadNodeAsync(e,t,n){return this._applyExtensions(t,"loadNode",(s=>s.loadNodeAsync&&s.loadNodeAsync(e,t,n)))}_extensionsLoadCameraAsync(e,t,n){return this._applyExtensions(t,"loadCamera",(s=>s.loadCameraAsync&&s.loadCameraAsync(e,t,n)))}_extensionsLoadVertexDataAsync(e,t,n){return this._applyExtensions(t,"loadVertexData",(s=>s._loadVertexDataAsync&&s._loadVertexDataAsync(e,t,n)))}_extensionsLoadMeshPrimitiveAsync(e,t,n,s,o,a){return this._applyExtensions(o,"loadMeshPrimitive",(r=>r._loadMeshPrimitiveAsync&&r._loadMeshPrimitiveAsync(e,t,n,s,o,a)))}_extensionsLoadMaterialAsync(e,t,n,s,o){return this._applyExtensions(t,"loadMaterial",(a=>a._loadMaterialAsync&&a._loadMaterialAsync(e,t,n,s,o)))}_extensionsCreateMaterial(e,t,n){return this._applyExtensions(t,"createMaterial",(s=>s.createMaterial&&s.createMaterial(e,t,n)))}_extensionsLoadMaterialPropertiesAsync(e,t,n){return this._applyExtensions(t,"loadMaterialProperties",(s=>s.loadMaterialPropertiesAsync&&s.loadMaterialPropertiesAsync(e,t,n)))}_extensionsLoadTextureInfoAsync(e,t,n){return this._applyExtensions(t,"loadTextureInfo",(s=>s.loadTextureInfoAsync&&s.loadTextureInfoAsync(e,t,n)))}_extensionsLoadTextureAsync(e,t,n){return this._applyExtensions(t,"loadTexture",(s=>s._loadTextureAsync&&s._loadTextureAsync(e,t,n)))}_extensionsLoadAnimationAsync(e,t){return this._applyExtensions(t,"loadAnimation",(n=>n.loadAnimationAsync&&n.loadAnimationAsync(e,t)))}_extensionsLoadAnimationChannelAsync(e,t,n,s,o){return this._applyExtensions(n,"loadAnimationChannel",(a=>a._loadAnimationChannelAsync&&a._loadAnimationChannelAsync(e,t,n,s,o)))}_extensionsLoadSkinAsync(e,t,n){return this._applyExtensions(n,"loadSkin",(s=>s._loadSkinAsync&&s._loadSkinAsync(e,t,n)))}_extensionsLoadUriAsync(e,t,n){return this._applyExtensions(t,"loadUri",(s=>s._loadUriAsync&&s._loadUriAsync(e,t,n)))}_extensionsLoadBufferViewAsync(e,t){return this._applyExtensions(t,"loadBufferView",(n=>n.loadBufferViewAsync&&n.loadBufferViewAsync(e,t)))}_extensionsLoadBufferAsync(e,t,n,s){return this._applyExtensions(t,"loadBuffer",(o=>o.loadBufferAsync&&o.loadBufferAsync(e,t,n,s)))}static LoadExtensionAsync(e,t,n,s){if(!t.extensions)return null;const o=t.extensions[n];return o?s(`${e}/extensions/${n}`,o):null}static LoadExtraAsync(e,t,n,s){if(!t.extras)return null;const o=t.extras[n];return o?s(`${e}/extras/${n}`,o):null}isExtensionUsed(e){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(e)}logOpen(e){this._parent._logOpen(e)}logClose(){this._parent._logClose()}log(e){this._parent._log(e)}startPerformanceCounter(e){this._parent._startPerformanceCounter(e)}endPerformanceCounter(e){this._parent._endPerformanceCounter(e)}}Y.DefaultSampler={index:-1},N._CreateGLTF2Loader=e=>new Y(e)},48966:(e,t,n)=>{n.d(t,{KD:()=>r,X6:()=>a,rO:()=>i});var s=n(51137),o=n(4720);function a(e){const[t,n]=e.split(":");return r({op:t,extension:n})}function r(e,t=!0){const n=e.extension?l[e.extension]?.[e.op]:c[e.op];if(!n&&(s.V.Warn(`No mapping found for operation ${e.op} and extension ${e.extension||"KHR_interactivity"}`),t)){const t={},n={flows:{}};if(e.inputValueSockets){t.values={};for(const n in e.inputValueSockets)t.values[n]={name:n}}return e.outputValueSockets&&(n.values={},Object.keys(e.outputValueSockets).forEach((e=>{n.values[e]={name:e}}))),{blocks:[],inputs:t,outputs:n}}return n}function i(e,t,n){l[t]||(l[t]={}),l[t][e]=n}const l={BABYLON:{"flow/log":{blocks:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},c={"event/onStart":{blocks:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{blocks:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{blocks:["FlowGraphSendCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},extraProcessor(e,t,n,s,o){if("event/send"!==t.op||!e.configuration||1!==Object.keys(e.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const a=e.configuration.event.value[0];if("number"!=typeof a)throw new Error("Event id should be a number");const r=s.arrays.events[a],i=o[0];return i.config||(i.config={}),i.config.eventId=r.eventId,i.config.eventData=r.eventData,o}},"event/receive":{blocks:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(e,t){if(!e.configuration)return s.V.Error("Receive event should have a configuration object"),!1;const n=e.configuration.event;if(!n)return s.V.Error("Receive event should have a single configuration object, the event itself"),!1;const o=n.value[0];if("number"!=typeof o)return s.V.Error("Event id should be a number"),!1;const a=t.events?.[o];return!!a||(s.V.Error(`Event with id ${o} not found`),!1)},extraProcessor(e,t,n,s,o){if("event/receive"!==t.op||!e.configuration||1!==Object.keys(e.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const a=e.configuration.event.value[0];if("number"!=typeof a)throw new Error("Event id should be a number");const r=s.arrays.events[a],i=o[0];return i.config||(i.config={}),i.config.eventId=r.eventId,i.config.eventData=r.eventData,o}},"math/e":h("FlowGraphEBlock"),"math/pi":h("FlowGraphPIBlock"),"math/inf":h("FlowGraphInfBlock"),"math/nan":h("FlowGraphNaNBlock"),"math/abs":h("FlowGraphAbsBlock"),"math/sign":h("FlowGraphSignBlock"),"math/trunc":h("FlowGraphTruncBlock"),"math/floor":h("FlowGraphFloorBlock"),"math/ceil":h("FlowGraphCeilBlock"),"math/round":{blocks:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor:(e,t,n,s,o)=>(o[0].config=o[0].config||{},o[0].config.roundHalfAwayFromZero=!0,o)},"math/fract":h("FlowGraphFractBlock"),"math/neg":h("FlowGraphNegationBlock"),"math/add":h("FlowGraphAddBlock",["a","b"],!0),"math/sub":h("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{blocks:["FlowGraphMultiplyBlock"],extraProcessor(e,t,n,s,o){o[0].config=o[0].config||{},o[0].config.useMatrixPerComponent=!0;let a=-1;return Object.keys(e.values||{}).find((t=>void 0!==e.values?.[t].type&&(a=e.values[t].type,!0))),-1!==a&&(o[0].config.type=s.arrays.types[a].flowGraphType),o}},"math/div":h("FlowGraphDivideBlock",["a","b"],!0),"math/rem":h("FlowGraphModuloBlock",["a","b"]),"math/min":h("FlowGraphMinBlock",["a","b"]),"math/max":h("FlowGraphMaxBlock",["a","b"]),"math/clamp":h("FlowGraphClampBlock",["a","b","c"]),"math/saturate":h("FlowGraphSaturateBlock"),"math/mix":h("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":h("FlowGraphEqualityBlock",["a","b"]),"math/lt":h("FlowGraphLessThanBlock",["a","b"]),"math/le":h("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":h("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":h("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":h("FlowGraphIsNaNBlock"),"math/isinf":h("FlowGraphIsInfBlock"),"math/select":{blocks:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{blocks:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":h("FlowGraphSinBlock"),"math/cos":h("FlowGraphCosBlock"),"math/tan":h("FlowGraphTanBlock"),"math/asin":h("FlowGraphASinBlock"),"math/acos":h("FlowGraphACosBlock"),"math/atan":h("FlowGraphATanBlock"),"math/atan2":h("FlowGraphATan2Block",["a","b"]),"math/sinh":h("FlowGraphSinhBlock"),"math/cosh":h("FlowGraphCoshBlock"),"math/tanh":h("FlowGraphTanhBlock"),"math/asinh":h("FlowGraphASinhBlock"),"math/acosh":h("FlowGraphACoshBlock"),"math/atanh":h("FlowGraphATanhBlock"),"math/exp":h("FlowGraphExponentialBlock"),"math/log":h("FlowGraphLogBlock"),"math/log2":h("FlowGraphLog2Block"),"math/log10":h("FlowGraphLog10Block"),"math/sqrt":h("FlowGraphSquareRootBlock"),"math/cbrt":h("FlowGraphCubeRootBlock"),"math/pow":h("FlowGraphPowerBlock",["a","b"]),"math/length":h("FlowGraphLengthBlock"),"math/normalize":h("FlowGraphNormalizeBlock"),"math/dot":h("FlowGraphDotBlock",["a","b"]),"math/cross":h("FlowGraphCrossBlock",["a","b"]),"math/rotate2d":h("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3d":h("FlowGraphRotate3DBlock",["a","b","c"]),"math/transform":{blocks:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{blocks:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{blocks:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{blocks:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{blocks:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{blocks:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{blocks:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":h("FlowGraphTransposeBlock"),"math/determinant":h("FlowGraphDeterminantBlock"),"math/inverse":h("FlowGraphInvertMatrixBlock"),"math/matmul":h("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{blocks:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"scaling",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(e,t,n,s,o,a){const r=o[0].dataInputs.find((e=>"rotationQuaternion"===e.name));if(!r)throw new Error("Rotation quaternion input not found");return a._connectionValues[r.uniqueId]&&(a._connectionValues[r.uniqueId].type="Quaternion"),o}},"math/matDecompose":{blocks:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"scaling"}}}},"math/combine2x2":{blocks:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor:(e,t,n,s,o)=>(o[0].config=o[0].config||{},o[0].config.inputIsColumnMajor=!0,o)},"math/extract2x2":{blocks:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{blocks:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor:(e,t,n,s,o)=>(o[0].config=o[0].config||{},o[0].config.inputIsColumnMajor=!0,o)},"math/extract3x3":{blocks:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{blocks:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor:(e,t,n,s,o)=>(o[0].config=o[0].config||{},o[0].config.inputIsColumnMajor=!0,o)},"math/extract4x4":{blocks:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/compose":{blocks:["FlowGraphMatrixCompose"],configuration:{},inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"scaling",gltfType:"float3"}}},outputs:{values:{value:{name:"output"}}}},"math/decompose":{blocks:["FlowGraphMatrixDecompose"],configuration:{},inputs:{values:{a:{name:"input"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"scaling"}}}},"math/not":{blocks:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(e,t,n,s,o,a){o[0].config=o[0].config||{};const r=o[0].dataInputs[0];return o[0].config.valueType=a._connectionValues[r.uniqueId]?.type??"FlowGraphInteger",o}},"math/and":{blocks:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(e,t,n,s,o,a){o[0].config=o[0].config||{};const r=o[0].dataInputs[0],i=o[0].dataInputs[1];return o[0].config.valueType=a._connectionValues[r.uniqueId]?.type??a._connectionValues[i.uniqueId]?.type??"FlowGraphInteger",o}},"math/or":{blocks:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(e,t,n,s,o,a){o[0].config=o[0].config||{};const r=o[0].dataInputs[0],i=o[0].dataInputs[1];return o[0].config.valueType=a._connectionValues[r.uniqueId]?.type??a._connectionValues[i.uniqueId]?.type??"FlowGraphInteger",o}},"math/xor":{blocks:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(e,t,n,s,o,a){o[0].config=o[0].config||{};const r=o[0].dataInputs[0],i=o[0].dataInputs[1];return o[0].config.valueType=a._connectionValues[r.uniqueId]?.type??a._connectionValues[i.uniqueId]?.type??"FlowGraphInteger",o}},"math/asr":h("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":h("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":h("FlowGraphLeadingZerosBlock"),"math/ctz":h("FlowGraphTrailingZerosBlock"),"math/popcnt":h("FlowGraphOneBitsCounterBlock"),"math/rad":h("FlowGraphDegToRadBlock"),"math/deg":h("FlowGraphRadToDegBlock"),"type/boolToInt":h("FlowGraphBooleanToInt"),"type/boolToFloat":h("FlowGraphBooleanToFloat"),"type/intToBool":h("FlowGraphIntToBoolean"),"type/intToFloat":h("FlowGraphIntToFloat"),"type/floatToInt":h("FlowGraphFloatToInt"),"type/floatToBool":h("FlowGraphFloatToBoolean"),"flow/sequence":{blocks:["FlowGraphSequenceBlock"],extraProcessor(e,t,n,s,o){const a=o[0];return a.config||(a.config={}),a.config.outputSignalCount=Object.keys(e.flows||[]).length,a.signalOutputs.forEach(((e,t)=>{e.name="out_"+t})),o}},"flow/branch":{blocks:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{blocks:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(e){if(e.configuration&&e.configuration.cases){const t=e.configuration.cases.value;if(!t.every((e=>"number"==typeof e&&/^\d+$/.test(e.toString()))))return e.configuration.cases.value=[],!0;const n=new Set(t);e.configuration.cases.value=Array.from(n)}return!0},extraProcessor(e,t,n,s,o){if("flow/switch"!==t.op||!e.flows||0===Object.keys(e.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return o[0].signalOutputs.forEach((e=>{"default"!==e.name&&(e.name="out_"+e.name)})),o}},"flow/while":{blocks:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{blocks:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}}},"flow/doN":{blocks:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{blocks:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(e,t,n,s,o){if("flow/multiGate"!==t.op||!e.flows||0===Object.keys(e.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const a=o[0];return a.config||(a.config={}),a.config.outputSignalCount=Object.keys(e.flows).length,a.signalOutputs.forEach(((e,t)=>{e.name="out_"+t})),o}},"flow/waitAll":{blocks:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{"[segment]":{name:"in_$1"}}},validation:e=>("number"!=typeof e.configuration?.inputFlows?.value[0]&&(e.configuration=e.configuration||{inputFlows:{value:[0]}},e.configuration.inputFlows.value=[0]),!0)},"flow/throttle":{blocks:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{blocks:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{blocks:["FlowGraphCancelDelayBlock"]},"variable/get":{blocks:["FlowGraphGetVariableBlock"],validation:e=>!!e.configuration?.variable?.value||(s.V.Error("Variable get block should have a variable configuration"),!1),configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(e,t)=>[t.getVariableName(e[0])]}}},"variable/set":{blocks:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(e,t)=>[t.getVariableName(e[0])]}}},"variable/setMultiple":{blocks:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(e,t)=>[e[0].map((e=>t.getVariableName(e)))]}},extraProcessor:(e,t,n,s,o)=>(o[0].dataInputs.forEach((e=>{e.name=s.getVariableName(+e.name)})),o)},"variable/interpolate":{blocks:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(e,t)=>[t.getVariableName(e[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:e=>!0===e[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",toBlock:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",toBlock:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",toBlock:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",toBlock:"FlowGraphPlayAnimationBlock"},out:{name:"out",toBlock:"FlowGraphPlayAnimationBlock"},done:{name:"done",toBlock:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(e,t,n,a,r){var i,l;const c=r[0],h=e.configuration?.variable.value[0];if("number"!=typeof h)throw s.V.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const u=a.arrays.staticVariables[h];void 0===c.config.animationType.value&&(a.arrays.staticVariables,c.config.animationType.value=(0,o.U_)(u.type));const d=r[4];return d.config||(d.config={}),(i=d.config).variable||(i.variable={}),d.config.variable.value=a.getVariableName(h),(l=r[3]).config||(l.config={}),r}},"pointer/get":{blocks:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",toBlock:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",toBlock:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(e,t,n,s,o)=>(o.forEach((e=>{"FlowGraphJsonPointerParserBlock"===e.className&&(e.config||(e.config={}),e.config.outputValue=!0)})),o)},"pointer/set":{blocks:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",toBlock:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",toBlock:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(e,t,n,s,o)=>(o.forEach((e=>{"FlowGraphJsonPointerParserBlock"===e.className&&(e.config||(e.config={}),e.config.outputValue=!0)})),o)},"pointer/interpolate":{blocks:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphEasingBlock"],configuration:{pointer:{name:"jsonPointer",toBlock:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",toBlock:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",toBlock:"FlowGraphEasingBlock"},p2:{name:"controlPoint2",toBlock:"FlowGraphEasingBlock"}},flows:{in:{name:"in",toBlock:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",toBlock:"FlowGraphPlayAnimationBlock"},out:{name:"out",toBlock:"FlowGraphPlayAnimationBlock"},done:{name:"done",toBlock:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(e,t,n,s,o)=>(o.forEach((t=>{"FlowGraphJsonPointerParserBlock"===t.className?(t.config||(t.config={}),t.config.outputValue=!0):"FlowGraphInterpolationBlock"===t.className&&(t.config||(t.config={}),Object.keys(e.values||[]).forEach((n=>{const o=e.values?.[n];if("value"===n&&o){const e=o.type;void 0!==e&&(t.config.animationType=s.arrays.types[e].flowGraphType)}})))})),o)},"animation/start":{blocks:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",toBlock:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(e,t)=>[e[0]*t._loader.parent.targetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(e,t)=>[e[0]*t._loader.parent.targetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(e,t,n,s,o,a,r){const i=o[o.length-1];return i.config||(i.config={}),i.config.glTF=r,o}},"animation/stop":{blocks:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",toBlock:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(e,t,n,s,o,a,r){const i=o[o.length-1];return i.config||(i.config={}),i.config.glTF=r,o}},"animation/stopAt":{blocks:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",toBlock:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(e,t)=>[e[0]*t._loader.parent.targetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(e,t,n,s,o,a,r){const i=o[o.length-1];return i.config||(i.config={}),i.config.glTF=r,o}},"math/switch":{blocks:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(e){if(e.configuration&&e.configuration.cases){const t=e.configuration.cases.value;if(!t.every((e=>"number"==typeof e&&/^\d+$/.test(e.toString()))))return e.configuration.cases.value=[],!0;const n=new Set(t);e.configuration.cases.value=Array.from(n)}return!0},extraProcessor:(e,t,n,s,o)=>(o[0].dataInputs.forEach((e=>{"default"!==e.name&&"case"!==e.name&&(e.name="in_"+e.name)})),o)},"debug/log":{blocks:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function h(e,t=["a"],n){return{blocks:[e],inputs:{values:t.reduce(((e,t)=>(e[t]={name:t},e)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(e,t,s,o,a){if(n){a[0].config=a[0].config||{};let t=-1;Object.keys(e.values||{}).find((n=>void 0!==e.values?.[n].type&&(t=e.values[n].type,!0))),-1!==t&&(a[0].config.type=o.arrays.types[t].flowGraphType)}return a}}}},49532:(e,t,n)=>{n.d(t,{oR:()=>m,tQ:()=>p,Wt:()=>d,ZU:()=>_});var s=n(79923),o=n(96125),a=n(26041),r=n(40136);class i{constructor(e,t){this._gltf=e,this._infoTree=t}convert(e){let t,n=this._gltf,s=this._infoTree;if(!e.startsWith("/"))throw new Error("Path must start with a /");const o=e.split("/");if(o.shift(),o[o.length-1].includes(".length")){const e=o[o.length-1].split(".");o.pop(),o.push(...e)}let a=!1;for(const r of o){const o="length"===r;if(o&&!s.__array__)throw new Error(`Path ${e} is invalid`);if(s.__ignoreObjectTree__&&(a=!0),s.__array__&&!o)s=s.__array__;else if(s=s[r],!s)throw new Error(`Path ${e} is invalid`);if(!a){if(void 0===n)throw new Error(`Path ${e} is invalid`);o||(n=n?.[r])}(s.__target__||o)&&(t=n)}return{object:t,info:s}}}function l(e,t,n,s){const o=c(e);return s?o[n][s]:o[n]}function c(e,t,n){return e._data?.[n?.fillMode??o.Y.MATERIAL_TriangleFillMode]?.babylonMaterial}function h(e,t){return{offset:{componentsCount:2,type:"Vector2",get:(n,o,a)=>{const r=l(n,0,e,t);return new s.I9(r?.uOffset,r?.vOffset)},getTarget:c,set:(n,s,o,a)=>{const r=l(s,0,e,t);r.uOffset=n.x,r.vOffset=n.y},getPropertyName:[()=>`${e}${t?"."+t:""}.uOffset`,()=>`${e}${t?"."+t:""}.vOffset`]},rotation:{type:"number",get:(n,s,o)=>l(n,0,e,t)?.wAng,getTarget:c,set:(n,s,o,a)=>l(s,0,e,t).wAng=n,getPropertyName:[()=>`${e}${t?"."+t:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(n,o,a)=>{const r=l(n,0,e,t);return new s.I9(r?.uScale,r?.vScale)},getTarget:c,set:(n,s,o,a)=>{const r=l(s,0,e,t);r.uScale=n.x,r.vScale=n.y},getPropertyName:[()=>`${e}${t?"."+t:""}.uScale`,()=>`${e}${t?"."+t:""}.vScale`]}}}const u={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:e=>new s.I9(e._babylonCamera?.orthoLeft??0,e._babylonCamera?.orthoRight??0),set:(e,t)=>{t._babylonCamera&&(t._babylonCamera.orthoLeft=e.x,t._babylonCamera.orthoRight=e.y)},getTarget:e=>e,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:e=>new s.I9(e._babylonCamera?.orthoBottom??0,e._babylonCamera?.orthoTop??0),set:(e,t)=>{t._babylonCamera&&(t._babylonCamera.orthoBottom=e.x,t._babylonCamera.orthoTop=e.y)},getTarget:e=>e,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:e=>e._babylonCamera?.maxZ,set:(e,t)=>{t._babylonCamera&&(t._babylonCamera.maxZ=e)},getTarget:e=>e,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:e=>e._babylonCamera?.minZ,set:(e,t)=>{t._babylonCamera&&(t._babylonCamera.minZ=e)},getTarget:e=>e,getPropertyName:[()=>"minZ"]}},perspective:{aspectRatio:{type:"number",get:e=>e._babylonCamera?.getEngine().getAspectRatio(e._babylonCamera),getTarget:e=>e,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:e=>e._babylonCamera?.fov,set:(e,t)=>{t._babylonCamera&&(t._babylonCamera.fov=e)},getTarget:e=>e,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:e=>e._babylonCamera?.maxZ,set:(e,t)=>{t._babylonCamera&&(t._babylonCamera.maxZ=e)},getTarget:e=>e,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:e=>e._babylonCamera?.minZ,set:(e,t)=>{t._babylonCamera&&(t._babylonCamera.minZ=e)},getTarget:e=>e,getPropertyName:[()=>"minZ"]}}}},nodes:{length:{type:"number",get:e=>e.length,getTarget:e=>e.map((e=>e._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"Vector3",get:e=>e._babylonTransformNode?.position,set:(e,t)=>t._babylonTransformNode?.position.copyFrom(e),getTarget:e=>e._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:e=>e._babylonTransformNode?.rotationQuaternion,set:(e,t)=>t._babylonTransformNode?.rotationQuaternion?.copyFrom(e),getTarget:e=>e._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"Vector3",get:e=>e._babylonTransformNode?.scaling,set:(e,t)=>t._babylonTransformNode?.scaling.copyFrom(e),getTarget:e=>e._babylonTransformNode,getPropertyName:[()=>"scaling"]},weights:{length:{type:"number",get:e=>e._numMorphTargets,getTarget:e=>e._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(e,t)=>void 0!==t?e._primitiveBabylonMeshes?.[0].morphTargetManager?.getTarget(t).influence:void 0,getTarget:e=>e._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(e,t)=>[0],getTarget:e=>e._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:e=>s.uq.Compose(e._babylonTransformNode?.scaling,e._babylonTransformNode?.rotationQuaternion,e._babylonTransformNode?.position),getTarget:e=>e._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:e=>{const t=s.uq.Identity();let n=e.parent;for(;n&&n.parent;)n=n.parent;const o=e._babylonTransformNode?.position._isDirty||e._babylonTransformNode?.rotationQuaternion?._isDirty||e._babylonTransformNode?.scaling._isDirty;if(n){const s=n._babylonTransformNode?.computeWorldMatrix(!0).invert();s&&e._babylonTransformNode?.computeWorldMatrix(o)?.multiplyToRef(s,t)}else e._babylonTransformNode&&t.copyFrom(e._babylonTransformNode.computeWorldMatrix(o));return t},getTarget:e=>e._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:e=>e._babylonTransformNode?.getChildren((e=>e instanceof r.n),!0)[0]?.intensity,getTarget:e=>e._babylonTransformNode?.getChildren((e=>e instanceof r.n),!0)[0],set:(e,t)=>{if(t._babylonTransformNode){const n=t._babylonTransformNode.getChildren((e=>e instanceof r.n),!0)[0];n&&(n.intensity=e)}}},color:{type:"Color3",get:e=>e._babylonTransformNode?.getChildren((e=>e instanceof r.n),!0)[0]?.diffuse,getTarget:e=>e._babylonTransformNode?.getChildren((e=>e instanceof r.n),!0)[0],set:(e,t)=>{if(t._babylonTransformNode){const n=t._babylonTransformNode.getChildren((e=>e instanceof r.n),!0)[0];n&&(n.diffuse=e)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"Color3",get:(e,t,n)=>c(e,0,n).emissiveColor,set:(e,t,n,s)=>c(t,0,s).emissiveColor.copyFrom(e),getTarget:(e,t,n)=>c(e,0,n),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:h("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(e,t,n)=>l(e,0,"bumpTexture")?.level,set:(e,t,n,s)=>{const o=l(t,0,"bumpTexture");o&&(o.level=e)},getTarget:(e,t,n)=>c(e,0,n),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:h("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(e,t,n)=>c(e,0,n).ambientTextureStrength,set:(e,t,n,s)=>{const o=c(t,0,s);o&&(o.ambientTextureStrength=e)},getTarget:(e,t,n)=>c(e,0,n),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:h("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"Color4",get:(e,t,n)=>{const s=c(e,0,n);return a.ov.FromColor3(s.albedoColor,s.alpha)},set:(e,t,n,s)=>{const o=c(t,0,s);o.albedoColor.set(e.r,e.g,e.b),o.alpha=e.a},getTarget:(e,t,n)=>c(e,0,n),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:h("albedoTexture")}},metallicFactor:{type:"number",get:(e,t,n)=>c(e,0,n).metallic,set:(e,t,n,s)=>{const o=c(t,0,s);o&&(o.metallic=e)},getTarget:(e,t,n)=>c(e,0,n),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(e,t,n)=>c(e,0,n).roughness,set:(e,t,n,s)=>{const o=c(t,0,s);o&&(o.roughness=e)},getTarget:(e,t,n)=>c(e,0,n),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:h("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(e,t,n)=>c(e,0,n).anisotropy.intensity,set:(e,t,n,s)=>{c(t,0,s).anisotropy.intensity=e},getTarget:(e,t,n)=>c(e,0,n),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(e,t,n)=>c(e,0,n).anisotropy.angle,set:(e,t,n,s)=>{c(t,0,s).anisotropy.angle=e},getTarget:(e,t,n)=>c(e,0,n),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:h("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(e,t,n)=>c(e,0,n).clearCoat.intensity,set:(e,t,n,s)=>{c(t,0,s).clearCoat.intensity=e},getTarget:(e,t,n)=>c(e,0,n),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(e,t,n)=>c(e,0,n).clearCoat.roughness,set:(e,t,n,s)=>{c(t,0,s).clearCoat.roughness=e},getTarget:(e,t,n)=>c(e,0,n),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:h("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(e,t,n)=>c(e,0,n).clearCoat.bumpTexture?.level,getTarget:c,set:(e,t,n,s)=>c(t,0,s).clearCoat.bumpTexture.level=e},extensions:{KHR_texture_transform:h("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:h("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(e,t,n)=>c(e,0,n).subSurface.dispersion,getTarget:c,set:(e,t,n,s)=>c(t,0,s).subSurface.dispersion=e}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(e,t,n)=>c(e,0,n).emissiveIntensity,getTarget:c,set:(e,t,n,s)=>c(t,0,s).emissiveIntensity=e}},KHR_materials_ior:{ior:{type:"number",get:(e,t,n)=>c(e,0,n).indexOfRefraction,getTarget:c,set:(e,t,n,s)=>c(t,0,s).indexOfRefraction=e}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(e,t,n)=>c(e,0,n).iridescence.intensity,getTarget:c,set:(e,t,n,s)=>c(t,0,s).iridescence.intensity=e},iridescenceIor:{type:"number",get:(e,t,n)=>c(e,0,n).iridescence.indexOfRefraction,getTarget:c,set:(e,t,n,s)=>c(t,0,s).iridescence.indexOfRefraction=e},iridescenceTexture:{extensions:{KHR_texture_transform:h("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(e,t,n)=>c(e,0,n).iridescence.maximumThickness,getTarget:c,set:(e,t,n,s)=>c(t,0,s).iridescence.maximumThickness=e},iridescenceThicknessMinimum:{type:"number",get:(e,t,n)=>c(e,0,n).iridescence.minimumThickness,getTarget:c,set:(e,t,n,s)=>c(t,0,s).iridescence.minimumThickness=e},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:h("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"Color3",get:(e,t,n)=>c(e,0,n).sheen.color,getTarget:c,set:(e,t,n,s)=>c(t,0,s).sheen.color.copyFrom(e)},sheenColorTexture:{extensions:{KHR_texture_transform:h("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(e,t,n)=>c(e,0,n).sheen.intensity,getTarget:c,set:(e,t,n,s)=>c(t,0,s).sheen.intensity=e},sheenRoughnessTexture:{extensions:{KHR_texture_transform:h("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(e,t,n)=>c(e,0,n).metallicF0Factor,getTarget:c,set:(e,t,n,s)=>c(t,0,s).metallicF0Factor=e,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"Color3",get:(e,t,n)=>c(e,0,n).metallicReflectanceColor,getTarget:c,set:(e,t,n,s)=>c(t,0,s).metallicReflectanceColor.copyFrom(e),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:h("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:h("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(e,t,n)=>c(e,0,n).subSurface.refractionIntensity,getTarget:c,set:(e,t,n,s)=>c(t,0,s).subSurface.refractionIntensity=e,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:h("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(e,t,n)=>c(e,0,n).subSurface.translucencyIntensity,getTarget:c,set:(e,t,n,s)=>c(t,0,s).subSurface.translucencyIntensity=e},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:h("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"Color3",get:(e,t,n)=>c(e,0,n).subSurface.translucencyColor,getTarget:c,set:(e,t,n,s)=>e&&c(t,0,s).subSurface.translucencyColor?.copyFrom(e)},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:h("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"Color3",get:(e,t,n)=>c(e,0,n).subSurface.tintColor,getTarget:c,set:(e,t,n,s)=>c(t,0,s).subSurface.tintColor.copyFrom(e)},attenuationDistance:{type:"number",get:(e,t,n)=>c(e,0,n).subSurface.tintColorAtDistance,getTarget:c,set:(e,t,n,s)=>c(t,0,s).subSurface.tintColorAtDistance=e},thicknessFactor:{type:"number",get:(e,t,n)=>c(e,0,n).subSurface.maximumThickness,getTarget:c,set:(e,t,n,s)=>c(t,0,s).subSurface.maximumThickness=e},thicknessTexture:{extensions:{KHR_texture_transform:h("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:e=>e.length,getTarget:e=>e.map((e=>e._babylonLight)),getPropertyName:[e=>"length"]},__array__:{__target__:!0,color:{type:"Color3",get:e=>e._babylonLight?.diffuse,set:(e,t)=>t._babylonLight?.diffuse.copyFrom(e),getTarget:e=>e._babylonLight,getPropertyName:[e=>"diffuse"]},intensity:{type:"number",get:e=>e._babylonLight?.intensity,set:(e,t)=>t._babylonLight?t._babylonLight.intensity=e:void 0,getTarget:e=>e._babylonLight,getPropertyName:[e=>"intensity"]},range:{type:"number",get:e=>e._babylonLight?.range,set:(e,t)=>t._babylonLight?t._babylonLight.range=e:void 0,getTarget:e=>e._babylonLight,getPropertyName:[e=>"range"]},spot:{innerConeAngle:{type:"number",get:e=>e._babylonLight?.innerAngle,set:(e,t)=>t._babylonLight?t._babylonLight.innerAngle=e:void 0,getTarget:e=>e._babylonLight,getPropertyName:[e=>"innerConeAngle"]},outerConeAngle:{type:"number",get:e=>e._babylonLight?.angle,set:(e,t)=>t._babylonLight?t._babylonLight.angle=e:void 0,getTarget:e=>e._babylonLight,getPropertyName:[e=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:e=>e.length,getTarget:e=>e.map((e=>e._babylonLight)),getPropertyName:[e=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:e=>e.length,getTarget:e=>e.map((e=>e._babylonTexture)),getPropertyName:[e=>"length"]},__array__:{__target__:!0,intensity:{type:"number",get:e=>e._babylonTexture?.level,set:(e,t)=>{t._babylonTexture&&(t._babylonTexture.level=e)},getTarget:e=>e._babylonTexture},rotation:{type:"Quaternion",get:e=>e._babylonTexture&&s.PT.FromRotationMatrix(e._babylonTexture?.getReflectionTextureMatrix()),set:(e,t)=>{t._babylonTexture&&(t._babylonTexture.getScene()?.useRightHandedSystem||(e=s.PT.Inverse(e)),s.uq.FromQuaternionToRef(e,t._babylonTexture.getReflectionTextureMatrix()))},getTarget:e=>e._babylonTexture}}}}},animations:{length:{type:"number",get:e=>e.length,getTarget:e=>e.map((e=>e._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:e=>e.length,getTarget:e=>e.map((e=>e.primitives[0]._instanceData?.babylonSourceMesh)),getPropertyName:[()=>"length"]},__array__:{}}};function d(e){return new i(e,u)}function p(e){const t=e.split("/").map((e=>e.replace(/{}/g,"__array__")));let n=u;for(const e of t)e&&(n=n[e]);if(n&&n.type&&n.get)return n}function _(e,t){const n=e.split("/").map((e=>e.replace(/{}/g,"__array__")));let s=u;for(const e of n)e&&(s=s[e]);s&&s.type&&s.get&&(s.interpolation=t)}function m(e,t){const n=e.split("/").map((e=>e.replace(/{}/g,"__array__")));let s=u;for(const e of n)if(e){if(!s[e]){if("?"===e){s.__ignoreObjectTree__=!0;continue}s[e]={},"__array__"===e&&(s[e].__target__=!0)}s=s[e]}Object.assign(s,t)}},52593:(e,t,n)=>{n.d(t,{KHR_materials_pbrSpecularGlossiness:()=>l});var s=n(26041),o=n(23975),a=n(45316),r=n(37812);const i="KHR_materials_pbrSpecularGlossiness";class l{constructor(e){this.name=i,this.order=200,this._loader=e,this.enabled=this._loader.isExtensionUsed(i)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,t,n){return a.BT.LoadExtensionAsync(e,t,this.name,((s,o)=>{const a=new Array;return a.push(this._loader.loadMaterialBasePropertiesAsync(e,t,n)),a.push(this._loadSpecularGlossinessPropertiesAsync(s,o,n)),this._loader.loadMaterialAlphaProperties(e,t,n),Promise.all(a).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(e,t,n){if(!(n instanceof o.Y))throw new Error(`${e}: Material type not supported`);const a=new Array;return n.metallic=null,n.roughness=null,t.diffuseFactor?(n.albedoColor=s.v9.FromArray(t.diffuseFactor),n.alpha=t.diffuseFactor[3]):n.albedoColor=s.v9.White(),n.reflectivityColor=t.specularFactor?s.v9.FromArray(t.specularFactor):s.v9.White(),n.microSurface=null==t.glossinessFactor?1:t.glossinessFactor,t.diffuseTexture&&a.push(this._loader.loadTextureInfoAsync(`${e}/diffuseTexture`,t.diffuseTexture,(e=>{e.name=`${n.name} (Diffuse)`,n.albedoTexture=e}))),t.specularGlossinessTexture&&(a.push(this._loader.loadTextureInfoAsync(`${e}/specularGlossinessTexture`,t.specularGlossinessTexture,(e=>{e.name=`${n.name} (Specular Glossiness)`,n.reflectivityTexture=e,n.reflectivityTexture.hasAlpha=!0}))),n.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(a).then((()=>{}))}}(0,r.Hg)(i),(0,r.Ye)(i,!0,(e=>new l(e)))},53155:(e,t,n)=>{n.d(t,{KHR_materials_diffuse_transmission:()=>l});var s=n(23975),o=n(45316),a=n(26041),r=n(37812);const i="KHR_materials_diffuse_transmission";class l{constructor(e){this.name=i,this.order=174,this._loader=e,this.enabled=this._loader.isExtensionUsed(i),this.enabled&&(e.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,t,n){return o.BT.LoadExtensionAsync(e,t,this.name,((s,o)=>{const a=new Array;return a.push(this._loader.loadMaterialPropertiesAsync(e,t,n)),a.push(this._loadTranslucentPropertiesAsync(s,t,n,o)),Promise.all(a).then((()=>{}))}))}_loadTranslucentPropertiesAsync(e,t,n,o){if(!(n instanceof s.Y))throw new Error(`${e}: Material type not supported`);const r=n;if(r.subSurface.isTranslucencyEnabled=!0,r.subSurface.volumeIndexOfRefraction=1,r.subSurface.minimumThickness=0,r.subSurface.maximumThickness=0,r.subSurface.useAlbedoToTintTranslucency=!1,void 0===o.diffuseTransmissionFactor)return r.subSurface.translucencyIntensity=0,r.subSurface.isTranslucencyEnabled=!1,Promise.resolve();r.subSurface.translucencyIntensity=o.diffuseTransmissionFactor;const i=new Array;return r.subSurface.useGltfStyleTextures=!0,o.diffuseTransmissionTexture&&(o.diffuseTransmissionTexture.nonColorData=!0,i.push(this._loader.loadTextureInfoAsync(`${e}/diffuseTransmissionTexture`,o.diffuseTransmissionTexture).then((e=>{e.name=`${n.name} (Diffuse Transmission)`,r.subSurface.translucencyIntensityTexture=e})))),void 0!==o.diffuseTransmissionColorFactor?r.subSurface.translucencyColor=a.v9.FromArray(o.diffuseTransmissionColorFactor):r.subSurface.translucencyColor=a.v9.White(),o.diffuseTransmissionColorTexture&&i.push(this._loader.loadTextureInfoAsync(`${e}/diffuseTransmissionColorTexture`,o.diffuseTransmissionColorTexture).then((e=>{e.name=`${n.name} (Diffuse Transmission Color)`,r.subSurface.translucencyColorTexture=e}))),Promise.all(i).then((()=>{}))}}(0,r.Hg)(i),(0,r.Ye)(i,!0,(e=>new l(e)))},56400:(e,t,n)=>{n.d(t,{EXT_lights_image_based:()=>c});var s=n(77517),o=n(79923),a=n(61094),r=n(45316),i=n(37812);const l="EXT_lights_image_based";class c{constructor(e){this.name=l,this._loader=e,this.enabled=this._loader.isExtensionUsed(l)}dispose(){this._loader=null,delete this._lights}onLoading(){const e=this._loader.gltf.extensions;if(e&&e[this.name]){const t=e[this.name];this._lights=t.lights}}loadSceneAsync(e,t){return r.BT.LoadExtensionAsync(e,t,this.name,((n,s)=>{this._loader._allMaterialsDirtyRequired=!0;const o=new Array;o.push(this._loader.loadSceneAsync(e,t)),this._loader.logOpen(`${n}`);const a=r.l2.Get(`${n}/light`,this._lights,s.light);return o.push(this._loadLightAsync(`/extensions/${this.name}/lights/${s.light}`,a).then((e=>{this._loader.babylonScene.environmentTexture=e}))),this._loader.logClose(),Promise.all(o).then((()=>{}))}))}_loadLightAsync(e,t){if(!t._loaded){const n=new Array;this._loader.logOpen(`${e}`);const i=new Array(t.specularImages.length);for(let s=0;s<t.specularImages.length;s++){const o=t.specularImages[s];i[s]=new Array(o.length);for(let t=0;t<o.length;t++){const a=`${e}/specularImages/${s}/${t}`;this._loader.logOpen(`${a}`);const l=o[t],c=r.l2.Get(a,this._loader.gltf.images,l);n.push(this._loader.loadImageAsync(`/images/${l}`,c).then((e=>{i[s][t]=e}))),this._loader.logClose()}}this._loader.logClose(),t._loaded=Promise.all(n).then((()=>{const n=new a.p(this._loader.babylonScene,null,t.specularImageSize);if(n.name=t.name||"environment",t._babylonTexture=n,null!=t.intensity&&(n.level=t.intensity),t.rotation){let e=o.PT.FromArray(t.rotation);this._loader.babylonScene.useRightHandedSystem||(e=o.PT.Inverse(e)),o.uq.FromQuaternionToRef(e,n.getReflectionTextureMatrix())}if(!t.irradianceCoefficients)throw new Error(`${e}: Irradiance coefficients are missing`);const r=s.O.FromArray(t.irradianceCoefficients);r.scaleInPlace(t.intensity),r.convertIrradianceToLambertianRadiance();const l=s.Q.FromHarmonics(r),c=(i.length-1)/Math.log2(t.specularImageSize);return n.updateRGBDAsync(i,l,c)}))}return t._loaded.then((()=>t._babylonTexture))}}(0,i.Hg)(l),(0,i.Ye)(l,!0,(e=>new c(e)))},57010:(e,t,n)=>{n.d(t,{KHR_xmp_json_ld:()=>a});var s=n(37812);const o="KHR_xmp_json_ld";class a{constructor(e){this.name=o,this.order=100,this._loader=e,this.enabled=this._loader.isExtensionUsed(o)}dispose(){this._loader=null}onLoading(){if(null===this._loader.rootBabylonMesh)return;const e=this._loader.gltf.extensions?.KHR_xmp_json_ld,t=this._loader.gltf.asset?.extensions?.KHR_xmp_json_ld;if(e&&t){const n=+t.packet;e.packets&&n<e.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=e.packets[n])}}}(0,s.Hg)(o),(0,s.Ye)(o,!0,(e=>new a(e)))},60932:(e,t,n)=>{n.d(t,{KHR_materials_ior:()=>i});var s=n(23975),o=n(45316),a=n(37812);const r="KHR_materials_ior";class i{constructor(e){this.name=r,this.order=180,this._loader=e,this.enabled=this._loader.isExtensionUsed(r)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,t,n){return o.BT.LoadExtensionAsync(e,t,this.name,((s,o)=>{const a=new Array;return a.push(this._loader.loadMaterialPropertiesAsync(e,t,n)),a.push(this._loadIorPropertiesAsync(s,o,n)),Promise.all(a).then((()=>{}))}))}_loadIorPropertiesAsync(e,t,n){if(!(n instanceof s.Y))throw new Error(`${e}: Material type not supported`);return void 0!==t.ior?n.indexOfRefraction=t.ior:n.indexOfRefraction=i._DEFAULT_IOR,Promise.resolve()}}i._DEFAULT_IOR=1.5,(0,a.Hg)(r),(0,a.Ye)(r,!0,(e=>new i(e)))},63152:(e,t,n)=>{n.d(t,{KHR_mesh_quantization:()=>a});var s=n(37812);const o="KHR_mesh_quantization";class a{constructor(e){this.name=o,this.enabled=e.isExtensionUsed(o)}dispose(){}}(0,s.Hg)(o),(0,s.Ye)(o,!0,(e=>new a(e)))},63239:(e,t,n)=>{n.d(t,{STLFileLoader:()=>c});var s=n(998),o=n(95616),a=n(76595),r=n(15909),i=n(97889),l=n(71452);n(2093);class c{constructor(){this.solidPattern=/solid (\S*)([\S\s]*?)endsolid[ ]*(\S*)/g,this.facetsPattern=/facet([\s\S]*?)endfacet/g,this.normalPattern=/normal[\s]+([-+]?[0-9]+\.?[0-9]*([eE][-+]?[0-9]+)?)+[\s]+([-+]?[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?)+[\s]+([-+]?[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?)+/g,this.vertexPattern=/vertex[\s]+([-+]?[0-9]+\.?[0-9]*([eE][-+]?[0-9]+)?)+[\s]+([-+]?[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?)+[\s]+([-+]?[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?)+/g,this.name=l.W.name,this.extensions=l.W.extensions}importMesh(e,t,n,o,r){let i;if("string"!=typeof n){if(this._isBinary(n)){const e=new a.e("stlmesh",t);return this._parseBinary(e,n),r&&r.push(e),!0}n=(new TextDecoder).decode(new Uint8Array(n))}for(;i=this.solidPattern.exec(n);){let n=i[1];const o=i[3];if(o&&n!=o)return s.S0.Error("Error in STL, solid name != endsolid name"),!1;if(e&&n)if(e instanceof Array){if(!e.indexOf(n))continue}else if(n!==e)continue;n=n||"stlmesh";const l=new a.e(n,t);this._parseASCII(l,i[2]),r&&r.push(l)}return!0}load(e,t,n){return this.importMesh(null,e,t,n,null)}loadAssetContainer(e,t,n){const s=new i.WZ(e);return e._blockEntityCollection=!0,this.importMesh(null,e,t,n,s.meshes),e._blockEntityCollection=!1,s}_isBinary(e){const t=new DataView(e);if(t.byteLength<=80)return!1;if(84+50*t.getUint32(80,!0)===t.byteLength)return!0;const n=[115,111,108,105,100];for(let e=0;e<5;e++)if(t.getUint8(e)!==n[e])return!0;return!1}_parseBinary(e,t){const n=new DataView(t),s=n.getUint32(80,!0);let a=0;const r=new Float32Array(3*s*3),i=new Float32Array(3*s*3),l=new Uint32Array(3*s);let h=0;for(let e=0;e<s;e++){const t=84+50*e,s=n.getFloat32(t,!0),o=n.getFloat32(t+4,!0),u=n.getFloat32(t+8,!0);for(let e=1;e<=3;e++){const l=t+12*e;r[a]=n.getFloat32(l,!0),i[a]=s,c.DO_NOT_ALTER_FILE_COORDINATES?(r[a+1]=n.getFloat32(l+4,!0),r[a+2]=n.getFloat32(l+8,!0),i[a+1]=o,i[a+2]=u):(r[a+2]=n.getFloat32(l+4,!0),r[a+1]=n.getFloat32(l+8,!0),i[a+2]=o,i[a+1]=u),a+=3}c.DO_NOT_ALTER_FILE_COORDINATES?(l[h]=h,l[h+1]=h+2,l[h+2]=h+1,h+=3):(l[h]=h++,l[h]=h++,l[h]=h++)}e.setVerticesData(o.R.PositionKind,r),e.setVerticesData(o.R.NormalKind,i),e.setIndices(l),e.computeWorldMatrix(!0)}_parseASCII(e,t){const n=[],s=[],a=[];let r,i=0;for(;r=this.facetsPattern.exec(t);){const e=r[1],t=this.normalPattern.exec(e);if(this.normalPattern.lastIndex=0,!t)continue;const o=[Number(t[1]),Number(t[5]),Number(t[3])];let l;for(;l=this.vertexPattern.exec(e);)c.DO_NOT_ALTER_FILE_COORDINATES?(n.push(Number(l[1]),Number(l[3]),Number(l[5])),s.push(o[0],o[2],o[1])):(n.push(Number(l[1]),Number(l[5]),Number(l[3])),s.push(o[0],o[1],o[2]));c.DO_NOT_ALTER_FILE_COORDINATES?(a.push(i,i+2,i+1),i+=3):a.push(i++,i++,i++),this.vertexPattern.lastIndex=0}this.facetsPattern.lastIndex=0,e.setVerticesData(o.R.PositionKind,n),e.setVerticesData(o.R.NormalKind,s),e.setIndices(a),e.computeWorldMatrix(!0)}}c.DO_NOT_ALTER_FILE_COORDINATES=!1,(0,r.qS)(new c)},66272:(e,t,n)=>{n.d(t,{EXT_meshopt_compression:()=>i});var s=n(45316),o=n(59185),a=n(37812);const r="EXT_meshopt_compression";class i{constructor(e){this.name=r,this.enabled=e.isExtensionUsed(r),this._loader=e}dispose(){this._loader=null}loadBufferViewAsync(e,t){return s.BT.LoadExtensionAsync(e,t,this.name,((n,a)=>{const r=t;if(r._meshOptData)return r._meshOptData;const i=s.l2.Get(`${e}/buffer`,this._loader.gltf.buffers,a.buffer);return r._meshOptData=this._loader.loadBufferAsync(`/buffers/${i.index}`,i,a.byteOffset||0,a.byteLength).then((e=>o.v.Default.decodeGltfBufferAsync(e,a.count,a.byteStride,a.mode,a.filter))),r._meshOptData}))}}(0,a.Hg)(r),(0,a.Ye)(r,!0,(e=>new i(e)))},66360:(e,t,n)=>{n.d(t,{KHR_materials_transmission:()=>d});var s=n(23975),o=n(45316),a=n(75474),r=n(99848),i=n(96125),l=n(998),c=n(37812);class h{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:i.Y.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(e,t){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...h._GetDefaultOptions(),...e},this._scene=t,this._scene._transmissionHelper=this,this.onErrorObservable=new r.cP,this._scene.onDisposeObservable.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(e){if(!Object.keys(e).filter((t=>this._options[t]!==e[t])).length)return;const t={...this._options,...e},n=this._options;this._options=t,t.renderSize===n.renderSize&&t.renderTargetTextureType===n.renderTargetTextureType&&t.generateMipmaps===n.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=t.samples,this._opaqueRenderTarget.lodGenerationScale=t.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=t.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(e){return!!e&&!!(e instanceof s.Y&&e.subSurface.isRefractionEnabled)}_addMesh(e){this._materialObservers[e.uniqueId]=e.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),l.S0.SetImmediate((()=>{this._shouldRenderAsTransmission(e.material)?(e.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(e)&&this._transparentMeshesCache.push(e)):-1===this._opaqueMeshesCache.indexOf(e)&&this._opaqueMeshesCache.push(e)}))}_removeMesh(e){e.onMaterialChangedObservable.remove(this._materialObservers[e.uniqueId]),delete this._materialObservers[e.uniqueId];let t=this._transparentMeshesCache.indexOf(e);-1!==t&&this._transparentMeshesCache.splice(t,1),t=this._opaqueMeshesCache.indexOf(e),-1!==t&&this._opaqueMeshesCache.splice(t,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(e){const t=this._transparentMeshesCache.indexOf(e),n=this._opaqueMeshesCache.indexOf(e);this._shouldRenderAsTransmission(e.material)?(e.material instanceof s.Y&&(e.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==n?(this._opaqueMeshesCache.splice(n,1),this._transparentMeshesCache.push(e)):-1===t&&this._transparentMeshesCache.push(e)):-1!==t?(this._transparentMeshesCache.splice(t,1),this._opaqueMeshesCache.push(e)):-1===n&&this._opaqueMeshesCache.push(e)}_isRenderTargetValid(){return null!==this._opaqueRenderTarget?.getInternalTexture()}_setupRenderTargets(){let e;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new a.$("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=this._options.clearColor?.clone()??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.renderInLinearSpace=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((t=>{e=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?t.clearColor.copyFrom(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(t.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=e})),this._transparentMeshesCache.forEach((e=>{this._shouldRenderAsTransmission(e.material)&&(e.material.refractionTexture=this._opaqueRenderTarget)}))}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const u="KHR_materials_transmission";class d{constructor(e){this.name=u,this.order=175,this._loader=e,this.enabled=this._loader.isExtensionUsed(u),this.enabled&&(e.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,t,n){return o.BT.LoadExtensionAsync(e,t,this.name,((s,o)=>{const a=new Array;return a.push(this._loader.loadMaterialPropertiesAsync(e,t,n)),a.push(this._loadTransparentPropertiesAsync(s,t,n,o)),Promise.all(a).then((()=>{}))}))}_loadTransparentPropertiesAsync(e,t,n,o){if(!(n instanceof s.Y))throw new Error(`${e}: Material type not supported`);const a=n;if(a.subSurface.isRefractionEnabled=!0,a.subSurface.volumeIndexOfRefraction=1,a.subSurface.useAlbedoToTintRefraction=!0,void 0===o.transmissionFactor)return a.subSurface.refractionIntensity=0,a.subSurface.isRefractionEnabled=!1,Promise.resolve();{a.subSurface.refractionIntensity=o.transmissionFactor;const e=a.getScene();a.subSurface.refractionIntensity&&!e._transmissionHelper?new h({},a.getScene()):a.subSurface.refractionIntensity&&!e._transmissionHelper?._isRenderTargetValid()&&e._transmissionHelper?._setupRenderTargets()}return a.subSurface.minimumThickness=0,a.subSurface.maximumThickness=0,o.transmissionTexture?(o.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${e}/transmissionTexture`,o.transmissionTexture,void 0).then((e=>{e.name=`${n.name} (Transmission)`,a.subSurface.refractionIntensityTexture=e,a.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}(0,c.Hg)(u),(0,c.Ye)(u,!0,(e=>new d(e)))},74610:(e,t,n)=>{n.d(t,{KHR_node_hoverability:()=>c});var s=n(37812),o=n(48966),a=n(49532);const r="KHR_node_hoverability",i="targetMeshPointerOver_";(0,o.rO)("event/onHoverIn",r,{blocks:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",toBlock:"FlowGraphGetVariableBlock",dataTransformer:e=>[i+e[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",toBlock:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(e,t,n,s,o,a,r){const l=o[o.length-1];l.config=l.config||{},l.config.glTF=r;const c=e.configuration?.nodeIndex?.value[0];if(void 0===c||"number"!=typeof c)throw new Error("nodeIndex not found in configuration");const h=i+c;return o[1].config.variable=h,a._userVariables[h]={className:"Mesh",id:r?.nodes?.[c]._babylonTransformNode?.id,uniqueId:r?.nodes?.[c]._babylonTransformNode?.uniqueId},o}});const l="targetMeshPointerOut_";(0,o.rO)("event/onHoverOut",r,{blocks:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",toBlock:"FlowGraphGetVariableBlock",dataTransformer:e=>[l+e[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",toBlock:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(e,t,n,s,o,a,r){const i=o[o.length-1];i.config=i.config||{},i.config.glTF=r;const c=e.configuration?.nodeIndex?.value[0];if(void 0===c||"number"!=typeof c)throw new Error("nodeIndex not found in configuration");const h=l+c;return o[1].config.variable=h,a._userVariables[h]={className:"Mesh",id:r?.nodes?.[c]._babylonTransformNode?.id,uniqueId:r?.nodes?.[c]._babylonTransformNode?.uniqueId},o}}),(0,a.oR)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:e=>{const t=e._babylonTransformNode;return!t||void 0===t.pointerOverDisableMeshTesting||t.pointerOverDisableMeshTesting},set:(e,t)=>{t._primitiveBabylonMeshes?.forEach((t=>{t.pointerOverDisableMeshTesting=!e}))},getTarget:e=>e._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class c{constructor(e){this.name=r,this._loader=e,this.enabled=e.isExtensionUsed(r)}async onReady(){this._loader.gltf.nodes?.forEach((e=>{e.extensions?.KHR_node_hoverability&&!1===e.extensions?.KHR_node_hoverability.hoverable&&e._babylonTransformNode?.getChildMeshes().forEach((e=>{e.pointerOverDisableMeshTesting=!0}))}))}dispose(){this._loader=null}}(0,s.Hg)(r),(0,s.Ye)(r,!0,(e=>new c(e)))},76391:(e,t,n)=>{n.d(t,{SPLATFileLoader:()=>m});var s,o=n(15909),a=n(31612),r=n(98058),i=n(97889),l=n(76595),c=n(51137),h=n(79923),u=n(13833),d=n(26041),p=n(36803),_=n(62128);!function(e){e[e.Splat=0]="Splat",e[e.PointCloud=1]="PointCloud",e[e.Mesh=2]="Mesh",e[e.Reject=3]="Reject"}(s||(s={}));class m{constructor(e=m._DefaultLoadingOptions){this.name=a.B.name,this._assetContainer=null,this.extensions=a.B.extensions,this._loadingOptions=e}createPlugin(e){return new m(e[a.B.name])}async importMeshAsync(e,t,n,s,o,a){return this._parse(e,t,n,s).then((e=>({meshes:e,particleSystems:[],skeletons:[],animationGroups:[],transformNodes:[],geometries:[],lights:[],spriteManagers:[]})))}static _BuildPointCloud(e,t){if(!t.byteLength)return!1;const n=new Uint8Array(t),s=new Float32Array(t),o=n.length/32;return e.addPoints(o,(function(e,t){const o=s[8*t+0],a=s[8*t+1],r=s[8*t+2];e.position=new h.Pq(o,a,r);const i=n[32*t+24+0]/255,l=n[32*t+24+1]/255,c=n[32*t+24+2]/255;e.color=new d.ov(i,l,c,1)})),!0}static _BuildMesh(e,t){const n=new l.e("PLYMesh",e),s=new Uint8Array(t.data),o=new Float32Array(t.data),a=s.length/32,r=[],i=new p.P;for(let e=0;e<a;e++){const t=o[8*e+0],n=o[8*e+1],s=o[8*e+2];r.push(t,n,s)}if(t.hasVertexColors){const e=new Float32Array(4*a);for(let t=0;t<a;t++){const n=s[32*t+24+0]/255,o=s[32*t+24+1]/255,a=s[32*t+24+2]/255;e[4*t+0]=n,e[4*t+1]=o,e[4*t+2]=a,e[4*t+3]=1}i.colors=e}return i.positions=r,i.indices=t.faces,i.applyToMesh(n),n}_parseSPZ(e,t){const n=new Uint8Array(e),s=new Uint32Array(e),o=s[2],a=n[12],r=n[13];if(n[15]||1347635022!=s[0]||2!=s[1])return new Promise((e=>{e({mode:3,data:i,hasVertexColors:!1})}));const i=new ArrayBuffer(32*o),l=1/(1<<r),c=new Int32Array(1),h=new Uint8Array(c.buffer),u=function(e,t){return h[0]=e[t+0],h[1]=e[t+1],h[2]=e[t+2],h[3]=128&e[t+2]?255:0,c[0]*l};let d=16;const p=new Float32Array(i),m=new Float32Array(i),f=new Uint8ClampedArray(i),g=new Uint8ClampedArray(i);let b=1,y=0;this._loadingOptions.flipY||(b=-1,y=255);for(let e=0;e<o;e++)p[8*e+0]=u(n,d+0),p[8*e+1]=b*u(n,d+3),p[8*e+2]=b*u(n,d+6),d+=9;for(let e=0;e<o;e++){for(let t=0;t<3;t++){const s=(n[d+o+3*e+t]-127.5)/38.25;f[32*e+24+t]=_.X.Clamp(255*(.5+.282*s),0,255)}f[32*e+24+3]=n[d+e]}d+=4*o;for(let e=0;e<o;e++)m[8*e+3+0]=Math.exp(n[d+0]/16-10),m[8*e+3+1]=Math.exp(n[d+1]/16-10),m[8*e+3+2]=Math.exp(n[d+2]/16-10),d+=3;for(let e=0;e<o;e++){const t=n[d+0],s=n[d+1]*b+y,o=n[d+2]*b+y,a=t/127.5-1,r=s/127.5-1,i=o/127.5-1;g[32*e+28+1]=t,g[32*e+28+2]=s,g[32*e+28+3]=o;const l=1-(a*a+r*r+i*i);g[32*e+28+0]=127.5+127.5*Math.sqrt(l<0?0:l),d+=3}if(a){const e=3*((a+1)*(a+1)-1),s=Math.ceil(e/16);let r=d;const l=[],c=t.getEngine().getCaps().maxTextureSize,h=Math.ceil(o/c);for(let e=0;e<s;e++){const e=new Uint8Array(h*c*4*4);l.push(e)}for(let t=0;t<o;t++)for(let s=0;s<e;s++){const e=n[r++],o=Math.floor(s/16);l[o][s%16+16*t]=e}return new Promise((e=>{e({mode:0,data:i,hasVertexColors:!1,sh:l})}))}return new Promise((e=>{e({mode:0,data:i,hasVertexColors:!1})}))}_parse(e,t,n,s){const o=[],a=new ReadableStream({start(e){e.enqueue(new Uint8Array(n)),e.close()}}),i=new DecompressionStream("gzip"),l=a.pipeThrough(i);return new Promise((e=>{new Response(l).arrayBuffer().then((n=>{this._parseSPZ(n,t).then((n=>{t._blockEntityCollection=!!this._assetContainer;const s=new r.t("GaussianSplatting",null,t,this._loadingOptions.keepInRam);s._parentContainer=this._assetContainer,o.push(s),s.updateData(n.data,n.sh),t._blockEntityCollection=!1,e(o)}))})).catch((()=>{m._ConvertPLYToSplat(n).then((async n=>{switch(t._blockEntityCollection=!!this._assetContainer,n.mode){case 0:{const e=new r.t("GaussianSplatting",null,t,this._loadingOptions.keepInRam);e._parentContainer=this._assetContainer,o.push(e),e.updateData(n.data)}break;case 1:{const e=new u.y("PointCloud",1,t);m._BuildPointCloud(e,n.data)?await e.buildMeshAsync().then((e=>{o.push(e)})):e.dispose()}break;case 2:if(!n.faces)throw new Error("PLY mesh doesn't contain face informations.");o.push(m._BuildMesh(t,n));break;default:throw new Error("Unsupported Splat mode")}t._blockEntityCollection=!1,e(o)}))}))}))}loadAssetContainerAsync(e,t,n){const s=new i.WZ(e);return this._assetContainer=s,this.importMeshAsync(null,e,t,n).then((e=>(e.meshes.forEach((e=>s.meshes.push(e))),this._assetContainer=null,s))).catch((e=>{throw this._assetContainer=null,e}))}loadAsync(e,t,n){return this.importMeshAsync(null,e,t,n).then((()=>{}))}static _ConvertPLYToSplat(e){const t=new Uint8Array(e),n=(new TextDecoder).decode(t.slice(0,10240)),s=n.indexOf("end_header\n");if(s<0||!n)return new Promise((t=>{t({mode:0,data:e})}));const o=parseInt(/element vertex (\d+)\n/.exec(n)[1]),a=/element face (\d+)\n/.exec(n);let i=0;a&&(i=parseInt(a[1]));const l=/element chunk (\d+)\n/.exec(n);let h=0;l&&(h=parseInt(l[1]));let u=0,d=0;const p={double:8,int:4,uint:4,float:4,short:2,ushort:2,uchar:1,list:0};let _;!function(e){e[e.Vertex=0]="Vertex",e[e.Chunk=1]="Chunk"}(_||(_={}));let m=1;const f=[],g=[],b=n.slice(0,s).split("\n");for(const e of b)if(e.startsWith("property ")){const[,t,n]=e.split(" ");1==m?(g.push({name:n,type:t,offset:d}),d+=p[t]):0==m&&(f.push({name:n,type:t,offset:u}),u+=p[t]),p[t]||c.V.Warn(`Unsupported property type: ${t}.`)}else if(e.startsWith("element ")){const[,t]=e.split(" ");"chunk"==t?m=1:"vertex"==t&&(m=0)}const y=u,x=d;return r.t.ConvertPLYWithSHToSplatAsync(e).then((t=>{const n=new DataView(e,s+11);let a=x*h+y*o;const r=[];if(i)for(let e=0;e<i;e++){const e=n.getUint8(a);if(3==e){a+=1;for(let t=0;t<e;t++){const e=n.getUint32(a+4*(2-t),!0);r.push(e)}a+=12}}if(h)return new Promise((e=>{e({mode:0,data:t.buffer,sh:t.sh,faces:r,hasVertexColors:!1})}));let l=0,c=0;const u=["x","y","z","scale_0","scale_1","scale_2","opacity","rot_0","rot_1","rot_2","rot_3"],d=["red","green","blue","f_dc_0","f_dc_1","f_dc_2"];for(let e=0;e<f.length;e++){const t=f[e];u.includes(t.name)&&l++,d.includes(t.name)&&c++}const p=l==u.length&&3==c,_=i?2:p?0:1;return new Promise((e=>{e({mode:_,data:t.buffer,sh:t.sh,faces:r,hasVertexColors:!!c})}))}))}}m._DefaultLoadingOptions={keepInRam:!1,flipY:!1},(0,o.qS)(new m)},81578:(e,t,n)=>{n.d(t,{KHR_materials_volume:()=>i});var s=n(23975),o=n(45316),a=n(37812);const r="KHR_materials_volume";class i{constructor(e){this.name=r,this.order=173,this._loader=e,this.enabled=this._loader.isExtensionUsed(r),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(e,t,n){return o.BT.LoadExtensionAsync(e,t,this.name,((s,o)=>{const a=new Array;return a.push(this._loader.loadMaterialPropertiesAsync(e,t,n)),a.push(this._loadVolumePropertiesAsync(s,t,n,o)),Promise.all(a).then((()=>{}))}))}_loadVolumePropertiesAsync(e,t,n,o){if(!(n instanceof s.Y))throw new Error(`${e}: Material type not supported`);if(!n.subSurface.isRefractionEnabled&&!n.subSurface.isTranslucencyEnabled||!o.thicknessFactor)return Promise.resolve();n.subSurface.volumeIndexOfRefraction=n.indexOfRefraction;const a=void 0!==o.attenuationDistance?o.attenuationDistance:Number.MAX_VALUE;return n.subSurface.tintColorAtDistance=a,void 0!==o.attenuationColor&&3==o.attenuationColor.length&&n.subSurface.tintColor.copyFromFloats(o.attenuationColor[0],o.attenuationColor[1],o.attenuationColor[2]),n.subSurface.minimumThickness=0,n.subSurface.maximumThickness=o.thicknessFactor,n.subSurface.useThicknessAsDepth=!0,o.thicknessTexture?(o.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${e}/thicknessTexture`,o.thicknessTexture).then((e=>{e.name=`${n.name} (Thickness)`,n.subSurface.thicknessTexture=e,n.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}(0,a.Hg)(r),(0,a.Ye)(r,!0,(e=>new i(e)))},82787:(e,t,n)=>{n.d(t,{KHR_texture_transform:()=>i});var s=n(7481),o=n(45316),a=n(37812);const r="KHR_texture_transform";class i{constructor(e){this.name=r,this._loader=e,this.enabled=this._loader.isExtensionUsed(r)}dispose(){this._loader=null}loadTextureInfoAsync(e,t,n){return o.BT.LoadExtensionAsync(e,t,this.name,((o,a)=>this._loader.loadTextureInfoAsync(e,t,(e=>{if(!(e instanceof s.g))throw new Error(`${o}: Texture type not supported`);a.offset&&(e.uOffset=a.offset[0],e.vOffset=a.offset[1]),e.uRotationCenter=0,e.vRotationCenter=0,a.rotation&&(e.wAng=-a.rotation),a.scale&&(e.uScale=a.scale[0],e.vScale=a.scale[1]),null!=a.texCoord&&(e.coordinatesIndex=a.texCoord),n(e)}))))}}(0,a.Hg)(r),(0,a.Ye)(r,!0,(e=>new i(e)))},84770:(e,t,n)=>{n.d(t,{KHR_materials_unlit:()=>l});var s=n(26041),o=n(23975),a=n(45316),r=n(37812);const i="KHR_materials_unlit";class l{constructor(e){this.name=i,this.order=210,this._loader=e,this.enabled=this._loader.isExtensionUsed(i)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,t,n){return a.BT.LoadExtensionAsync(e,t,this.name,(()=>this._loadUnlitPropertiesAsync(e,t,n)))}_loadUnlitPropertiesAsync(e,t,n){if(!(n instanceof o.Y))throw new Error(`${e}: Material type not supported`);const a=new Array;n.unlit=!0;const r=t.pbrMetallicRoughness;return r&&(r.baseColorFactor?(n.albedoColor=s.v9.FromArray(r.baseColorFactor),n.alpha=r.baseColorFactor[3]):n.albedoColor=s.v9.White(),r.baseColorTexture&&a.push(this._loader.loadTextureInfoAsync(`${e}/baseColorTexture`,r.baseColorTexture,(e=>{e.name=`${n.name} (Base Color)`,n.albedoTexture=e})))),t.doubleSided&&(n.backFaceCulling=!1,n.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(e,t,n),Promise.all(a).then((()=>{}))}}(0,r.Hg)(i),(0,r.Ye)(i,!0,(e=>new l(e)))},85777:(e,t,n)=>{n.d(t,{MSFT_audio_emitter:()=>u});var s=n(79923),o=n(998),a=n(35238),r=n(23938),i=n(69645),l=n(45316),c=n(37812);n(69440);const h="MSFT_audio_emitter";class u{constructor(e){this.name=h,this._loader=e,this.enabled=this._loader.isExtensionUsed(h)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const e=this._loader.gltf.extensions;if(e&&e[this.name]){const t=e[this.name];this._clips=t.clips,this._emitters=t.emitters,l.l2.Assign(this._clips),l.l2.Assign(this._emitters)}}loadSceneAsync(e,t){return l.BT.LoadExtensionAsync(e,t,this.name,((n,s)=>{const o=new Array;o.push(this._loader.loadSceneAsync(e,t));for(const e of s.emitters){const t=l.l2.Get(`${n}/emitters`,this._emitters,e);if(null!=t.refDistance||null!=t.maxDistance||null!=t.rolloffFactor||null!=t.distanceModel||null!=t.innerAngle||null!=t.outerAngle)throw new Error(`${n}: Direction or Distance properties are not allowed on emitters attached to a scene`);o.push(this._loadEmitterAsync(`${n}/emitters/${t.index}`,t))}return Promise.all(o).then((()=>{}))}))}loadNodeAsync(e,t,n){return l.BT.LoadExtensionAsync(e,t,this.name,((e,a)=>{const r=new Array;return this._loader.loadNodeAsync(e,t,(t=>{for(const n of a.emitters){const a=l.l2.Get(`${e}/emitters`,this._emitters,n);r.push(this._loadEmitterAsync(`${e}/emitters/${a.index}`,a).then((()=>{for(const e of a._babylonSounds)e.attachToMesh(t),null==a.innerAngle&&null==a.outerAngle||(e.setLocalDirectionToMesh(s.Pq.Forward()),e.setDirectionalCone(2*o.S0.ToDegrees(null==a.innerAngle?Math.PI:a.innerAngle),2*o.S0.ToDegrees(null==a.outerAngle?Math.PI:a.outerAngle),0))})))}n(t)})).then((e=>Promise.all(r).then((()=>e))))}))}loadAnimationAsync(e,t){return l.BT.LoadExtensionAsync(e,t,this.name,((n,s)=>this._loader.loadAnimationAsync(e,t).then((o=>{const a=new Array;l.l2.Assign(s.events);for(const r of s.events)a.push(this._loadAnimationEventAsync(`${n}/events/${r.index}`,e,t,r,o));return Promise.all(a).then((()=>o))}))))}_loadClipAsync(e,t){if(t._objectURL)return t._objectURL;let n;if(t.uri)n=this._loader.loadUriAsync(e,t,t.uri);else{const s=l.l2.Get(`${e}/bufferView`,this._loader.gltf.bufferViews,t.bufferView);n=this._loader.loadBufferViewAsync(`/bufferViews/${s.index}`,s)}return t._objectURL=n.then((e=>URL.createObjectURL(new Blob([e],{type:t.mimeType})))),t._objectURL}_loadEmitterAsync(e,t){if(t._babylonSounds=t._babylonSounds||[],!t._babylonData){const e=new Array,n=t.name||`emitter${t.index}`,s={loop:!1,autoplay:!1,volume:null==t.volume?1:t.volume};for(let o=0;o<t.clips.length;o++){const a=`/extensions/${this.name}/clips`,i=l.l2.Get(a,this._clips,t.clips[o].clip);e.push(this._loadClipAsync(`${a}/${t.clips[o].clip}`,i).then((e=>{const a=t._babylonSounds[o]=new r.A(n,e,this._loader.babylonScene,null,s);a.refDistance=t.refDistance||1,a.maxDistance=t.maxDistance||256,a.rolloffFactor=t.rolloffFactor||1,a.distanceModel=t.distanceModel||"exponential"})))}const a=Promise.all(e).then((()=>{const e=t.clips.map((e=>e.weight||1)),n=new i.r(t.loop||!1,t._babylonSounds,e);t.innerAngle&&(n.directionalConeInnerAngle=2*o.S0.ToDegrees(t.innerAngle)),t.outerAngle&&(n.directionalConeOuterAngle=2*o.S0.ToDegrees(t.outerAngle)),t.volume&&(n.volume=t.volume),t._babylonData.sound=n}));t._babylonData={loaded:a}}return t._babylonData.loaded}_getEventAction(e,t,n,s,o){switch(n){case"play":return e=>{const n=(o||0)+(e-s);t.play(n)};case"stop":return()=>{t.stop()};case"pause":return()=>{t.pause()};default:throw new Error(`${e}: Unsupported action ${n}`)}}_loadAnimationEventAsync(e,t,n,s,o){if(0==o.targetedAnimations.length)return Promise.resolve();const r=o.targetedAnimations[0],i=s.emitter,c=l.l2.Get(`/extensions/${this.name}/emitters`,this._emitters,i);return this._loadEmitterAsync(e,c).then((()=>{const t=c._babylonData.sound;if(t){const n=new a.p(s.time,this._getEventAction(e,t,s.action,s.time,s.startOffset));r.animation.addEvent(n),o.onAnimationGroupEndObservable.add((()=>{t.stop()})),o.onAnimationGroupPauseObservable.add((()=>{t.pause()}))}}))}}(0,c.Hg)(h),(0,c.Ye)(h,!0,(e=>new u(e)))},86161:(e,t,n)=>{n.d(t,{KHR_materials_specular:()=>l});var s=n(23975),o=n(45316),a=n(26041),r=n(37812);const i="KHR_materials_specular";class l{constructor(e){this.name=i,this.order=190,this._loader=e,this.enabled=this._loader.isExtensionUsed(i)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,t,n){return o.BT.LoadExtensionAsync(e,t,this.name,((s,o)=>{const a=new Array;return a.push(this._loader.loadMaterialPropertiesAsync(e,t,n)),a.push(this._loadSpecularPropertiesAsync(s,o,n)),Promise.all(a).then((()=>{}))}))}_loadSpecularPropertiesAsync(e,t,n){if(!(n instanceof s.Y))throw new Error(`${e}: Material type not supported`);const o=new Array;return void 0!==t.specularFactor&&(n.metallicF0Factor=t.specularFactor),void 0!==t.specularColorFactor&&(n.metallicReflectanceColor=a.v9.FromArray(t.specularColorFactor)),t.specularTexture&&(t.specularTexture.nonColorData=!0,o.push(this._loader.loadTextureInfoAsync(`${e}/specularTexture`,t.specularTexture,(e=>{e.name=`${n.name} (Specular)`,n.metallicReflectanceTexture=e,n.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),t.specularColorTexture&&o.push(this._loader.loadTextureInfoAsync(`${e}/specularColorTexture`,t.specularColorTexture,(e=>{e.name=`${n.name} (Specular Color)`,n.reflectanceTexture=e}))),Promise.all(o).then((()=>{}))}}(0,r.Hg)(i),(0,r.Ye)(i,!0,(e=>new l(e)))},88827:(e,t,n)=>{n.d(t,{EXT_texture_avif:()=>r});var s=n(45316),o=n(37812);const a="EXT_texture_avif";class r{constructor(e){this.name=a,this._loader=e,this.enabled=e.isExtensionUsed(a)}dispose(){this._loader=null}_loadTextureAsync(e,t,n){return s.BT.LoadExtensionAsync(e,t,this.name,((o,a)=>{const r=null==t.sampler?s.BT.DefaultSampler:s.l2.Get(`${e}/sampler`,this._loader.gltf.samplers,t.sampler),i=s.l2.Get(`${o}/source`,this._loader.gltf.images,a.source);return this._loader._createTextureAsync(e,r,i,(e=>{n(e)}),void 0,!t._textureInfo.nonColorData)}))}}(0,o.Hg)(a),(0,o.Ye)(a,!0,(e=>new r(e)))},89278:(e,t,n)=>{n.d(t,{EXT_mesh_gpu_instancing:()=>i});var s=n(79923),o=n(45316),a=n(37812);n(90203);const r="EXT_mesh_gpu_instancing";class i{constructor(e){this.name=r,this._loader=e,this.enabled=this._loader.isExtensionUsed(r)}dispose(){this._loader=null}loadNodeAsync(e,t,n){return o.BT.LoadExtensionAsync(e,t,this.name,((e,a)=>{this._loader._disableInstancedMesh++;const r=this._loader.loadNodeAsync(`/nodes/${t.index}`,t,n);if(this._loader._disableInstancedMesh--,!t._primitiveBabylonMeshes)return r;const i=new Array;let l=0;const c=t=>{if(null==a.attributes[t])return void i.push(Promise.resolve(null));const n=o.l2.Get(`${e}/attributes/${t}`,this._loader.gltf.accessors,a.attributes[t]);if(i.push(this._loader._loadFloatAccessorAsync(`/accessors/${n.bufferView}`,n)),0===l)l=n.count;else if(l!==n.count)throw new Error(`${e}/attributes: Instance buffer accessors do not have the same count.`)};return c("TRANSLATION"),c("ROTATION"),c("SCALE"),r.then((e=>Promise.all(i).then((([n,o,a])=>{const r=new Float32Array(16*l);s.AA.Vector3[0].copyFromFloats(0,0,0),s.AA.Quaternion[0].copyFromFloats(0,0,0,1),s.AA.Vector3[1].copyFromFloats(1,1,1);for(let e=0;e<l;++e)n&&s.Pq.FromArrayToRef(n,3*e,s.AA.Vector3[0]),o&&s.PT.FromArrayToRef(o,4*e,s.AA.Quaternion[0]),a&&s.Pq.FromArrayToRef(a,3*e,s.AA.Vector3[1]),s.uq.ComposeToRef(s.AA.Vector3[1],s.AA.Quaternion[0],s.AA.Vector3[0],s.AA.Matrix[0]),s.AA.Matrix[0].copyToArray(r,16*e);for(const e of t._primitiveBabylonMeshes)e.thinInstanceSetBuffer("matrix",r,16,!0);return e}))))}))}}(0,a.Hg)(r),(0,a.Ye)(r,!0,(e=>new i(e)))},90967:(e,t,n)=>{n.d(t,{KHR_lights:()=>d});var s=n(79923),o=n(26041),a=n(52046),r=n(67524),i=n(40136),l=n(64704),c=n(45316),h=n(37812);const u="KHR_lights_punctual";class d{constructor(e){this.name=u,this._loader=e,this.enabled=this._loader.isExtensionUsed(u)}dispose(){this._loader=null,delete this._lights}onLoading(){const e=this._loader.gltf.extensions;if(e&&e[this.name]){const t=e[this.name];this._lights=t.lights,c.l2.Assign(this._lights)}}loadNodeAsync(e,t,n){return c.BT.LoadExtensionAsync(e,t,this.name,((h,u)=>(this._loader._allMaterialsDirtyRequired=!0,this._loader.loadNodeAsync(e,t,(e=>{let t;const d=c.l2.Get(h,this._lights,u.light),p=d.name||e.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,d.type){case"directional":{const e=new a.Z(p,s.Pq.Backward(),this._loader.babylonScene);e.position.setAll(0),t=e;break}case"point":t=new r.H(p,s.Pq.Zero(),this._loader.babylonScene);break;case"spot":{const e=new i.n(p,s.Pq.Zero(),s.Pq.Backward(),0,1,this._loader.babylonScene);e.angle=2*(d.spot&&d.spot.outerConeAngle||Math.PI/4),e.innerAngle=2*(d.spot&&d.spot.innerConeAngle||0),t=e;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${h}: Invalid light type (${d.type})`)}t._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,d._babylonLight=t,t.falloffType=l.v.FALLOFF_GLTF,t.diffuse=d.color?o.v9.FromArray(d.color):o.v9.White(),t.intensity=null==d.intensity?1:d.intensity,t.range=null==d.range?Number.MAX_VALUE:d.range,t.parent=e,this._loader._babylonLights.push(t),c.BT.AddPointerMetadata(t,h),n(e)})))))}}(0,h.Hg)(u),(0,h.Ye)(u,!0,(e=>new d(e)))},91386:(e,t,n)=>{n.d(t,{KHR_materials_dispersion:()=>i});var s=n(23975),o=n(45316),a=n(37812);const r="KHR_materials_dispersion";class i{constructor(e){this.name=r,this.order=174,this._loader=e,this.enabled=this._loader.isExtensionUsed(r)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,t,n){return o.BT.LoadExtensionAsync(e,t,this.name,((s,o)=>{const a=new Array;return a.push(this._loader.loadMaterialPropertiesAsync(e,t,n)),a.push(this._loadDispersionPropertiesAsync(s,t,n,o)),Promise.all(a).then((()=>{}))}))}_loadDispersionPropertiesAsync(e,t,n,o){if(!(n instanceof s.Y))throw new Error(`${e}: Material type not supported`);return n.subSurface.isRefractionEnabled&&o.dispersion?(n.subSurface.isDispersionEnabled=!0,n.subSurface.dispersion=o.dispersion,Promise.resolve()):Promise.resolve()}}(0,a.Hg)(r),(0,a.Ye)(r,!0,(e=>new i(e)))},92931:(e,t,n)=>{n.d(t,{KHR_materials_sheen:()=>l});var s=n(23975),o=n(45316),a=n(26041),r=n(37812);const i="KHR_materials_sheen";class l{constructor(e){this.name=i,this.order=190,this._loader=e,this.enabled=this._loader.isExtensionUsed(i)}dispose(){this._loader=null}loadMaterialPropertiesAsync(e,t,n){return o.BT.LoadExtensionAsync(e,t,this.name,((s,o)=>{const a=new Array;return a.push(this._loader.loadMaterialPropertiesAsync(e,t,n)),a.push(this._loadSheenPropertiesAsync(s,o,n)),Promise.all(a).then((()=>{}))}))}_loadSheenPropertiesAsync(e,t,n){if(!(n instanceof s.Y))throw new Error(`${e}: Material type not supported`);const o=new Array;return n.sheen.isEnabled=!0,n.sheen.intensity=1,null!=t.sheenColorFactor?n.sheen.color=a.v9.FromArray(t.sheenColorFactor):n.sheen.color=a.v9.Black(),t.sheenColorTexture&&o.push(this._loader.loadTextureInfoAsync(`${e}/sheenColorTexture`,t.sheenColorTexture,(e=>{e.name=`${n.name} (Sheen Color)`,n.sheen.texture=e}))),void 0!==t.sheenRoughnessFactor?n.sheen.roughness=t.sheenRoughnessFactor:n.sheen.roughness=0,t.sheenRoughnessTexture&&(t.sheenRoughnessTexture.nonColorData=!0,o.push(this._loader.loadTextureInfoAsync(`${e}/sheenRoughnessTexture`,t.sheenRoughnessTexture,(e=>{e.name=`${n.name} (Sheen Roughness)`,n.sheen.textureRoughness=e})))),n.sheen.albedoScaling=!0,n.sheen.useRoughnessFromMainTexture=!1,Promise.all(o).then((()=>{}))}}(0,r.Hg)(i),(0,r.Ye)(i,!0,(e=>new l(e)))},99538:(e,t,n)=>{n.d(t,{KHR_node_selectability:()=>i});var s=n(37812),o=n(48966),a=n(49532);const r="KHR_node_selectability";(0,o.rO)("event/onSelect",r,{blocks:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",toBlock:"FlowGraphGetVariableBlock",dataTransformer:e=>["pickedMesh_"+e[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",toBlock:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(e,t,n,s,o,a,r){const i=o[o.length-1];i.config=i.config||{},i.config.glTF=r;const l=e.configuration?.nodeIndex?.value[0];if(void 0===l||"number"!=typeof l)throw new Error("nodeIndex not found in configuration");const c="pickedMesh_"+l;return o[1].config.variable=c,a._userVariables[c]={className:"Mesh",id:r?.nodes?.[l]._babylonTransformNode?.id,uniqueId:r?.nodes?.[l]._babylonTransformNode?.uniqueId},o}}),(0,a.oR)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:e=>{const t=e._babylonTransformNode;return!t||void 0===t.isPickable||t.isPickable},set:(e,t)=>{t._primitiveBabylonMeshes?.forEach((t=>{t.isPickable=e}))},getTarget:e=>e._babylonTransformNode,getPropertyName:[()=>"isPickable"],type:"boolean"});class i{constructor(e){this.name=r,this._loader=e,this.enabled=e.isExtensionUsed(r)}async onReady(){this._loader.gltf.nodes?.forEach((e=>{e.extensions?.KHR_node_selectability&&!1===e.extensions?.KHR_node_selectability.selectable&&e._babylonTransformNode?.getChildMeshes().forEach((e=>{e.isPickable=!1}))}))}dispose(){this._loader=null}}(0,s.Hg)(r),(0,s.Ye)(r,!0,(e=>new i(e)))}}]);